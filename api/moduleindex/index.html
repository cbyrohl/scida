<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://scida.io/api/moduleindex/">
      
      
        <link rel="prev" href="../base_api/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Index - scida</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="scida" class="md-header__button md-logo" aria-label="scida" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            scida
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Index
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cbyrohl/scida" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    cbyrohl/scida
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../install/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../supported_data/" class="md-tabs__link">
          
  
  
    
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../faq/" class="md-tabs__link">
          
  
  
    
  
  Further Topics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cookbooks/" class="md-tabs__link">
          
  
  
    
  
  Cookbooks

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../base_api/" class="md-tabs__link">
          
  
  
    
  
  API

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="scida" class="md-nav__button md-logo" aria-label="scida" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    scida
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cbyrohl/scida" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    cbyrohl/scida
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorial/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Tutorial
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorial
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/simulations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simulations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/observations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supported_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Supported datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Units
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../derived_fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Derived fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data series
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../largedatasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Large datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../halocatalogs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Halo/Galaxy Catalogs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Further Topics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Further Topics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../developer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../impressions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visual Impressions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cookbooks/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Cookbooks
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cookbooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scida" class="md-nav__link">
    <span class="md-ellipsis">
      
        scida
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.config.combine_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        combine_configs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.copy_defaultconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_defaultconfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_config_fromfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_config_fromfile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_config_fromfiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_config_fromfiles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_simulationconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_simulationconfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.merge_dicts_recursively" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_dicts_recursively
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.convenience" class="md-nav__link">
    <span class="md-ellipsis">
      
        convenience
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="convenience">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.convenience.download_and_extract" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_and_extract
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.find_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_dataset_by_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset_by_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_dataset_candidates" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset_candidates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_datasets_by_props" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_datasets_by_props
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_testdata" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_testdata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.load" class="md-nav__link">
    <span class="md-ellipsis">
      
        load
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.customs" class="md-nav__link">
    <span class="md-ellipsis">
      
        customs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="customs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo" class="md-nav__link">
    <span class="md-ellipsis">
      
        arepo
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="arepo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG" class="md-nav__link">
    <span class="md-ellipsis">
      
        MTNG
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MTNG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG.dataset.MTNGArepoCatalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        MTNGArepoCatalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG.dataset.MTNGArepoSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        MTNGArepoSnapshot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        TNGcluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TNGcluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster.dataset.TNGClusterSelector" class="md-nav__link">
    <span class="md-ellipsis">
      
        TNGClusterSelector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster.dataset.TNGClusterSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        TNGClusterSnapshot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoCatalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoCatalog
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoCatalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoCatalog.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoCatalog.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoSnapshot
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoSnapshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.add_catalogIDs" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_catalogIDs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.add_groupquantity_to_particles" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_groupquantity_to_particles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.discover_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        discover_catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_grouplengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_grouplengths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_groupoffsets" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_groupoffsets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_subhalolengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_subhalolengths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_subhalooffsets" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_subhalooffsets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        grouped
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.load_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.map_group_operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_group_operation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.register_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.return_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ChainOps" class="md-nav__link">
    <span class="md-ellipsis">
      
        ChainOps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChainOps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ChainOps.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation" class="md-nav__link">
    <span class="md-ellipsis">
      
        GroupAwareOperation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GroupAwareOperation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.chain" class="md-nav__link">
    <span class="md-ellipsis">
      
        chain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.half" class="md-nav__link">
    <span class="md-ellipsis">
      
        half
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.max" class="md-nav__link">
    <span class="md-ellipsis">
      
        max
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.min" class="md-nav__link">
    <span class="md-ellipsis">
      
        min
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.sum" class="md-nav__link">
    <span class="md-ellipsis">
      
        sum
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.compute_haloindex" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_haloindex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.compute_haloquantity" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_haloquantity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.compute_localsubhaloindex" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_localsubhaloindex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.get_hidx" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_hidx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.get_localshidx" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_localshidx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.get_shcounts_shcells" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_shcounts_shcells
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.map_group_operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_group_operation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.map_group_operation_get_chunkedges" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_group_operation_get_chunkedges
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.memorycost_limiter" class="md-nav__link">
    <span class="md-ellipsis">
      
        memorycost_limiter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.wrap_func_scalar" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrap_func_scalar
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.extra_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        extra_fields
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extra_fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.extra_fields.Temperature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Temperature
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      
        helpers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.helpers.grp_type_str" class="md-nav__link">
    <span class="md-ellipsis">
      
        grp_type_str
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.helpers.part_type_num" class="md-nav__link">
    <span class="md-ellipsis">
      
        part_type_num
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector" class="md-nav__link">
    <span class="md-ellipsis">
      
        selector
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="selector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoSelector
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoSelector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector.select_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        select_group
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector.select_unbound" class="md-nav__link">
    <span class="md-ellipsis">
      
        select_unbound
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series" class="md-nav__link">
    <span class="md-ellipsis">
      
        series
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="series">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series.ArepoSimulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoSimulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoSimulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series.ArepoSimulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series.ArepoSimulation.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle" class="md-nav__link">
    <span class="md-ellipsis">
      
        gadgetstyle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gadgetstyle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        GadgetStyleSnapshot
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GadgetStyleSnapshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.merge_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.merge_hints" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_hints
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.register_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.series" class="md-nav__link">
    <span class="md-ellipsis">
      
        series
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="series">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.series.GadgetStyleSimulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        GadgetStyleSimulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GadgetStyleSimulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.series.GadgetStyleSimulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.discovertypes" class="md-nav__link">
    <span class="md-ellipsis">
      
        discovertypes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discovertypes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.discovertypes.CandidateStatus" class="md-nav__link">
    <span class="md-ellipsis">
      
        CandidateStatus
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.discovertypes.is_valid_candidate" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_valid_candidate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        fields
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.DerivedFieldRecipe" class="md-nav__link">
    <span class="md-ellipsis">
      
        DerivedFieldRecipe
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivedFieldRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.DerivedFieldRecipe.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldContainer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldContainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataframe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.fieldcount" class="md-nav__link">
    <span class="md-ellipsis">
      
        fieldcount
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.fieldlength" class="md-nav__link">
    <span class="md-ellipsis">
      
        fieldlength
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.add_alias" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_alias
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.add_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.copy" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.copy_skeleton" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_skeleton
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.get_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataframe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.get_ureg" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_ureg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.items" class="md-nav__link">
    <span class="md-ellipsis">
      
        items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.merge" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.register_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.remove_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.set_ureg" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_ureg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.values" class="md-nav__link">
    <span class="md-ellipsis">
      
        values
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldRecipe" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldRecipe
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldRecipe.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldType" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldType
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.walk_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_container
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.helpers_hdf5" class="md-nav__link">
    <span class="md-ellipsis">
      
        helpers_hdf5
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers_hdf5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.create_mergedhdf5file" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_mergedhdf5file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.get_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.walk_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_group
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.walk_hdf5file" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_hdf5file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.walk_zarrfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_zarrfile
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.helpers_misc" class="md-nav__link">
    <span class="md-ellipsis">
      
        helpers_misc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers_misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.RecursiveNamespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        RecursiveNamespace
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RecursiveNamespace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.RecursiveNamespace.__elt" class="md-nav__link">
    <span class="md-ellipsis">
      
        __elt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.RecursiveNamespace.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.computedecorator" class="md-nav__link">
    <span class="md-ellipsis">
      
        computedecorator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.get_args" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_args
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.get_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_kwargs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.hash_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        hash_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.make_serializable" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_serializable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.map_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.sprint" class="md-nav__link">
    <span class="md-ellipsis">
      
        sprint
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        interface
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseDataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__dask_tokenize__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __dask_tokenize__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __hash__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init_subclass__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.return_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.Dataset.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.DatasetWithUnitMixin" class="md-nav__link">
    <span class="md-ellipsis">
      
        DatasetWithUnitMixin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetWithUnitMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.DatasetWithUnitMixin.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.MixinMeta" class="md-nav__link">
    <span class="md-ellipsis">
      
        MixinMeta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector" class="md-nav__link">
    <span class="md-ellipsis">
      
        Selector
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Selector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.prepare" class="md-nav__link">
    <span class="md-ellipsis">
      
        prepare
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.create_datasetclass_with_mixins" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_datasetclass_with_mixins
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.io" class="md-nav__link">
    <span class="md-ellipsis">
      
        io
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.io.fits" class="md-nav__link">
    <span class="md-ellipsis">
      
        fits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.io.fits.fitsrecords_to_daskarrays" class="md-nav__link">
    <span class="md-ellipsis">
      
        fitsrecords_to_daskarrays
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.misc" class="md-nav__link">
    <span class="md-ellipsis">
      
        misc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.misc.check_config_for_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        check_config_for_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.deepdictkeycopy" class="md-nav__link">
    <span class="md-ellipsis">
      
        deepdictkeycopy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.get_container_from_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_container_from_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.map_interface_args" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_interface_args
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.parse_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.path_hdf5cachefile_exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        path_hdf5cachefile_exists
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.rectangular_cutout_mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        rectangular_cutout_mask
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.return_cachefile_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_cachefile_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.return_hdf5cachepath" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_hdf5cachepath
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.str_is_float" class="md-nav__link">
    <span class="md-ellipsis">
      
        str_is_float
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.registries" class="md-nav__link">
    <span class="md-ellipsis">
      
        registries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.series" class="md-nav__link">
    <span class="md-ellipsis">
      
        series
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="series">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries" class="md-nav__link">
    <span class="md-ellipsis">
      
        DatasetSeries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetSeries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.data" class="md-nav__link">
    <span class="md-ellipsis">
      
        data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getitem__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init_subclass__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __len__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.get_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DirectoryCatalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        DirectoryCatalog
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DirectoryCatalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.DirectoryCatalog.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.HomogeneousSeries" class="md-nav__link">
    <span class="md-ellipsis">
      
        HomogeneousSeries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HomogeneousSeries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.HomogeneousSeries.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.delay_init" class="md-nav__link">
    <span class="md-ellipsis">
      
        delay_init
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.utilities.copy_to_zarr" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_to_zarr
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scida" class="md-nav__link">
    <span class="md-ellipsis">
      
        scida
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.config.combine_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        combine_configs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.copy_defaultconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_defaultconfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_config_fromfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_config_fromfile
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_config_fromfiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_config_fromfiles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.get_simulationconfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_simulationconfig
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.config.merge_dicts_recursively" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_dicts_recursively
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.convenience" class="md-nav__link">
    <span class="md-ellipsis">
      
        convenience
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="convenience">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.convenience.download_and_extract" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_and_extract
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.find_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_dataset_by_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset_by_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_dataset_candidates" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset_candidates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_datasets_by_props" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_datasets_by_props
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.get_testdata" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_testdata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.convenience.load" class="md-nav__link">
    <span class="md-ellipsis">
      
        load
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.customs" class="md-nav__link">
    <span class="md-ellipsis">
      
        customs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="customs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo" class="md-nav__link">
    <span class="md-ellipsis">
      
        arepo
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="arepo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG" class="md-nav__link">
    <span class="md-ellipsis">
      
        MTNG
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MTNG">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG.dataset.MTNGArepoCatalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        MTNGArepoCatalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.MTNG.dataset.MTNGArepoSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        MTNGArepoSnapshot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        TNGcluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TNGcluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster.dataset.TNGClusterSelector" class="md-nav__link">
    <span class="md-ellipsis">
      
        TNGClusterSelector
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.TNGcluster.dataset.TNGClusterSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        TNGClusterSnapshot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoCatalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoCatalog
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoCatalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoCatalog.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoCatalog.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoSnapshot
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoSnapshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.add_catalogIDs" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_catalogIDs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.add_groupquantity_to_particles" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_groupquantity_to_particles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.discover_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        discover_catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_grouplengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_grouplengths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_groupoffsets" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_groupoffsets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_subhalolengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_subhalolengths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.get_subhalooffsets" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_subhalooffsets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.grouped" class="md-nav__link">
    <span class="md-ellipsis">
      
        grouped
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.load_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.map_group_operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_group_operation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.register_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.return_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ArepoSnapshot.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ChainOps" class="md-nav__link">
    <span class="md-ellipsis">
      
        ChainOps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ChainOps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.ChainOps.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation" class="md-nav__link">
    <span class="md-ellipsis">
      
        GroupAwareOperation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GroupAwareOperation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.chain" class="md-nav__link">
    <span class="md-ellipsis">
      
        chain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.half" class="md-nav__link">
    <span class="md-ellipsis">
      
        half
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.max" class="md-nav__link">
    <span class="md-ellipsis">
      
        max
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.min" class="md-nav__link">
    <span class="md-ellipsis">
      
        min
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.GroupAwareOperation.sum" class="md-nav__link">
    <span class="md-ellipsis">
      
        sum
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.compute_haloindex" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_haloindex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.compute_haloquantity" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_haloquantity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.compute_localsubhaloindex" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_localsubhaloindex
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.get_hidx" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_hidx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.get_localshidx" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_localshidx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.get_shcounts_shcells" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_shcounts_shcells
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.map_group_operation" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_group_operation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.map_group_operation_get_chunkedges" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_group_operation_get_chunkedges
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.memorycost_limiter" class="md-nav__link">
    <span class="md-ellipsis">
      
        memorycost_limiter
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.dataset.wrap_func_scalar" class="md-nav__link">
    <span class="md-ellipsis">
      
        wrap_func_scalar
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.extra_fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        extra_fields
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="extra_fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.extra_fields.Temperature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Temperature
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.helpers" class="md-nav__link">
    <span class="md-ellipsis">
      
        helpers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.helpers.grp_type_str" class="md-nav__link">
    <span class="md-ellipsis">
      
        grp_type_str
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.helpers.part_type_num" class="md-nav__link">
    <span class="md-ellipsis">
      
        part_type_num
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector" class="md-nav__link">
    <span class="md-ellipsis">
      
        selector
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="selector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoSelector
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoSelector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector.select_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        select_group
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.selector.ArepoSelector.select_unbound" class="md-nav__link">
    <span class="md-ellipsis">
      
        select_unbound
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series" class="md-nav__link">
    <span class="md-ellipsis">
      
        series
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="series">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series.ArepoSimulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArepoSimulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ArepoSimulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series.ArepoSimulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.arepo.series.ArepoSimulation.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle" class="md-nav__link">
    <span class="md-ellipsis">
      
        gadgetstyle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="gadgetstyle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        GadgetStyleSnapshot
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GadgetStyleSnapshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.merge_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.merge_hints" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge_hints
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.register_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.series" class="md-nav__link">
    <span class="md-ellipsis">
      
        series
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="series">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.series.GadgetStyleSimulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        GadgetStyleSimulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GadgetStyleSimulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.customs.gadgetstyle.series.GadgetStyleSimulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.discovertypes" class="md-nav__link">
    <span class="md-ellipsis">
      
        discovertypes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discovertypes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.discovertypes.CandidateStatus" class="md-nav__link">
    <span class="md-ellipsis">
      
        CandidateStatus
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.discovertypes.is_valid_candidate" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_valid_candidate
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        fields
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.DerivedFieldRecipe" class="md-nav__link">
    <span class="md-ellipsis">
      
        DerivedFieldRecipe
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivedFieldRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.DerivedFieldRecipe.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldContainer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldContainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataframe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.fieldcount" class="md-nav__link">
    <span class="md-ellipsis">
      
        fieldcount
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.fieldlength" class="md-nav__link">
    <span class="md-ellipsis">
      
        fieldlength
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.add_alias" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_alias
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.add_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.copy" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.copy_skeleton" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_skeleton
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.get_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataframe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.get_ureg" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_ureg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.items" class="md-nav__link">
    <span class="md-ellipsis">
      
        items
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.merge" class="md-nav__link">
    <span class="md-ellipsis">
      
        merge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.register_field" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_field
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.remove_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.set_ureg" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_ureg
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldContainer.values" class="md-nav__link">
    <span class="md-ellipsis">
      
        values
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldRecipe" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldRecipe
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FieldRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldRecipe.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.FieldType" class="md-nav__link">
    <span class="md-ellipsis">
      
        FieldType
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.fields.walk_container" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_container
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.helpers_hdf5" class="md-nav__link">
    <span class="md-ellipsis">
      
        helpers_hdf5
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers_hdf5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.create_mergedhdf5file" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_mergedhdf5file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.get_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.walk_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_group
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.walk_hdf5file" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_hdf5file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_hdf5.walk_zarrfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        walk_zarrfile
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.helpers_misc" class="md-nav__link">
    <span class="md-ellipsis">
      
        helpers_misc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="helpers_misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.RecursiveNamespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        RecursiveNamespace
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RecursiveNamespace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.RecursiveNamespace.__elt" class="md-nav__link">
    <span class="md-ellipsis">
      
        __elt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.RecursiveNamespace.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.computedecorator" class="md-nav__link">
    <span class="md-ellipsis">
      
        computedecorator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.get_args" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_args
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.get_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_kwargs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.hash_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        hash_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.make_serializable" class="md-nav__link">
    <span class="md-ellipsis">
      
        make_serializable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.map_blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_blocks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.helpers_misc.sprint" class="md-nav__link">
    <span class="md-ellipsis">
      
        sprint
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        interface
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="interface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseDataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__dask_tokenize__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __dask_tokenize__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __hash__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init_subclass__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.return_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.BaseDataset.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.Dataset.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.DatasetWithUnitMixin" class="md-nav__link">
    <span class="md-ellipsis">
      
        DatasetWithUnitMixin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetWithUnitMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.DatasetWithUnitMixin.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.MixinMeta" class="md-nav__link">
    <span class="md-ellipsis">
      
        MixinMeta
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector" class="md-nav__link">
    <span class="md-ellipsis">
      
        Selector
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Selector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.finalize" class="md-nav__link">
    <span class="md-ellipsis">
      
        finalize
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.Selector.prepare" class="md-nav__link">
    <span class="md-ellipsis">
      
        prepare
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.interface.create_datasetclass_with_mixins" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_datasetclass_with_mixins
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.io" class="md-nav__link">
    <span class="md-ellipsis">
      
        io
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="io">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.io.fits" class="md-nav__link">
    <span class="md-ellipsis">
      
        fits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.io.fits.fitsrecords_to_daskarrays" class="md-nav__link">
    <span class="md-ellipsis">
      
        fitsrecords_to_daskarrays
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.misc" class="md-nav__link">
    <span class="md-ellipsis">
      
        misc
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="misc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.misc.check_config_for_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        check_config_for_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.deepdictkeycopy" class="md-nav__link">
    <span class="md-ellipsis">
      
        deepdictkeycopy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.get_container_from_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_container_from_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.map_interface_args" class="md-nav__link">
    <span class="md-ellipsis">
      
        map_interface_args
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.parse_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        parse_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.path_hdf5cachefile_exists" class="md-nav__link">
    <span class="md-ellipsis">
      
        path_hdf5cachefile_exists
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.rectangular_cutout_mask" class="md-nav__link">
    <span class="md-ellipsis">
      
        rectangular_cutout_mask
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.return_cachefile_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_cachefile_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.return_hdf5cachepath" class="md-nav__link">
    <span class="md-ellipsis">
      
        return_hdf5cachepath
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.misc.str_is_float" class="md-nav__link">
    <span class="md-ellipsis">
      
        str_is_float
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.registries" class="md-nav__link">
    <span class="md-ellipsis">
      
        registries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.series" class="md-nav__link">
    <span class="md-ellipsis">
      
        series
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="series">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries" class="md-nav__link">
    <span class="md-ellipsis">
      
        DatasetSeries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatasetSeries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.data" class="md-nav__link">
    <span class="md-ellipsis">
      
        data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getitem__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__init_subclass__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init_subclass__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __len__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_directory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.get_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DatasetSeries.validate_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_path
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.DirectoryCatalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        DirectoryCatalog
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DirectoryCatalog">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.DirectoryCatalog.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.HomogeneousSeries" class="md-nav__link">
    <span class="md-ellipsis">
      
        HomogeneousSeries
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HomogeneousSeries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.series.HomogeneousSeries.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scida.series.delay_init" class="md-nav__link">
    <span class="md-ellipsis">
      
        delay_init
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scida.utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scida.utilities.copy_to_zarr" class="md-nav__link">
    <span class="md-ellipsis">
      
        copy_to_zarr
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation">
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../base_api/" class="md-path__link">
          
  <span class="md-ellipsis">
    API
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="advanced-api">Advanced API</h1>
<p>For now, we list the remaining package documentation here.</p>


<div class="doc doc-object doc-module">



<a id="scida"></a>
    <div class="doc doc-contents first">

        <p>Scida is a python package for reading and analyzing scientific big data.</p>










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h2 id="scida.config" class="doc doc-heading">
            <code>config</code>


</h2>

    <div class="doc doc-contents ">

        <p>Configuration handling.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="scida.config.combine_configs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">combine_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'overwrite_keys'</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Combine multiple configurations recursively.
Replacing entries in the first config with entries from the latter</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>configs</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of configurations to combine.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mode</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mode for combining the configurations.
"overwrite_keys": overwrite keys in the first config with keys from the latter (default).
"overwrite_values": overwrite values in the first config with values from the latter.</p>
              </div>
            </td>
            <td>
                  <code>'overwrite_keys'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The combined configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">combine_configs</span><span class="p">(</span>
    <span class="n">configs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"overwrite_keys"</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Combine multiple configurations recursively.</span>
<span class="sd">    Replacing entries in the first config with entries from the latter</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    configs: list</span>
<span class="sd">        The list of configurations to combine.</span>
<span class="sd">    mode: str</span>
<span class="sd">        The mode for combining the configurations.</span>
<span class="sd">        "overwrite_keys": overwrite keys in the first config with keys from the latter (default).</span>
<span class="sd">        "overwrite_values": overwrite values in the first config with values from the latter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        The combined configuration.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"overwrite_values"</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">mergefunc_values</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""merge values"""</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span>
            <span class="k">return</span> <span class="n">b</span>  <span class="c1"># just overwrite by latter entry</span>

        <span class="n">mergefunc_keys</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"overwrite_keys"</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">mergefunc_keys</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""merge keys"""</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span>
            <span class="k">return</span> <span class="n">b</span>

        <span class="n">mergefunc_values</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown mode '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">merge_dicts_recursively</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">mergefunc_keys</span><span class="o">=</span><span class="n">mergefunc_keys</span><span class="p">,</span> <span class="n">mergefunc_values</span><span class="o">=</span><span class="n">mergefunc_values</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">conf</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.config.copy_defaultconfig" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_defaultconfig</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Copy the configuration example to the user's home directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Overwrite existing configuration file.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy_defaultconfig</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Copy the configuration example to the user's home directory.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    overwrite: bool</span>
<span class="sd">        Overwrite existing configuration file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>

    <span class="n">path_user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">"~"</span><span class="p">)</span>
    <span class="n">path_confdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_user</span><span class="p">,</span> <span class="s2">".config/scida"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_confdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_confdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">path_conf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_confdir</span><span class="p">,</span> <span class="s2">"config.yaml"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_conf</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Configuration file already exists at '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">path_conf</span><span class="p">)</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="s2">"scida.configfiles"</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">"config.yaml"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">resource</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_conf</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">newfile</span><span class="p">:</span>
            <span class="n">newfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.config.get_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config</span><span class="p">(</span><span class="n">reload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">update_global</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load the configuration from the default path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reload</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reload the configuration, even if it has already been loaded.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_global</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Update the global configuration dictionary.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config</span><span class="p">(</span><span class="n">reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">update_global</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Load the configuration from the default path.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reload: bool</span>
<span class="sd">        Reload the configuration, even if it has already been loaded.</span>
<span class="sd">    update_global: bool</span>
<span class="sd">        Update the global configuration dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        The configuration dictionary.</span>
<span class="sd">    """</span>
    <span class="k">global</span> <span class="n">_conf</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">"SCIDA_"</span>
    <span class="n">envconf</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1"># in any case, we make sure that there is some config in the default path.</span>
    <span class="n">path_confdir</span> <span class="o">=</span> <span class="n">_access_confdir</span><span class="p">()</span>
    <span class="n">path_conf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_confdir</span><span class="p">,</span> <span class="s2">"config.yaml"</span><span class="p">)</span>

    <span class="c1"># next, we load the config from the default path, unless explicitly overridden.</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">envconf</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"config_path"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path_conf</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">reload</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_conf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_conf</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config_fromfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"copied_default"</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">"Warning! Using default configuration. Please adjust/replace in '</span><span class="si">%s</span><span class="s2">'."</span>
            <span class="o">%</span> <span class="n">path</span>
        <span class="p">)</span>

    <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">envconf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">update_global</span><span class="p">:</span>
        <span class="n">_conf</span> <span class="o">=</span> <span class="n">config</span>
    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.config.get_config_fromfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config_fromfile</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load config from a YAML file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>resource</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the resource or file path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config_fromfile</span><span class="p">(</span><span class="n">resource</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Load config from a YAML file.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resource</span>
<span class="sd">        The name of the resource or file path.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Config name cannot be empty."</span><span class="p">)</span>
    <span class="c1"># order (in descending order of priority):</span>
    <span class="c1"># 1. absolute path?</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="c1"># 2. non-absolute path?</span>
    <span class="c1"># 2.1. check local (project-specific) path</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">resource</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="c1"># 2.2. check ~/.config/scida/</span>
    <span class="n">bpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">"~/.config/scida"</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bpath</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
    <span class="c1"># 2.3. check scida package resources</span>
    <span class="n">resource_path</span> <span class="o">=</span> <span class="s2">"scida.configfiles"</span>
    <span class="n">resource_elements</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
    <span class="n">rname</span> <span class="o">=</span> <span class="n">resource_elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">resource_path</span> <span class="o">+=</span> <span class="s2">"."</span> <span class="o">+</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource_elements</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">files</span><span class="p">(</span><span class="n">resource_path</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">rname</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">resource</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.config.get_config_fromfiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config_fromfiles</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">subconf_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load and merge multiple YAML config files</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>paths</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paths to the config files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subconf_keys</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The keys to the correct sub configuration within each config.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config_fromfiles</span><span class="p">(</span>
    <span class="n">paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">subconf_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Load and merge multiple YAML config files</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    paths</span>
<span class="sd">        Paths to the config files.</span>
<span class="sd">    subconf_keys</span>
<span class="sd">        The keys to the correct sub configuration within each config.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">confs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_config_fromfile</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">confdict</span> <span class="ow">in</span> <span class="n">confs</span><span class="p">:</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">merge_dicts_recursively</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">confdict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">conf</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.config.get_simulationconfig" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_simulationconfig</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the simulation configuration.
Search regular user config file, scida simulation config file, and user's simulation config file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The simulation configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_simulationconfig</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the simulation configuration.</span>
<span class="sd">    Search regular user config file, scida simulation config file, and user's simulation config file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        The simulation configuration.</span>
<span class="sd">    """</span>
    <span class="n">conf_user</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="n">conf_sims</span> <span class="o">=</span> <span class="n">get_config_fromfile</span><span class="p">(</span><span class="s2">"simulations.yaml"</span><span class="p">)</span>
    <span class="n">conf_sims_user</span> <span class="o">=</span> <span class="n">_get_simulationconfig_user</span><span class="p">()</span>

    <span class="n">confs_base</span> <span class="o">=</span> <span class="p">[</span><span class="n">conf_sims</span><span class="p">,</span> <span class="n">conf_user</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">conf_sims_user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">confs_base</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_sims_user</span><span class="p">)</span>
    <span class="c1"># we only want to overwrite keys within "data", otherwise no merging of simkeys would take place</span>
    <span class="n">confs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">confs_base</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"data"</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">confs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">"data"</span><span class="p">])</span>

    <span class="n">conf_sims</span> <span class="o">=</span> <span class="n">combine_configs</span><span class="p">(</span><span class="n">confs</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"overwrite_keys"</span><span class="p">)</span>
    <span class="n">conf_sims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"data"</span><span class="p">:</span> <span class="n">conf_sims</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">conf_sims</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.config.merge_dicts_recursively" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_dicts_recursively</span><span class="p">(</span><span class="n">dict_a</span><span class="p">,</span> <span class="n">dict_b</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mergefunc_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mergefunc_values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Merge two dictionaries recursively.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dict_a</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dict_b</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the current node.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mergefunc_keys</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>], <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The function to use for merging dict keys.
If None, we recursively enter the dictionary.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mergefunc_values</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span>[[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>], <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The function to use for merging dict values.
If None, collisions will raise an exception.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/config.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_dicts_recursively</span><span class="p">(</span>
    <span class="n">dict_a</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">dict_b</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mergefunc_keys</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mergefunc_values</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Merge two dictionaries recursively.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dict_a</span>
<span class="sd">        The first dictionary.</span>
<span class="sd">    dict_b</span>
<span class="sd">        The second dictionary.</span>
<span class="sd">    path</span>
<span class="sd">        The path to the current node.</span>
<span class="sd">    mergefunc_keys: callable</span>
<span class="sd">        The function to use for merging dict keys.</span>
<span class="sd">        If None, we recursively enter the dictionary.</span>
<span class="sd">    mergefunc_values: callable</span>
<span class="sd">        The function to use for merging dict values.</span>
<span class="sd">        If None, collisions will raise an exception.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_b</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_a</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mergefunc_keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergefunc_keys</span><span class="p">(</span><span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict_b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_b</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">merge_dicts_recursively</span><span class="p">(</span>
                    <span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">dict_b</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)],</span>
                    <span class="n">mergefunc_keys</span><span class="o">=</span><span class="n">mergefunc_keys</span><span class="p">,</span>
                    <span class="n">mergefunc_values</span><span class="o">=</span><span class="n">mergefunc_values</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">dict_b</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">pass</span>  <span class="c1"># same leaf value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mergefunc_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergefunc_values</span><span class="p">(</span><span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict_b</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Conflict at </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="s2">"."</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_b</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dict_a</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.convenience" class="doc doc-heading">
            <code>convenience</code>


</h2>

    <div class="doc doc-contents ">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="scida.convenience.download_and_extract" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_and_extract</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download and extract a tar.gz archive from a given url.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>url</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The url to download from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to download to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progressbar</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a progress bar.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite an existing file.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the extracted file(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">download_and_extract</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">progressbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Download and extract a tar.gz archive from a given url.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url: str</span>
<span class="sd">        The url to download from.</span>
<span class="sd">    path: pathlib.Path</span>
<span class="sd">        The path to download to.</span>
<span class="sd">    progressbar: bool</span>
<span class="sd">        Whether to show a progress bar.</span>
<span class="sd">    overwrite: bool</span>
<span class="sd">        Whether to overwrite an existing file.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The path to the extracted file(s).</span>
<span class="sd">    """</span>
    <span class="n">_download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">=</span><span class="n">progressbar</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"r:gz"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">isdir</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">"0755"</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">"0644"</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="c1"># if python version &gt;= 3.12, need filter argument (required from 3.14 onwards)</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">):</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">filter</span><span class="o">=</span><span class="s2">"fully_trusted"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">foldername</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># parent folder of extracted tar.gz</span>
    <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">foldername</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.find_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Find path to dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only for remote datasets. Whether to overwrite an existing download.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Find path to dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">    overwrite: bool</span>
<span class="sd">        Only for remote datasets. Whether to overwrite an existing download.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>

<span class="sd">    """</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># datasets on disk</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># check different alternative backends</span>
        <span class="n">databackend</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"://"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dataname</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"://"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">databackend</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"http"</span><span class="p">,</span> <span class="s2">"https"</span><span class="p">]:</span>
            <span class="c1"># dataset on the internet</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"download_path"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">savepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">"Have not specified 'download_path' in config. Using 'cache_path' instead."</span>
                <span class="p">)</span>
                <span class="n">savepath</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"cache_path"</span><span class="p">)</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
            <span class="n">savepath</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">urlhash</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="mi">8</span>
            <span class="p">)</span>
            <span class="n">savepath</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">/</span> <span class="p">(</span><span class="s2">"download"</span> <span class="o">+</span> <span class="n">urlhash</span><span class="p">)</span>
            <span class="c1"># determine filename and whether this is an archive</span>
            <span class="n">url_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"?"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">))</span>
            <span class="n">is_archive</span> <span class="o">=</span> <span class="n">url_basename</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">".tar.gz"</span><span class="p">,</span> <span class="s2">".tgz"</span><span class="p">))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">"archive.tar.gz"</span> <span class="k">if</span> <span class="n">is_archive</span> <span class="k">else</span> <span class="p">(</span><span class="n">url_basename</span> <span class="ow">or</span> <span class="s2">"download"</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">savepath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="c1"># delete all files in folder</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
                    <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="n">foldercontent</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">savepath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">foldercontent</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">savepath</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="k">if</span> <span class="n">is_archive</span><span class="p">:</span>
                    <span class="n">extractpath</span> <span class="o">=</span> <span class="n">download_and_extract</span><span class="p">(</span>
                        <span class="n">path</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_download</span><span class="p">(</span>
                        <span class="n">path</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">progressbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
                    <span class="p">)</span>
                    <span class="n">extractpath</span> <span class="o">=</span> <span class="n">savepath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extractpath</span> <span class="o">=</span> <span class="n">savepath</span>
            <span class="n">extractpath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">extractpath</span><span class="p">)</span>

            <span class="c1"># count folders in savepath</span>
            <span class="n">nfolders</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extractpath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()])</span>
            <span class="n">nobjects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extractpath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()])</span>
            <span class="k">if</span> <span class="n">nobjects</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nfolders</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">extractpath</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">extractpath</span> <span class="o">/</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extractpath</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">extractpath</span>
        <span class="k">elif</span> <span class="n">databackend</span> <span class="o">==</span> <span class="s2">"testdata"</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">get_testdata</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># potentially custom dataset.</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"resources"</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">databackend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown resource '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">databackend</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">resources</span><span class="p">[</span><span class="n">databackend</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dataname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Unknown dataset '</span><span class="si">%s</span><span class="s2">' in resource '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="p">(</span><span class="n">dataname</span><span class="p">,</span> <span class="n">databackend</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">dataname</span><span class="p">][</span><span class="s2">"path"</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">"datafolders"</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">"datafolders"</span><span class="p">]:</span>
                <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">path</span><span class="p">)):</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' unknown."</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.get_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get dataset by name or properties.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name or alias of dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>props</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Properties to match.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get dataset by name or properties.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str | None</span>
<span class="sd">        Name or alias of dataset.</span>
<span class="sd">    props: dict | None</span>
<span class="sd">        Properties to match.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str:</span>
<span class="sd">        Dataset name.</span>

<span class="sd">    """</span>
    <span class="n">dnames</span> <span class="o">=</span> <span class="n">get_dataset_candidates</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dnames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Too many dataset candidates."</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dnames</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No dataset candidate found."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.get_dataset_by_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataset_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get dataset name from alias or name found in the configuration files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name or alias of dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get dataset name from alias or name found in the configuration files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">        Name or alias of dataset.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">dname</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">"datasets"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dname</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">"datasets"</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="n">dname</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># could still be an alias</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">"aliases"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="s2">"aliases"</span><span class="p">]:</span>
                <span class="n">dname</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">dname</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.get_dataset_candidates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataset_candidates</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get dataset candidates by name or properties.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name or alias of dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>props</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Properties to match.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[str]:</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of candidate dataset names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_candidates</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get dataset candidates by name or properties.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str | None</span>
<span class="sd">        Name or alias of dataset.</span>
<span class="sd">    props: dict | None</span>
<span class="sd">        Properties to match.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]:</span>
<span class="sd">        List of candidate dataset names.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_dataset_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">dnames</span>
    <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dnames</span> <span class="o">=</span> <span class="n">get_datasets_by_props</span><span class="p">(</span><span class="o">**</span><span class="n">props</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dnames</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Need to specify name or properties."</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.get_datasets_by_props" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_datasets_by_props</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get dataset names by properties.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Properties to match.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[str]:</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dataset names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_datasets_by_props</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get dataset names by properties.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kwargs: dict</span>
<span class="sd">        Properties to match.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]:</span>
<span class="sd">        List of dataset names.</span>
<span class="sd">    """</span>
    <span class="n">dnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">"datasets"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dnames</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="s2">"datasets"</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"properties"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">pk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">props</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">props</span><span class="p">[</span><span class="n">pk</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pv</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">dnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dnames</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.get_testdata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_testdata</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get path to test data identifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of test data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_testdata</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get path to test data identifier.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">        Name of test data.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="n">tdpath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"testdata_path"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tdpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Test data directory not specified in configuration"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tdpath</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid test data path"</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tdpath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tdpath</span><span class="p">)}</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified test data not available."</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.convenience.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unitfile</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load a dataset or dataset series from a given path.
This function will automatically determine the best-matching
class to use and return the initialized instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to dataset or dataset series. Usually the base folder containing all files of a given dataset/series.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>units</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to load units.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unitfile</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Can explicitly pass path to a unitfile to use.</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite an existing cache.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_class</code>
            </td>
            <td>
                  <code><span title="type">type</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Force a specific class to be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments to pass to the class.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Union[Dataset, DatasetSeries]:</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initialized dataset or dataset series.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/convenience.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">unitfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">force_class</span><span class="p">:</span> <span class="nb">type</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseDataset</span> <span class="o">|</span> <span class="n">DatasetSeries</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Load a dataset or dataset series from a given path.</span>
<span class="sd">    This function will automatically determine the best-matching</span>
<span class="sd">    class to use and return the initialized instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to dataset or dataset series. Usually the base folder containing all files of a given dataset/series.</span>
<span class="sd">    units: bool</span>
<span class="sd">        Whether to load units.</span>
<span class="sd">    unitfile: str</span>
<span class="sd">        Can explicitly pass path to a unitfile to use.</span>
<span class="sd">    overwrite: bool</span>
<span class="sd">        Whether to overwrite an existing cache.</span>
<span class="sd">    force_class: object</span>
<span class="sd">        Force a specific class to be used.</span>
<span class="sd">    kwargs: dict</span>
<span class="sd">        Additional keyword arguments to pass to the class.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Union[Dataset, DatasetSeries]:</span>
<span class="sd">        Initialized dataset or dataset series.</span>
<span class="sd">    """</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">find_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">"catalog"</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"catalog"</span><span class="p">]</span>
        <span class="n">query_path</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">query_path</span> <span class="o">&amp;=</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">query_path</span> <span class="o">&amp;=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="n">query_path</span> <span class="o">&amp;=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">query_path</span> <span class="o">&amp;=</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">"none"</span>
        <span class="k">if</span> <span class="n">query_path</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">"catalog"</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_path</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

    <span class="c1"># determine dataset class</span>
    <span class="n">reg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">dataset_type_registry</span><span class="p">)</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">dataseries_type_registry</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">_determine_type</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Dataset is identified as '</span><span class="si">%s</span><span class="s2">' via _determine_type."</span> <span class="o">%</span> <span class="bp">cls</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># any identifying metadata?</span>
    <span class="n">classtype</span> <span class="o">=</span> <span class="s2">"dataset"</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">DatasetSeries</span><span class="p">):</span>
        <span class="n">classtype</span> <span class="o">=</span> <span class="s2">"series"</span>
    <span class="n">cls_simconf</span> <span class="o">=</span> <span class="n">_determine_type_from_simconfig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">classtype</span><span class="o">=</span><span class="n">classtype</span><span class="p">,</span> <span class="n">reg</span><span class="o">=</span><span class="n">reg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cls_simconf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cls_simconf</span><span class="p">):</span>
        <span class="n">oldcls</span> <span class="o">=</span> <span class="bp">cls</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">cls_simconf</span>
        <span class="k">if</span> <span class="n">oldcls</span> <span class="o">!=</span> <span class="bp">cls</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Dataset is identified as '</span><span class="si">%s</span><span class="s2">' via the simulation config replacing prior candidate '</span><span class="si">%s</span><span class="s2">'."</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">oldcls</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Dataset is identified as '</span><span class="si">%s</span><span class="s2">' via the simulation config, identical to prior candidate."</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">cls</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">force_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">force_class</span>

    <span class="c1"># determine additional mixins not set by class</span>
    <span class="n">mixins</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">"_unitfile"</span><span class="p">):</span>
        <span class="n">unitfile</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unitfile</span>
    <span class="k">if</span> <span class="n">unitfile</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">units</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"unitfile"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unitfile</span>

    <span class="k">if</span> <span class="n">units</span><span class="p">:</span>
        <span class="n">mixins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UnitMixin</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"units"</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Inconsistent overwrite_cache, please only use 'overwrite' in load()."</span>
    <span class="k">assert</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"overwrite_cache"</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span> <span class="o">==</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">msg</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">"overwrite_cache"</span><span class="p">]</span> <span class="o">=</span> <span class="n">overwrite</span>

    <span class="c1"># we append since unit mixin is added outside of this func right now</span>
    <span class="n">metadata_raw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">classtype</span> <span class="o">==</span> <span class="s2">"dataset"</span><span class="p">:</span>
        <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fileprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">other_mixins</span> <span class="o">=</span> <span class="n">_determine_mixins</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">metadata_raw</span><span class="o">=</span><span class="n">metadata_raw</span><span class="p">)</span>
    <span class="n">mixins</span> <span class="o">+=</span> <span class="n">other_mixins</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Adding mixins '</span><span class="si">%s</span><span class="s2">' to dataset."</span> <span class="o">%</span> <span class="n">mixins</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">"_mixins"</span><span class="p">):</span>
        <span class="n">cls_mixins</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_mixins</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cls_mixins</span><span class="p">:</span>
            <span class="c1"># remove duplicates</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">:</span>
                <span class="n">mixins</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mixins</span><span class="o">=</span><span class="n">mixins</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.customs" class="doc doc-heading">
            <code>customs</code>


</h2>

    <div class="doc doc-contents ">










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h3 id="scida.customs.arepo" class="doc doc-heading">
            <code>arepo</code>


</h3>

    <div class="doc doc-contents ">










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.MTNG" class="doc doc-heading">
            <code>MTNG</code>


</h4>

    <div class="doc doc-contents ">










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h5 id="scida.customs.arepo.MTNG.dataset" class="doc doc-heading">
            <code>dataset</code>


</h5>

    <div class="doc doc-contents ">

        <p>Support for MTNG-Arepo datasets, see https://www.mtng-project.org/</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h6 id="scida.customs.arepo.MTNG.dataset.MTNGArepoCatalog" class="doc doc-heading">
            <code>MTNGArepoCatalog</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ArepoCatalog (scida.customs.arepo.dataset.ArepoCatalog)" href="#scida.customs.arepo.dataset.ArepoCatalog">ArepoCatalog</a></code></p>



        <p>A dataset representing a MTNG-Arepo catalog.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/MTNG/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MTNGArepoCatalog</span><span class="p">(</span><span class="n">ArepoCatalog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A dataset representing a MTNG-Arepo catalog.</span>
<span class="sd">    """</span>

    <span class="n">_fileprefix</span> <span class="o">=</span> <span class="s2">"fof_subhalo_tab"</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize an MTNGArepoCatalog object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>
<span class="sd">        """</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"iscatalog"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">"fileprefix"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"fof_subhalo_tab"</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"choose_prefix"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate a path as a candidate for the MTNG-Arepo catalog class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to validate.</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">            Whether the path is a candidate for this dataset class.</span>
<span class="sd">        """</span>
        <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fileprefix</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">)</span>
        <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid</span>
        <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">"/Config"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">if</span> <span class="s2">"MTNG"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Config"</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.MTNG.dataset.MTNGArepoCatalog.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Initialize an MTNGArepoCatalog object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/MTNG/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize an MTNGArepoCatalog object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>
<span class="sd">    """</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">"iscatalog"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">"fileprefix"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"fof_subhalo_tab"</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">"choose_prefix"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.MTNG.dataset.MTNGArepoCatalog.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Validate a path as a candidate for the MTNG-Arepo catalog class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the path is a candidate for this dataset class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/MTNG/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate a path as a candidate for the MTNG-Arepo catalog class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to validate.</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">        Whether the path is a candidate for this dataset class.</span>
<span class="sd">    """</span>
    <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fileprefix</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">)</span>
    <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid</span>
    <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">"/Config"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">if</span> <span class="s2">"MTNG"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Config"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="scida.customs.arepo.MTNG.dataset.MTNGArepoSnapshot" class="doc doc-heading">
            <code>MTNGArepoSnapshot</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ArepoSnapshot (scida.customs.arepo.dataset.ArepoSnapshot)" href="#scida.customs.arepo.dataset.ArepoSnapshot">ArepoSnapshot</a></code></p>



        <p>MTNGArepoSnapshot is a snapshot class for the MTNG project.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/MTNG/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MTNGArepoSnapshot</span><span class="p">(</span><span class="n">ArepoSnapshot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    MTNGArepoSnapshot is a snapshot class for the MTNG project.</span>
<span class="sd">    """</span>

    <span class="n">_fileprefix_catalog</span> <span class="o">=</span> <span class="s2">"fof_subhalo_tab"</span>
    <span class="n">_fileprefix</span> <span class="o">=</span> <span class="s2">"snapshot_"</span>  <span class="c1"># underscore is important!</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize an MTNGArepoSnapshot object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to the snapshot folder, should contain "output" folder.</span>
<span class="sd">        chunksize: int</span>
<span class="sd">            Chunksize for the data.</span>
<span class="sd">        catalog: str</span>
<span class="sd">            Explicitly state catalog path to use.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Additional keyword arguments.</span>
<span class="sd">        """</span>
        <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">fileprefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">,</span>
            <span class="n">fileprefix_catalog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileprefix_catalog</span><span class="p">,</span>
            <span class="n">catalog_cls</span><span class="o">=</span><span class="n">MTNGArepoCatalog</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># in MTNG, we have two kinds of snapshots:</span>
        <span class="c1"># 1. regular (prefix: "snapshot_"), contains all particle types</span>
        <span class="c1"># 2. mostbound (prefix: "snapshot-prevmostboundonly_"), only contains DM particles</span>
        <span class="c1"># Most snapshots are of type 2, but some selected snapshots have type 1 and type 2.</span>

        <span class="c1"># attempt to load regular snapshot</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="c1"># need to add mtng unit peculiarities</span>
        <span class="c1"># later unit file takes precedence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultunitfiles</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">"units/mtng.yaml"</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">tkwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"snapshot-prevmostboundonly_"</span><span class="p">:</span>
            <span class="c1"># this is a mostbound snapshot, so we are done</span>
            <span class="k">return</span>

        <span class="c1"># next, attempt to load mostbound snapshot. This is done by loading into sub-object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fileprefix</span><span class="o">=</span><span class="s2">"snapshot-prevmostboundonly_"</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span> <span class="o">=</span> <span class="n">MTNGArepoSnapshot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="c1"># hacky: remove unused containers from mostbound snapshot</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">"PartType0"</span><span class="p">,</span>
            <span class="s2">"PartType2"</span><span class="p">,</span>
            <span class="s2">"PartType3"</span><span class="p">,</span>
            <span class="s2">"PartType4"</span><span class="p">,</span>
            <span class="s2">"PartType5"</span><span class="p">,</span>
            <span class="s2">"Group"</span><span class="p">,</span>
            <span class="s2">"Subhalo"</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span><span class="p">,</span> <span class="n">fieldname_suffix</span><span class="o">=</span><span class="s2">"_mostbound"</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate a path as a candidate for the MTNG-Arepo snapshot class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path:</span>
<span class="sd">            Path to validate.</span>
<span class="sd">        args:  list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">            Whether the path is a candidate for this dataset class.</span>

<span class="sd">        """</span>
        <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">fileprefix</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">,</span> <span class="n">fileprefix_catalog</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix_catalog</span>
        <span class="p">)</span>
        <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
            <span class="c1"># might raise ValueError in case of partial snap</span>

        <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
            <span class="c1"># check for partial snap</span>
            <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fileprefix</span><span class="o">=</span><span class="s2">"snapshot-prevmostboundonly_"</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>

        <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid</span>
        <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">"/Config"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">if</span> <span class="s2">"MTNG"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Config"</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">if</span> <span class="s2">"Ngroups_Total"</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>  <span class="c1"># this is a catalog</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.MTNG.dataset.MTNGArepoSnapshot.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Initialize an MTNGArepoSnapshot object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the snapshot folder, should contain "output" folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunksize for the data.</p>
              </div>
            </td>
            <td>
                  <code>'auto'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>catalog</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Explicitly state catalog path to use.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/MTNG/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize an MTNGArepoSnapshot object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to the snapshot folder, should contain "output" folder.</span>
<span class="sd">    chunksize: int</span>
<span class="sd">        Chunksize for the data.</span>
<span class="sd">    catalog: str</span>
<span class="sd">        Explicitly state catalog path to use.</span>
<span class="sd">    kwargs:</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    """</span>
    <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">fileprefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">,</span>
        <span class="n">fileprefix_catalog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileprefix_catalog</span><span class="p">,</span>
        <span class="n">catalog_cls</span><span class="o">=</span><span class="n">MTNGArepoCatalog</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># in MTNG, we have two kinds of snapshots:</span>
    <span class="c1"># 1. regular (prefix: "snapshot_"), contains all particle types</span>
    <span class="c1"># 2. mostbound (prefix: "snapshot-prevmostboundonly_"), only contains DM particles</span>
    <span class="c1"># Most snapshots are of type 2, but some selected snapshots have type 1 and type 2.</span>

    <span class="c1"># attempt to load regular snapshot</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="n">catalog</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="c1"># need to add mtng unit peculiarities</span>
    <span class="c1"># later unit file takes precedence</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defaultunitfiles</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">"units/mtng.yaml"</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">tkwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"snapshot-prevmostboundonly_"</span><span class="p">:</span>
        <span class="c1"># this is a mostbound snapshot, so we are done</span>
        <span class="k">return</span>

    <span class="c1"># next, attempt to load mostbound snapshot. This is done by loading into sub-object.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fileprefix</span><span class="o">=</span><span class="s2">"snapshot-prevmostboundonly_"</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span> <span class="o">=</span> <span class="n">MTNGArepoSnapshot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="c1"># hacky: remove unused containers from mostbound snapshot</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">"PartType0"</span><span class="p">,</span>
        <span class="s2">"PartType2"</span><span class="p">,</span>
        <span class="s2">"PartType3"</span><span class="p">,</span>
        <span class="s2">"PartType4"</span><span class="p">,</span>
        <span class="s2">"PartType5"</span><span class="p">,</span>
        <span class="s2">"Group"</span><span class="p">,</span>
        <span class="s2">"Subhalo"</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mostbound</span><span class="p">,</span> <span class="n">fieldname_suffix</span><span class="o">=</span><span class="s2">"_mostbound"</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.MTNG.dataset.MTNGArepoSnapshot.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Validate a path as a candidate for the MTNG-Arepo snapshot class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the path is a candidate for this dataset class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/MTNG/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate a path as a candidate for the MTNG-Arepo snapshot class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path:</span>
<span class="sd">        Path to validate.</span>
<span class="sd">    args:  list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">        Whether the path is a candidate for this dataset class.</span>

<span class="sd">    """</span>
    <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">fileprefix</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">,</span> <span class="n">fileprefix_catalog</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix_catalog</span>
    <span class="p">)</span>
    <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="c1"># might raise ValueError in case of partial snap</span>

    <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
        <span class="c1"># check for partial snap</span>
        <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fileprefix</span><span class="o">=</span><span class="s2">"snapshot-prevmostboundonly_"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>

    <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid</span>
    <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">"/Config"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">if</span> <span class="s2">"MTNG"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Config"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">if</span> <span class="s2">"Ngroups_Total"</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>  <span class="c1"># this is a catalog</span>
    <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.TNGcluster" class="doc doc-heading">
            <code>TNGcluster</code>


</h4>

    <div class="doc doc-contents ">










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h5 id="scida.customs.arepo.TNGcluster.dataset" class="doc doc-heading">
            <code>dataset</code>


</h5>

    <div class="doc doc-contents ">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h6 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSelector" class="doc doc-heading">
            <code>TNGClusterSelector</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Selector (scida.interface.Selector)" href="#scida.interface.Selector">Selector</a></code></p>



        <p>Selector for TNGClusterSnapshot.  Can select for zoomID, which selects a given zoom target.
Can specify withfuzz=True to include the "fuzz" particles for a given zoom target.
Can specify onlyfuzz=True to only return the "fuzz" particles for a given zoom target.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TNGClusterSelector</span><span class="p">(</span><span class="n">Selector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Selector for TNGClusterSnapshot.  Can select for zoomID, which selects a given zoom target.</span>
<span class="sd">    Can specify withfuzz=True to include the "fuzz" particles for a given zoom target.</span>
<span class="sd">    Can specify onlyfuzz=True to only return the "fuzz" particles for a given zoom target.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize the selector.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"zoomID"</span><span class="p">,</span> <span class="s2">"withfuzz"</span><span class="p">,</span> <span class="s2">"onlyfuzz"</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Prepare the selector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">snap</span><span class="p">:</span> <span class="n">TNGClusterSnapshot</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zoom_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"zoomID"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fuzz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"withfuzz"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">onlyfuzz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"onlylfuzz"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zoom_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">zoom_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">zoom_id</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"zoomID must be in range 0-</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">"particles"</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="s2">"Group"</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">"groups"</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="s2">"Subhalo"</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">"subgroups"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span><span class="p">]</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span><span class="p">]</span>
            <span class="n">length_fuzz</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">offset_fuzz</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">fuzz</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"particles"</span><span class="p">:</span>  <span class="c1"># fuzz files only for particles</span>
                <span class="n">lengths_fuzz</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span> <span class="o">+</span> <span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span><span class="p">]</span>
                <span class="n">offsets_fuzz</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span> <span class="o">+</span> <span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span><span class="p">]</span>

                <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
                <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">offset_fuzz</span> <span class="o">=</span> <span class="n">offsets_fuzz</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
                <span class="n">length_fuzz</span> <span class="o">=</span> <span class="n">lengths_fuzz</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"particles"</span><span class="p">:</span>
                <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
                <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">lengths</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">get_slicedarr</span><span class="p">(</span>
                <span class="n">v</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Get a sliced dask array for a given (length, offset) and (length_fuzz, offset_fuzz).</span>

<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                v: da.Array</span>
<span class="sd">                    The array to slice.</span>
<span class="sd">                offset: int</span>
<span class="sd">                length: int</span>
<span class="sd">                offset_fuzz: int</span>
<span class="sd">                length_fuzz: int</span>
<span class="sd">                key: str</span>
<span class="sd">                    ?</span>
<span class="sd">                fuzz: bool</span>

<span class="sd">                Returns</span>
<span class="sd">                -------</span>
<span class="sd">                da.Array</span>
<span class="sd">                    The sliced array.</span>
<span class="sd">                """</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">offset_fuzz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">arr_fuzz</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset_fuzz</span> <span class="p">:</span> <span class="n">offset_fuzz</span> <span class="o">+</span> <span class="n">length_fuzz</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">onlyfuzz</span><span class="p">:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr_fuzz</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr_fuzz</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">arr</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">get_slicedfunc</span><span class="p">(</span>
                <span class="n">func</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Slice a functions output for a given (length, offset) and (length_fuzz, offset_fuzz).</span>

<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                func: callable</span>
<span class="sd">                offset: int</span>
<span class="sd">                length: int</span>
<span class="sd">                offset_fuzz: int</span>
<span class="sd">                length_fuzz: int</span>
<span class="sd">                key: str</span>
<span class="sd">                fuzz: bool</span>

<span class="sd">                Returns</span>
<span class="sd">                -------</span>
<span class="sd">                callable</span>
<span class="sd">                    The sliced function.</span>
<span class="sd">                """</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">newfunc</span><span class="p">(</span>
                    <span class="n">arrs</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">of</span><span class="o">=</span><span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">lnf</span><span class="o">=</span><span class="n">length_fuzz</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">):</span>
                    <span class="n">arr_all</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr_all</span><span class="p">[</span><span class="n">o</span> <span class="p">:</span> <span class="n">o</span> <span class="o">+</span> <span class="n">ln</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">of</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">arr</span>
                    <span class="n">arr_fuzz</span> <span class="o">=</span> <span class="n">arr_all</span><span class="p">[</span><span class="n">of</span> <span class="p">:</span> <span class="n">of</span> <span class="o">+</span> <span class="n">lnf</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">onlyfuzz</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">arr_fuzz</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr_fuzz</span><span class="p">])</span>

                <span class="k">return</span> <span class="n">newfunc</span>

            <span class="c1"># need to evaluate without recipes first</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">withrecipes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_slicedarr</span><span class="p">(</span>
                    <span class="n">v</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(</span>
                <span class="n">withfields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">FieldRecipe</span><span class="p">):</span>
                    <span class="k">continue</span>  <span class="c1"># already evaluated, no need to port recipe (?)</span>
                <span class="n">rcp</span><span class="p">:</span> <span class="n">FieldRecipe</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">get_slicedfunc</span><span class="p">(</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span>
                <span class="p">)</span>
                <span class="n">newrcp</span> <span class="o">=</span> <span class="n">DerivedFieldRecipe</span><span class="p">(</span><span class="n">rcp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="n">newrcp</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">rcp</span><span class="o">.</span><span class="n">type</span>
                <span class="n">newrcp</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">rcp</span><span class="o">.</span><span class="n">description</span>
                <span class="n">newrcp</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">rcp</span><span class="o">.</span><span class="n">units</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">newrcp</span>
        <span class="n">snap</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSelector.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Initialize the selector.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize the selector.</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"zoomID"</span><span class="p">,</span> <span class="s2">"withfuzz"</span><span class="p">,</span> <span class="s2">"onlyfuzz"</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSelector.prepare" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Prepare the selector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Prepare the selector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">snap</span><span class="p">:</span> <span class="n">TNGClusterSnapshot</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">zoom_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"zoomID"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fuzz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"withfuzz"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">onlyfuzz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"onlylfuzz"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zoom_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">zoom_id</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">zoom_id</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"zoomID must be in range 0-</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">"particles"</span>
        <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="s2">"Group"</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">"groups"</span>
        <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="s2">"Subhalo"</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">"subgroups"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span><span class="p">]</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span><span class="p">]</span>
        <span class="n">length_fuzz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">offset_fuzz</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">fuzz</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"particles"</span><span class="p">:</span>  <span class="c1"># fuzz files only for particles</span>
            <span class="n">lengths_fuzz</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span> <span class="o">+</span> <span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span><span class="p">]</span>
            <span class="n">offsets_fuzz</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">zoom_id</span> <span class="o">+</span> <span class="n">snap</span><span class="o">.</span><span class="n">ntargets</span><span class="p">]</span>

            <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
            <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">offset_fuzz</span> <span class="o">=</span> <span class="n">offsets_fuzz</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
            <span class="n">length_fuzz</span> <span class="o">=</span> <span class="n">lengths_fuzz</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"particles"</span><span class="p">:</span>
            <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
            <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">lengths</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_slicedarr</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Get a sliced dask array for a given (length, offset) and (length_fuzz, offset_fuzz).</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            v: da.Array</span>
<span class="sd">                The array to slice.</span>
<span class="sd">            offset: int</span>
<span class="sd">            length: int</span>
<span class="sd">            offset_fuzz: int</span>
<span class="sd">            length_fuzz: int</span>
<span class="sd">            key: str</span>
<span class="sd">                ?</span>
<span class="sd">            fuzz: bool</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            da.Array</span>
<span class="sd">                The sliced array.</span>
<span class="sd">            """</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">offset_fuzz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">arr_fuzz</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset_fuzz</span> <span class="p">:</span> <span class="n">offset_fuzz</span> <span class="o">+</span> <span class="n">length_fuzz</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">onlyfuzz</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr_fuzz</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr_fuzz</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">arr</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_slicedfunc</span><span class="p">(</span>
            <span class="n">func</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Slice a functions output for a given (length, offset) and (length_fuzz, offset_fuzz).</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            func: callable</span>
<span class="sd">            offset: int</span>
<span class="sd">            length: int</span>
<span class="sd">            offset_fuzz: int</span>
<span class="sd">            length_fuzz: int</span>
<span class="sd">            key: str</span>
<span class="sd">            fuzz: bool</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            callable</span>
<span class="sd">                The sliced function.</span>
<span class="sd">            """</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">newfunc</span><span class="p">(</span>
                <span class="n">arrs</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">ln</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">of</span><span class="o">=</span><span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">lnf</span><span class="o">=</span><span class="n">length_fuzz</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>
                <span class="n">arr_all</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr_all</span><span class="p">[</span><span class="n">o</span> <span class="p">:</span> <span class="n">o</span> <span class="o">+</span> <span class="n">ln</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">of</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">arr</span>
                <span class="n">arr_fuzz</span> <span class="o">=</span> <span class="n">arr_all</span><span class="p">[</span><span class="n">of</span> <span class="p">:</span> <span class="n">of</span> <span class="o">+</span> <span class="n">lnf</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">onlyfuzz</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">arr_fuzz</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">arr</span><span class="p">,</span> <span class="n">arr_fuzz</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">newfunc</span>

        <span class="c1"># need to evaluate without recipes first</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">withrecipes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_slicedarr</span><span class="p">(</span>
                <span class="n">v</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(</span>
            <span class="n">withfields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">FieldRecipe</span><span class="p">):</span>
                <span class="k">continue</span>  <span class="c1"># already evaluated, no need to port recipe (?)</span>
            <span class="n">rcp</span><span class="p">:</span> <span class="n">FieldRecipe</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">func</span> <span class="o">=</span> <span class="n">get_slicedfunc</span><span class="p">(</span>
                <span class="n">v</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">offset_fuzz</span><span class="p">,</span> <span class="n">length_fuzz</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">fuzz</span>
            <span class="p">)</span>
            <span class="n">newrcp</span> <span class="o">=</span> <span class="n">DerivedFieldRecipe</span><span class="p">(</span><span class="n">rcp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="n">newrcp</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">rcp</span><span class="o">.</span><span class="n">type</span>
            <span class="n">newrcp</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">rcp</span><span class="o">.</span><span class="n">description</span>
            <span class="n">newrcp</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">rcp</span><span class="o">.</span><span class="n">units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">newrcp</span>
    <span class="n">snap</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h6 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSnapshot" class="doc doc-heading">
            <code>TNGClusterSnapshot</code>


</h6>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ArepoSnapshot (scida.ArepoSnapshot)" href="#scida.customs.arepo.dataset.ArepoSnapshot">ArepoSnapshot</a></code></p>



        <p>Dataset class for the TNG-Cluster simulation.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TNGClusterSnapshot</span><span class="p">(</span><span class="n">ArepoSnapshot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Dataset class for the TNG-Cluster simulation.</span>
<span class="sd">    """</span>

    <span class="n">_fileprefix_catalog</span> <span class="o">=</span> <span class="s2">"fof_subhalo_tab_"</span>
    <span class="n">_fileprefix</span> <span class="o">=</span> <span class="s2">"snap_"</span>
    <span class="n">ntargets</span> <span class="o">=</span> <span class="mi">352</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize a TNGClusterSnapshot object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># we can get the offsets from the header as our load routine concats the various values from different files</span>
        <span class="c1"># these offsets can be used to select a given halo.</span>
        <span class="c1"># see: https://tng-project.org/w/index.php/TNG-Cluster</span>
        <span class="c1"># each zoom-target has two entries i and i+N, where N=352 is the number of zoom targets.</span>
        <span class="c1"># the first file contains the particles that were contained in the original low-res run</span>
        <span class="c1"># the second file contains all other remaining particles in a given zoom target</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">len_to_offsets</span><span class="p">(</span><span class="n">lengths</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            From the particle count (field length), get the offset of all zoom targets.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            lengths</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            np.ndarray</span>
<span class="sd">            """</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
            <span class="n">shp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">shp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">lengths</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))]</span>
                <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">lengths</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)]),</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">res</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"NumPart_ThisFile"</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsets_zoom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">particles</span><span class="o">=</span><span class="n">len_to_offsets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"particles"</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"catalog"</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Ngroups_ThisFile"</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_to_offsets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"subgroups"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Nsubgroups_ThisFile"</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="s2">"subgroups"</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_to_offsets</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"subgroups"</span><span class="p">]</span>
            <span class="p">)</span>

    <span class="nd">@TNGClusterSelector</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">return_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return the data object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FieldContainer</span>
<span class="sd">            The data object.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">return_data</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate a path as a candidate for TNG-Cluster snapshot class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to validate.</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">            Whether the path is a candidate for this simulation class.</span>
<span class="sd">        """</span>

        <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">fileprefix</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">,</span> <span class="n">fileprefix_catalog</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix_catalog</span>
        <span class="p">)</span>
        <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid</span>
        <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>

        <span class="n">matchingattrs</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Parameters"</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">"InitCondFile"</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">"InitCondFile"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"various"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
        <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"BoxSize"</span><span class="p">]</span> <span class="o">==</span> <span class="mf">680000.0</span>
        <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"NumPart_Total"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1944529344</span>
        <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"NumPart_Total"</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">586952200</span>

        <span class="k">if</span> <span class="n">matchingattrs</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSnapshot.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Initialize a TNGClusterSnapshot object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize a TNGClusterSnapshot object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># we can get the offsets from the header as our load routine concats the various values from different files</span>
    <span class="c1"># these offsets can be used to select a given halo.</span>
    <span class="c1"># see: https://tng-project.org/w/index.php/TNG-Cluster</span>
    <span class="c1"># each zoom-target has two entries i and i+N, where N=352 is the number of zoom targets.</span>
    <span class="c1"># the first file contains the particles that were contained in the original low-res run</span>
    <span class="c1"># the second file contains all other remaining particles in a given zoom target</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">len_to_offsets</span><span class="p">(</span><span class="n">lengths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        From the particle count (field length), get the offset of all zoom targets.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lengths</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        """</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">shp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">lengths</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))]</span>
            <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">lengths</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)]),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">particles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"NumPart_ThisFile"</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">offsets_zoom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">particles</span><span class="o">=</span><span class="n">len_to_offsets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"particles"</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"catalog"</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Ngroups_ThisFile"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_to_offsets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"subgroups"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Nsubgroups_ThisFile"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsets_zoom</span><span class="p">[</span><span class="s2">"subgroups"</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_to_offsets</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengths_zoom</span><span class="p">[</span><span class="s2">"subgroups"</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSnapshot.return_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_data</span><span class="p">()</span></code>

</h7>


    <div class="doc doc-contents ">

        <p>Return the data object.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@TNGClusterSelector</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">return_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return the data object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldContainer</span>
<span class="sd">        The data object.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">return_data</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h7 id="scida.customs.arepo.TNGcluster.dataset.TNGClusterSnapshot.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


    <div class="doc doc-contents ">

        <p>Validate a path as a candidate for TNG-Cluster snapshot class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the path is a candidate for this simulation class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/TNGcluster/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate a path as a candidate for TNG-Cluster snapshot class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to validate.</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">        Whether the path is a candidate for this simulation class.</span>
<span class="sd">    """</span>

    <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">fileprefix</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix</span><span class="p">,</span> <span class="n">fileprefix_catalog</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">_fileprefix_catalog</span>
    <span class="p">)</span>
    <span class="n">tkwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">valid</span> <span class="o">==</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid</span>
    <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">tkwargs</span><span class="p">)</span>

    <span class="n">matchingattrs</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Parameters"</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">"InitCondFile"</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">"InitCondFile"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"various"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
    <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"BoxSize"</span><span class="p">]</span> <span class="o">==</span> <span class="mf">680000.0</span>
    <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"NumPart_Total"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1944529344</span>
    <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"NumPart_Total"</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">586952200</span>

    <span class="k">if</span> <span class="n">matchingattrs</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.dataset" class="doc doc-heading">
            <code>dataset</code>


</h4>

    <div class="doc doc-contents ">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="scida.customs.arepo.dataset.ArepoCatalog" class="doc doc-heading">
            <code>ArepoCatalog</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ArepoSnapshot (scida.customs.arepo.dataset.ArepoSnapshot)" href="#scida.customs.arepo.dataset.ArepoSnapshot">ArepoSnapshot</a></code></p>



        <p>Dataset class for Arepo group catalogs.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ArepoCatalog</span><span class="p">(</span><span class="n">ArepoSnapshot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Dataset class for Arepo group catalogs.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize an ArepoCatalog object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>
<span class="sd">        """</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"iscatalog"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">"fileprefix"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"groups"</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate a path to use for instantiation of this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str or pathlib.Path</span>
<span class="sd">        args:</span>
<span class="sd">        kwargs:</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">        """</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_fileprefix</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">expect_grp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoCatalog.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize an ArepoCatalog object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize an ArepoCatalog object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>
<span class="sd">    """</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">"iscatalog"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">"fileprefix"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"groups"</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoCatalog.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Validate a path to use for instantiation of this class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate a path to use for instantiation of this class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str or pathlib.Path</span>
<span class="sd">    args:</span>
<span class="sd">    kwargs:</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">    """</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">"fileprefix"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_fileprefix</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">expect_grp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="scida.customs.arepo.dataset.ArepoSnapshot" class="doc doc-heading">
            <code>ArepoSnapshot</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="scida.interfaces.mixins.SpatialCartesian3DMixin">SpatialCartesian3DMixin</span></code>, <code><a class="autorefs autorefs-internal" title="GadgetStyleSnapshot (scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot)" href="#scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot">GadgetStyleSnapshot</a></code></p>



        <p>Dataset class for Arepo snapshots.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ArepoSnapshot</span><span class="p">(</span><span class="n">SpatialCartesian3DMixin</span><span class="p">,</span> <span class="n">GadgetStyleSnapshot</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Dataset class for Arepo snapshots.</span>
<span class="sd">    """</span>

    <span class="n">_fileprefix_catalog</span> <span class="o">=</span> <span class="s2">"groups"</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize an ArepoSnapshot object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str or pathlib.Path</span>
<span class="sd">            Path to snapshot, typically a directory containing multiple hdf5 files.</span>
<span class="sd">        chunksize:</span>
<span class="sd">            Chunksize to use for dask arrays. Can be "auto" to automatically determine chunksize.</span>
<span class="sd">        catalog:</span>
<span class="sd">            Path to group catalog. If None, the catalog is searched for in the parent directories.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Additional keyword arguments.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iscatalog</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"iscatalog"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># check whether we have a cosmology mixin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultunitfiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"units/gadget_base.yaml"</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_mixins"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"cosmology"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mixins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defaultunitfiles</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">"units/gadget_cosmological.yaml"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># not needed for group catalogs as entries are back-to-back there, we will provide a property for this</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for storing misc info</span>
        <span class="n">prfx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"fileprefix"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prfx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fileprefix</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">fileprefix</span><span class="o">=</span><span class="n">prfx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">catalog</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscatalog</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">discover_catalog</span><span class="p">()</span>
                <span class="c1"># try to discover group catalog in parent directories.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">==</span> <span class="s2">"none"</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># this string can be set to explicitly disable catalog</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">:</span>
                <span class="n">catalog_cls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"catalog_cls"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">cosmological</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_mixins"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"cosmology"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mixins</span><span class="p">:</span>
                    <span class="n">cosmological</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load_catalog</span><span class="p">(</span>
                    <span class="n">overwrite_cache</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"overwrite_cache"</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                    <span class="n">catalog_cls</span><span class="o">=</span><span class="n">catalog_cls</span><span class="p">,</span>
                    <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
                    <span class="n">cosmological</span><span class="o">=</span><span class="n">cosmological</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># add aliases</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">PartType0</span><span class="o">=</span><span class="p">[</span><span class="s2">"gas"</span><span class="p">,</span> <span class="s2">"baryons"</span><span class="p">],</span>
            <span class="n">PartType1</span><span class="o">=</span><span class="p">[</span><span class="s2">"dm"</span><span class="p">,</span> <span class="s2">"dark matter"</span><span class="p">],</span>
            <span class="n">PartType2</span><span class="o">=</span><span class="p">[</span><span class="s2">"lowres"</span><span class="p">,</span> <span class="s2">"lowres dm"</span><span class="p">],</span>
            <span class="n">PartType3</span><span class="o">=</span><span class="p">[</span><span class="s2">"tracer"</span><span class="p">,</span> <span class="s2">"tracers"</span><span class="p">],</span>
            <span class="n">PartType4</span><span class="o">=</span><span class="p">[</span><span class="s2">"stars"</span><span class="p">],</span>
            <span class="n">PartType5</span><span class="o">=</span><span class="p">[</span><span class="s2">"bh"</span><span class="p">,</span> <span class="s2">"black holes"</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">add_alias</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># set metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_metadata</span><span class="p">()</span>

        <span class="c1"># add some default fields</span>
        <span class="n">overwrite_fields</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">kfield</span> <span class="ow">in</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">:</span>
            <span class="n">parttype</span> <span class="o">=</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">[</span><span class="n">kfield</span><span class="p">]</span><span class="o">.</span><span class="n">parttype</span>
            <span class="k">if</span> <span class="n">parttype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">overwrite_fields</span> <span class="ow">or</span> <span class="n">kfield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">[</span><span class="n">kfield</span><span class="p">]</span><span class="o">.</span><span class="n">func</span>
                    <span class="c1"># verify that we have the dependencies</span>
                    <span class="n">dependencies</span> <span class="o">=</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">[</span><span class="n">kfield</span><span class="p">]</span><span class="o">.</span><span class="n">dependencies</span>
                    <span class="n">deps_fulfilled</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]:</span>
                            <span class="n">deps_fulfilled</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">deps_fulfilled</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span><span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">kfield</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_catalog</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cosmological</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">catalog_cls</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Load the group catalog.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kwargs: dict</span>
<span class="sd">            Keyword arguments passed to the catalog class.</span>
<span class="sd">        catalog_cls: type</span>
<span class="sd">            Class to use for the catalog. If None, the default catalog class is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">virtualcache</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># fileprefix = catalog_kwargs.get("fileprefix", self._fileprefix_catalog)</span>
        <span class="n">prfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fileprefix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">)</span>

        <span class="c1"># explicitly need to create unitaware class for catalog as needed</span>
        <span class="c1"># TODO: should just be determined from mixins of parent?</span>
        <span class="k">if</span> <span class="n">catalog_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">ArepoCatalog</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">catalog_cls</span>
        <span class="n">withunits</span> <span class="o">=</span> <span class="n">units</span>
        <span class="n">mixins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">withunits</span><span class="p">:</span>
            <span class="n">mixins</span> <span class="o">+=</span> <span class="p">[</span><span class="n">UnitMixin</span><span class="p">]</span>

        <span class="n">other_mixins</span> <span class="o">=</span> <span class="n">_determine_mixins</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">mixins</span> <span class="o">+=</span> <span class="n">other_mixins</span>
        <span class="k">if</span> <span class="n">cosmological</span> <span class="ow">and</span> <span class="n">CosmologyMixin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">:</span>
            <span class="n">mixins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CosmologyMixin</span><span class="p">)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>

        <span class="n">ureg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"ureg"</span><span class="p">):</span>
            <span class="n">ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ureg</span>

        <span class="c1"># non-virtual catalog fields for better performance</span>
        <span class="n">nonvirtual_datasets</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"Group/GroupFirstSub"</span><span class="p">,</span>
            <span class="s2">"Group/GroupLenType"</span><span class="p">,</span>
            <span class="s2">"Group/GroupNsubs"</span><span class="p">,</span>
            <span class="s2">"Subhalo/SubhaloGrNr"</span><span class="p">,</span>
            <span class="s2">"Subhalo/SubhaloGroupNr"</span><span class="p">,</span>
            <span class="s2">"Subhalo/SubhaloLenType"</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span>
            <span class="n">overwrite_cache</span><span class="o">=</span><span class="n">overwrite_cache</span><span class="p">,</span>
            <span class="n">virtualcache</span><span class="o">=</span><span class="n">virtualcache</span><span class="p">,</span>
            <span class="n">nonvirtual_datasets</span><span class="o">=</span><span class="n">nonvirtual_datasets</span><span class="p">,</span>
            <span class="n">fileprefix</span><span class="o">=</span><span class="n">prfx</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
            <span class="n">ureg</span><span class="o">=</span><span class="n">ureg</span><span class="p">,</span>
            <span class="n">hints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">,</span>
            <span class="n">metadata_raw_parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">"Redshift"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span> <span class="ow">and</span> <span class="s2">"Redshift"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="n">z_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Redshift"</span><span class="p">]</span>
            <span class="n">z_snap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Redshift"</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">z_catalog</span><span class="p">,</span> <span class="n">z_snap</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Redshift mismatch between snapshot and catalog: "</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">z_snap</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">z_catalog</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

        <span class="c1"># merge data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">)</span>

        <span class="c1"># first snapshots often do not have groups</span>
        <span class="k">if</span> <span class="s2">"Group"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">ngkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ngkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_catalogIDs</span><span class="p">()</span>

        <span class="c1"># merge hints from snap and catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">merge_hints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate a path to use for instantiation of this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str or pathlib.Path</span>
<span class="sd">        args:</span>
<span class="sd">        kwargs:</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">        """</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valid</span>
        <span class="c1"># Arepo has no dedicated attribute to identify such runs.</span>
        <span class="c1"># lets just query a bunch of attributes that are present for arepo runs</span>
        <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">matchingattrs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="s2">"Git_commit"</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
        <span class="c1"># not existent for any arepo run?</span>
        <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="s2">"Compactify_Version"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">matchingattrs</span><span class="p">:</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>

        <span class="k">return</span> <span class="n">valid</span>

    <span class="nd">@ArepoSelector</span><span class="p">()</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">return_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return data object of this snapshot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">return_data</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">discover_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Discover the group catalog given the current path</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="c1"># order of candidates matters. For Illustris "groups" must precede "fof_subhalo_tab"</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapshot"</span><span class="p">,</span> <span class="s2">"group"</span><span class="p">),</span>
            <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapshot"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">),</span>
            <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">),</span>
            <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"group"</span><span class="p">),</span>
            <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">),</span>
            <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"fof_subhalo_tab"</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># do not set catalog to snapshot itself</span>
            <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">candidate</span>
            <span class="k">break</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">construct</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Register a field.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parttype: str</span>
<span class="sd">            name of particle type</span>
<span class="sd">        name: str</span>
<span class="sd">            name of field</span>
<span class="sd">        construct: bool</span>
<span class="sd">            construct field immediately</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">construct</span><span class="p">:</span>  <span class="c1"># TODO: introduce (immediate) construct option later</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># TODO: all particle species</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">"all"</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s2">"PartType"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">parttype</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_catalogIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Add field for halo and subgroup IDs for all particle types.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="c1"># TODO: make these delayed objects and properly pass into (delayed?) numba functions:</span>
        <span class="c1"># https://docs.dask.org/en/stable/delayed-best-practices.html#avoid-repeatedly-putting-large-inputs-into-delayed-calls</span>

        <span class="n">maxint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxint</span>

        <span class="c1"># Group ID</span>
        <span class="k">if</span> <span class="s2">"Group"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>  <span class="c1"># can happen for empty catalogs</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
                    <span class="k">continue</span>
                <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"GroupID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                    <span class="n">uid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                    <span class="n">uid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
                <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">glen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">]</span>
        <span class="n">ngrp</span> <span class="o">=</span> <span class="n">glen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">da_halocelloffsets</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
                <span class="n">da</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">glen</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># remove last entry to match shapematch shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span>
            <span class="n">glen</span><span class="o">.</span><span class="n">chunks</span>
        <span class="p">)</span>
        <span class="n">halocelloffsets</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">index_unbound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">"uid"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c1"># can happen for empty containers</span>
            <span class="n">gidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
            <span class="n">hidx</span> <span class="o">=</span> <span class="n">compute_haloindex</span><span class="p">(</span>
                <span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">[:,</span> <span class="n">num</span><span class="p">],</span> <span class="n">index_unbound</span><span class="o">=</span><span class="n">index_unbound</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"GroupID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hidx</span>

        <span class="c1"># Subhalo ID</span>
        <span class="k">if</span> <span class="s2">"Subhalo"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>  <span class="c1"># can happen for empty catalogs</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                    <span class="n">da</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
                <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">shnr_attr</span> <span class="o">=</span> <span class="s2">"SubhaloGrNr"</span>
        <span class="k">if</span> <span class="n">shnr_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">]:</span>
            <span class="n">shnr_attr</span> <span class="o">=</span> <span class="s2">"SubhaloGroupNr"</span>  <span class="c1"># what MTNG does</span>
        <span class="k">if</span> <span class="n">shnr_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Could not find 'SubhaloGrNr' or 'SubhaloGroupNr' in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="n">subhalogrnr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="n">shnr_attr</span><span class="p">]</span>
        <span class="n">subhalocellcounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloLenType"</span><span class="p">]</span>

        <span class="c1"># remove "units" for numba funcs</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subhalogrnr</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
            <span class="n">subhalogrnr</span> <span class="o">=</span> <span class="n">subhalogrnr</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subhalocellcounts</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
            <span class="n">subhalocellcounts</span> <span class="o">=</span> <span class="n">subhalocellcounts</span><span class="o">.</span><span class="n">magnitude</span>

        <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">"GroupFirstSub"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grp</span> <span class="ow">or</span> <span class="s2">"GroupNsubs"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">:</span>
            <span class="c1"># if not provided, we calculate:</span>
            <span class="c1"># "GroupFirstSub": First subhalo index for each halo</span>
            <span class="c1"># "GroupNsubs": Number of subhalos for each halo</span>
            <span class="n">dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">get_shcounts_shcells</span><span class="p">)(</span><span class="n">subhalogrnr</span><span class="p">,</span> <span class="n">ngrp</span><span class="p">)</span>
            <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">dlyd</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupNsubs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">dlyd</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># remove "units" for numba funcs</span>
        <span class="n">grpfirstsub</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">grpfirstsub</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
            <span class="n">grpfirstsub</span> <span class="o">=</span> <span class="n">grpfirstsub</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">grpnsubs</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupNsubs"</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">grpnsubs</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
            <span class="n">grpnsubs</span> <span class="o">=</span> <span class="n">grpnsubs</span><span class="o">.</span><span class="n">magnitude</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"uid"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c1"># can happen for empty containers</span>
            <span class="n">gidx</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"uid"</span><span class="p">]</span>

            <span class="c1"># we need to make other dask arrays delayed,</span>
            <span class="c1"># map_block does not incorrectly infer output shape from these</span>
            <span class="n">halocelloffsets_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">halocelloffsets</span><span class="p">[:,</span> <span class="n">num</span><span class="p">])</span>
            <span class="n">grpfirstsub_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">grpfirstsub</span><span class="p">)</span>
            <span class="n">grpnsubs_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">grpnsubs</span><span class="p">)</span>
            <span class="n">subhalocellcounts_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">subhalocellcounts</span><span class="p">[:,</span> <span class="n">num</span><span class="p">])</span>

            <span class="n">sidx</span> <span class="o">=</span> <span class="n">compute_localsubhaloindex</span><span class="p">(</span>
                <span class="n">gidx</span><span class="p">,</span>
                <span class="n">halocelloffsets_dlyd</span><span class="p">,</span>
                <span class="n">grpfirstsub_dlyd</span><span class="p">,</span>
                <span class="n">grpnsubs_dlyd</span><span class="p">,</span>
                <span class="n">subhalocellcounts_dlyd</span><span class="p">,</span>
                <span class="n">index_unbound</span><span class="o">=</span><span class="n">index_unbound</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">pdata</span><span class="p">[</span><span class="s2">"LocalSubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidx</span>

            <span class="c1"># reconstruct SubhaloID from Group's GroupFirstSub and LocalSubhaloID</span>
            <span class="c1"># should be easier to do it directly, but quicker to write down like this:</span>

            <span class="c1"># calculate first subhalo of each halo that a particle belongs to</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_groupquantity_to_particles</span><span class="p">(</span><span class="s2">"GroupFirstSub"</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"LocalSubhaloID"</span><span class="p">]</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">==</span> <span class="n">index_unbound</span><span class="p">,</span> <span class="n">index_unbound</span><span class="p">,</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># add GroupID and SubhaloID to catalogs/groups themselves</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>

    <span class="nd">@computedecorator</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_group_operation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span>
        <span class="n">nchunks_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunksize_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">objtype</span><span class="o">=</span><span class="s2">"halo"</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Apply a function to each halo in the catalog.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype: str</span>
<span class="sd">            Type of object to process. Can be "halo" or "subhalo". Default: "halo"</span>
<span class="sd">        idxlist: np.ndarray | None</span>
<span class="sd">            List of halo indices to process. If not provided, all halos are processed.</span>
<span class="sd">        func: function</span>
<span class="sd">            Function to apply to each halo. Must take a dictionary of arrays as input.</span>
<span class="sd">        cpucost_halo:</span>
<span class="sd">            "CPU cost" of processing a single halo. This is a relative value to the processing time per input particle</span>
<span class="sd">            used for calculating the dask chunks. Default: 1e4</span>
<span class="sd">        nchunks_min: int | None</span>
<span class="sd">            Minimum number of particles in a halo to process it. Default: None</span>
<span class="sd">        chunksize_bytes: int | None</span>
<span class="sd">        nmax: int | None</span>
<span class="sd">            Only process the first nmax halos.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">dfltkwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"fieldnames"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fieldnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">parttype</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parttype"</span><span class="p">,</span> <span class="s2">"PartType0"</span><span class="p">)</span>
        <span class="n">entry_nbytes_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">])</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="n">grp_type_str</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"halo"</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"subhalo"</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"objtype must be 'halo' or 'subhalo', not </span><span class="si">{</span><span class="n">objtype</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">arrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">map_group_operation</span><span class="p">(</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="n">offsets</span><span class="p">,</span>
            <span class="n">lengths</span><span class="p">,</span>
            <span class="n">arrdict</span><span class="p">,</span>
            <span class="n">cpucost_halo</span><span class="o">=</span><span class="n">cpucost_halo</span><span class="p">,</span>
            <span class="n">nchunks_min</span><span class="o">=</span><span class="n">nchunks_min</span><span class="p">,</span>
            <span class="n">chunksize_bytes</span><span class="o">=</span><span class="n">chunksize_bytes</span><span class="p">,</span>
            <span class="n">entry_nbytes_in</span><span class="o">=</span><span class="n">entry_nbytes_in</span><span class="p">,</span>
            <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
            <span class="n">idxlist</span><span class="o">=</span><span class="n">idxlist</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_groupquantity_to_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Map a quantity from the group catalog to the particles based on a particle's group index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str</span>
<span class="sd">            Name of quantity to map</span>
<span class="sd">        parttype: str</span>
<span class="sd">            Name of particle type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">pdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pdata</span>
        <span class="p">)</span>  <span class="c1"># we simply map the name from Group to Particle for now. Should work (?)</span>
        <span class="n">glen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">]</span>
        <span class="n">da_halocelloffsets</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">da</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">glen</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">"GroupOffsetsType"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span>
                <span class="n">glen</span><span class="o">.</span><span class="n">chunks</span>
            <span class="p">)</span>  <span class="c1"># remove last entry to match shape</span>
        <span class="n">halocelloffsets</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

        <span class="n">gidx</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"uid"</span><span class="p">]</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parttype</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">hquantity</span> <span class="o">=</span> <span class="n">compute_haloquantity</span><span class="p">(</span>
            <span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">[:,</span> <span class="n">num</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pdata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hquantity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_grouplengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the lengths, i.e. the total number of particles, of a given type in all halos.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parttype: str</span>
<span class="sd">            Name of particle type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        """</span>
        <span class="n">pnum</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pnum</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">][:,</span> <span class="n">pnum</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
                <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengths</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_groupoffsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the array index offset of the first particle of a given type in each halo.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parttype: str</span>
<span class="sd">            Name of particle type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">parttype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">:</span>
            <span class="c1"># need to calculate group lengths first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groupoffsets</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_groupoffsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">v</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lengths</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">offsets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_subhalolengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the lengths, i.e. the total number of particles, of a given type in all subhalos.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parttype: str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        """</span>
        <span class="n">pnum</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pnum</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloLenType"</span><span class="p">][:,</span> <span class="n">pnum</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengths</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_subhalooffsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the array index offset of the first particle of a given type in each subhalo.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parttype: str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.ndarray</span>
<span class="sd">        """</span>

        <span class="n">pnum</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pnum</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>  <span class="c1"># use cached result</span>
        <span class="n">goffsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span>
        <span class="n">shgrnr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloGrNr"</span><span class="p">]</span>
        <span class="c1"># calculate the index of the first particle for the central subhalo of each subhalos's parent halo</span>
        <span class="n">shoffset_central</span> <span class="o">=</span> <span class="n">goffsets</span><span class="p">[</span><span class="n">shgrnr</span><span class="p">]</span>

        <span class="n">grpfirstsub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span>
        <span class="n">shlens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span>
        <span class="n">shoffsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">shlens</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1"># particle offset for the first subhalo of each group that a subhalo belongs to</span>
        <span class="n">shfirstshoffset</span> <span class="o">=</span> <span class="n">shoffsets</span><span class="p">[</span><span class="n">grpfirstsub</span><span class="p">[</span><span class="n">shgrnr</span><span class="p">]]</span>

        <span class="c1"># "LocalSubhaloOffset": particle offset of each subhalo in the parent group</span>
        <span class="n">shoffset_local</span> <span class="o">=</span> <span class="n">shoffsets</span> <span class="o">-</span> <span class="n">shfirstshoffset</span>

        <span class="c1"># "SubhaloOffset": particle offset of each subhalo in the simulation</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">shoffset_central</span> <span class="o">+</span> <span class="n">shoffset_local</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span>

        <span class="k">return</span> <span class="n">offsets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">grouped</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
        <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">,</span>
        <span class="n">objtype</span><span class="o">=</span><span class="s2">"halo"</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Create a GroupAwareOperation object for applying operations to groups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fields: str | list[str] | dict[str, da.Array]</span>
<span class="sd">            Fields to pass to the operation. Can be a string, a dask array, a list of strings or a dictionary of dask arrays.</span>
<span class="sd">        parttype: str</span>
<span class="sd">            Particle type to operate on.</span>
<span class="sd">        objtype: str</span>
<span class="sd">            Type of object to operate on. Can be "halo" or "subhalo". Default: "halo"</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GroupAwareOperation</span>
<span class="sd">        """</span>
        <span class="n">inputfields</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fields</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>  <span class="c1"># if nothing is specified, we pass all we have.</span>
                <span class="n">arrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="n">fields</span><span class="p">])</span>
                <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daskarr</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">field_mag</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_mag</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
                <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daskarr</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
                <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_mag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_mag</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">field_u</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">units</span>
                <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">daskarr</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">field_mag</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">)</span> <span class="o">*</span> <span class="n">field_u</span>
                <span class="p">)</span>
                <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"field"</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Unknown input type '</span><span class="si">%s</span><span class="s2">' decorated with pint quantity."</span>
                    <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">field_mag</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daskarr</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">))</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"field"</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">}</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">arrdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown input type '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
        <span class="n">check_shape_plausability</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">check_shape_plausability</span> <span class="ow">and</span> <span class="s2">"Coordinates"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]:</span>
            <span class="n">shape0_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="s2">"Coordinates"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">shape0_ref</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Shape mismatch: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> has shape </span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> while Coordinates has shape </span><span class="si">{</span><span class="n">shape0_ref</span><span class="si">}</span><span class="s2">. "</span>
                        <span class="sa">f</span><span class="s2">"Check parttype passed to grouped()?"</span>
                    <span class="p">)</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="n">grp_type_str</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"halo"</span><span class="p">:</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"subhalo"</span><span class="p">:</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown object type '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="n">objtype</span><span class="p">)</span>

        <span class="n">gop</span> <span class="o">=</span> <span class="n">GroupAwareOperation</span><span class="p">(</span>
            <span class="n">offsets</span><span class="p">,</span>
            <span class="n">lengths</span><span class="p">,</span>
            <span class="n">arrdict</span><span class="p">,</span>
            <span class="n">inputfields</span><span class="o">=</span><span class="n">inputfields</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">gop</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize an ArepoSnapshot object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to snapshot, typically a directory containing multiple hdf5 files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunksize to use for dask arrays. Can be "auto" to automatically determine chunksize.</p>
              </div>
            </td>
            <td>
                  <code>'auto'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>catalog</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to group catalog. If None, the catalog is searched for in the parent directories.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize an ArepoSnapshot object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str or pathlib.Path</span>
<span class="sd">        Path to snapshot, typically a directory containing multiple hdf5 files.</span>
<span class="sd">    chunksize:</span>
<span class="sd">        Chunksize to use for dask arrays. Can be "auto" to automatically determine chunksize.</span>
<span class="sd">    catalog:</span>
<span class="sd">        Path to group catalog. If None, the catalog is searched for in the parent directories.</span>
<span class="sd">    kwargs:</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iscatalog</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"iscatalog"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># check whether we have a cosmology mixin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defaultunitfiles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"units/gadget_base.yaml"</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_mixins"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"cosmology"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mixins</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultunitfiles</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">"units/gadget_cosmological.yaml"</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># not needed for group catalogs as entries are back-to-back there, we will provide a property for this</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># for storing misc info</span>
    <span class="n">prfx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"fileprefix"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prfx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fileprefix</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">fileprefix</span><span class="o">=</span><span class="n">prfx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">catalog</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">iscatalog</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">discover_catalog</span><span class="p">()</span>
            <span class="c1"># try to discover group catalog in parent directories.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">==</span> <span class="s2">"none"</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># this string can be set to explicitly disable catalog</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">:</span>
            <span class="n">catalog_cls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"catalog_cls"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">cosmological</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_mixins"</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">"cosmology"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mixins</span><span class="p">:</span>
                <span class="n">cosmological</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_catalog</span><span class="p">(</span>
                <span class="n">overwrite_cache</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"overwrite_cache"</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                <span class="n">catalog_cls</span><span class="o">=</span><span class="n">catalog_cls</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
                <span class="n">cosmological</span><span class="o">=</span><span class="n">cosmological</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># add aliases</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">PartType0</span><span class="o">=</span><span class="p">[</span><span class="s2">"gas"</span><span class="p">,</span> <span class="s2">"baryons"</span><span class="p">],</span>
        <span class="n">PartType1</span><span class="o">=</span><span class="p">[</span><span class="s2">"dm"</span><span class="p">,</span> <span class="s2">"dark matter"</span><span class="p">],</span>
        <span class="n">PartType2</span><span class="o">=</span><span class="p">[</span><span class="s2">"lowres"</span><span class="p">,</span> <span class="s2">"lowres dm"</span><span class="p">],</span>
        <span class="n">PartType3</span><span class="o">=</span><span class="p">[</span><span class="s2">"tracer"</span><span class="p">,</span> <span class="s2">"tracers"</span><span class="p">],</span>
        <span class="n">PartType4</span><span class="o">=</span><span class="p">[</span><span class="s2">"stars"</span><span class="p">],</span>
        <span class="n">PartType5</span><span class="o">=</span><span class="p">[</span><span class="s2">"bh"</span><span class="p">,</span> <span class="s2">"black holes"</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">add_alias</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="c1"># set metadata</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_metadata</span><span class="p">()</span>

    <span class="c1"># add some default fields</span>
    <span class="n">overwrite_fields</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">kfield</span> <span class="ow">in</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">:</span>
        <span class="n">parttype</span> <span class="o">=</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">[</span><span class="n">kfield</span><span class="p">]</span><span class="o">.</span><span class="n">parttype</span>
        <span class="k">if</span> <span class="n">parttype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">overwrite_fields</span> <span class="ow">or</span> <span class="n">kfield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">[</span><span class="n">kfield</span><span class="p">]</span><span class="o">.</span><span class="n">func</span>
                <span class="c1"># verify that we have the dependencies</span>
                <span class="n">dependencies</span> <span class="o">=</span> <span class="n">fielddefs</span><span class="o">.</span><span class="n">fielddefs</span><span class="p">[</span><span class="n">kfield</span><span class="p">]</span><span class="o">.</span><span class="n">dependencies</span>
                <span class="n">deps_fulfilled</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]:</span>
                        <span class="n">deps_fulfilled</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">deps_fulfilled</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span><span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">kfield</span><span class="p">)(</span><span class="n">func</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.add_catalogIDs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_catalogIDs</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Add field for halo and subgroup IDs for all particle types.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_catalogIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Add field for halo and subgroup IDs for all particle types.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="c1"># TODO: make these delayed objects and properly pass into (delayed?) numba functions:</span>
    <span class="c1"># https://docs.dask.org/en/stable/delayed-best-practices.html#avoid-repeatedly-putting-large-inputs-into-delayed-calls</span>

    <span class="n">maxint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxint</span>

    <span class="c1"># Group ID</span>
    <span class="k">if</span> <span class="s2">"Group"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>  <span class="c1"># can happen for empty catalogs</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"GroupID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                <span class="n">uid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                <span class="n">uid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
            <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">glen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">]</span>
    <span class="n">ngrp</span> <span class="o">=</span> <span class="n">glen</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">da_halocelloffsets</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
            <span class="n">da</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">glen</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># remove last entry to match shapematch shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span>
        <span class="n">glen</span><span class="o">.</span><span class="n">chunks</span>
    <span class="p">)</span>
    <span class="n">halocelloffsets</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">index_unbound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="s2">"unboundID"</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
            <span class="k">continue</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">"uid"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="k">continue</span>  <span class="c1"># can happen for empty containers</span>
        <span class="n">gidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
        <span class="n">hidx</span> <span class="o">=</span> <span class="n">compute_haloindex</span><span class="p">(</span>
            <span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">[:,</span> <span class="n">num</span><span class="p">],</span> <span class="n">index_unbound</span><span class="o">=</span><span class="n">index_unbound</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"GroupID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">hidx</span>

    <span class="c1"># Subhalo ID</span>
    <span class="k">if</span> <span class="s2">"Subhalo"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>  <span class="c1"># can happen for empty catalogs</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">da</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                <span class="n">da</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
            <span class="p">)</span>
        <span class="k">return</span>

    <span class="n">shnr_attr</span> <span class="o">=</span> <span class="s2">"SubhaloGrNr"</span>
    <span class="k">if</span> <span class="n">shnr_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">]:</span>
        <span class="n">shnr_attr</span> <span class="o">=</span> <span class="s2">"SubhaloGroupNr"</span>  <span class="c1"># what MTNG does</span>
    <span class="k">if</span> <span class="n">shnr_attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Could not find 'SubhaloGrNr' or 'SubhaloGroupNr' in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>

    <span class="n">subhalogrnr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="n">shnr_attr</span><span class="p">]</span>
    <span class="n">subhalocellcounts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloLenType"</span><span class="p">]</span>

    <span class="c1"># remove "units" for numba funcs</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subhalogrnr</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
        <span class="n">subhalogrnr</span> <span class="o">=</span> <span class="n">subhalogrnr</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subhalocellcounts</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
        <span class="n">subhalocellcounts</span> <span class="o">=</span> <span class="n">subhalocellcounts</span><span class="o">.</span><span class="n">magnitude</span>

    <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">"GroupFirstSub"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grp</span> <span class="ow">or</span> <span class="s2">"GroupNsubs"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">:</span>
        <span class="c1"># if not provided, we calculate:</span>
        <span class="c1"># "GroupFirstSub": First subhalo index for each halo</span>
        <span class="c1"># "GroupNsubs": Number of subhalos for each halo</span>
        <span class="n">dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">get_shcounts_shcells</span><span class="p">)(</span><span class="n">subhalogrnr</span><span class="p">,</span> <span class="n">ngrp</span><span class="p">)</span>
        <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">dlyd</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupNsubs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">dlyd</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># remove "units" for numba funcs</span>
    <span class="n">grpfirstsub</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">grpfirstsub</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
        <span class="n">grpfirstsub</span> <span class="o">=</span> <span class="n">grpfirstsub</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="n">grpnsubs</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="s2">"GroupNsubs"</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">grpnsubs</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
        <span class="n">grpnsubs</span> <span class="o">=</span> <span class="n">grpnsubs</span><span class="o">.</span><span class="n">magnitude</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)):</span>
            <span class="k">continue</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">"uid"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="k">continue</span>  <span class="c1"># can happen for empty containers</span>
        <span class="n">gidx</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"uid"</span><span class="p">]</span>

        <span class="c1"># we need to make other dask arrays delayed,</span>
        <span class="c1"># map_block does not incorrectly infer output shape from these</span>
        <span class="n">halocelloffsets_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">halocelloffsets</span><span class="p">[:,</span> <span class="n">num</span><span class="p">])</span>
        <span class="n">grpfirstsub_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">grpfirstsub</span><span class="p">)</span>
        <span class="n">grpnsubs_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">grpnsubs</span><span class="p">)</span>
        <span class="n">subhalocellcounts_dlyd</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">subhalocellcounts</span><span class="p">[:,</span> <span class="n">num</span><span class="p">])</span>

        <span class="n">sidx</span> <span class="o">=</span> <span class="n">compute_localsubhaloindex</span><span class="p">(</span>
            <span class="n">gidx</span><span class="p">,</span>
            <span class="n">halocelloffsets_dlyd</span><span class="p">,</span>
            <span class="n">grpfirstsub_dlyd</span><span class="p">,</span>
            <span class="n">grpnsubs_dlyd</span><span class="p">,</span>
            <span class="n">subhalocellcounts_dlyd</span><span class="p">,</span>
            <span class="n">index_unbound</span><span class="o">=</span><span class="n">index_unbound</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">pdata</span><span class="p">[</span><span class="s2">"LocalSubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sidx</span>

        <span class="c1"># reconstruct SubhaloID from Group's GroupFirstSub and LocalSubhaloID</span>
        <span class="c1"># should be easier to do it directly, but quicker to write down like this:</span>

        <span class="c1"># calculate first subhalo of each halo that a particle belongs to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_groupquantity_to_particles</span><span class="p">(</span><span class="s2">"GroupFirstSub"</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span> <span class="o">+</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"LocalSubhaloID"</span><span class="p">]</span>
        <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">==</span> <span class="n">index_unbound</span><span class="p">,</span> <span class="n">index_unbound</span><span class="p">,</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"SubhaloID"</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># add GroupID and SubhaloID to catalogs/groups themselves</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloID"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"uid"</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.add_groupquantity_to_particles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_groupquantity_to_particles</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s1">'PartType0'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Map a quantity from the group catalog to the particles based on a particle's group index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of quantity to map</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of particle type</p>
              </div>
            </td>
            <td>
                  <code>'PartType0'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_groupquantity_to_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Map a quantity from the group catalog to the particles based on a particle's group index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">        Name of quantity to map</span>
<span class="sd">    parttype: str</span>
<span class="sd">        Name of particle type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">pdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pdata</span>
    <span class="p">)</span>  <span class="c1"># we simply map the name from Group to Particle for now. Should work (?)</span>
    <span class="n">glen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">]</span>
    <span class="n">da_halocelloffsets</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">da</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">glen</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">"GroupOffsetsType"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span>
            <span class="n">glen</span><span class="o">.</span><span class="n">chunks</span>
        <span class="p">)</span>  <span class="c1"># remove last entry to match shape</span>
    <span class="n">halocelloffsets</span> <span class="o">=</span> <span class="n">da_halocelloffsets</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">gidx</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="s2">"uid"</span><span class="p">]</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parttype</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">hquantity</span> <span class="o">=</span> <span class="n">compute_haloquantity</span><span class="p">(</span>
        <span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">[:,</span> <span class="n">num</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">pdata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hquantity</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.discover_catalog" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">discover_catalog</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Discover the group catalog given the current path</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discover_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Discover the group catalog given the current path</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># order of candidates matters. For Illustris "groups" must precede "fof_subhalo_tab"</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapshot"</span><span class="p">,</span> <span class="s2">"group"</span><span class="p">),</span>
        <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapshot"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">),</span>
        <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">),</span>
        <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"group"</span><span class="p">),</span>
        <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">),</span>
        <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"fof_subhalo_tab"</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">continue</span>  <span class="c1"># do not set catalog to snapshot itself</span>
        <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">candidate</span>
        <span class="k">break</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.get_grouplengths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="s1">'PartType0'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the lengths, i.e. the total number of particles, of a given type in all halos.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of particle type</p>
              </div>
            </td>
            <td>
                  <code>'PartType0'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_grouplengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the lengths, i.e. the total number of particles, of a given type in all halos.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parttype: str</span>
<span class="sd">        Name of particle type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    """</span>
    <span class="n">pnum</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pnum</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">][:,</span> <span class="n">pnum</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengths</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.get_groupoffsets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="s1">'PartType0'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the array index offset of the first particle of a given type in each halo.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of particle type</p>
              </div>
            </td>
            <td>
                  <code>'PartType0'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_groupoffsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the array index offset of the first particle of a given type in each halo.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parttype: str</span>
<span class="sd">        Name of particle type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">parttype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grouplengths</span><span class="p">:</span>
        <span class="c1"># need to calculate group lengths first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groupoffsets</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.get_subhalolengths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="s1">'PartType0'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the lengths, i.e. the total number of particles, of a given type in all subhalos.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>'PartType0'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subhalolengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the lengths, i.e. the total number of particles, of a given type in all subhalos.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parttype: str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    """</span>
    <span class="n">pnum</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pnum</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloLenType"</span><span class="p">][:,</span> <span class="n">pnum</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengths</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalolengths</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.get_subhalooffsets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="s1">'PartType0'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the array index offset of the first particle of a given type in each subhalo.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>'PartType0'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subhalooffsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the array index offset of the first particle of a given type in each subhalo.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parttype: str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    """</span>

    <span class="n">pnum</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">pnum</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span>  <span class="c1"># use cached result</span>
    <span class="n">goffsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span>
    <span class="n">shgrnr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Subhalo"</span><span class="p">][</span><span class="s2">"SubhaloGrNr"</span><span class="p">]</span>
    <span class="c1"># calculate the index of the first particle for the central subhalo of each subhalos's parent halo</span>
    <span class="n">shoffset_central</span> <span class="o">=</span> <span class="n">goffsets</span><span class="p">[</span><span class="n">shgrnr</span><span class="p">]</span>

    <span class="n">grpfirstsub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span>
    <span class="n">shlens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span>
    <span class="n">shoffsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">shlens</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="c1"># particle offset for the first subhalo of each group that a subhalo belongs to</span>
    <span class="n">shfirstshoffset</span> <span class="o">=</span> <span class="n">shoffsets</span><span class="p">[</span><span class="n">grpfirstsub</span><span class="p">[</span><span class="n">shgrnr</span><span class="p">]]</span>

    <span class="c1"># "LocalSubhaloOffset": particle offset of each subhalo in the parent group</span>
    <span class="n">shoffset_local</span> <span class="o">=</span> <span class="n">shoffsets</span> <span class="o">-</span> <span class="n">shfirstshoffset</span>

    <span class="c1"># "SubhaloOffset": particle offset of each subhalo in the simulation</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="n">shoffset_central</span> <span class="o">+</span> <span class="n">shoffset_local</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_subhalooffsets</span><span class="p">[</span><span class="n">ptype</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsets</span>

    <span class="k">return</span> <span class="n">offsets</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.grouped" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grouped</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">parttype</span><span class="o">=</span><span class="s1">'PartType0'</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="s1">'halo'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Create a GroupAwareOperation object for applying operations to groups.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | <span title="dict">dict</span>[<span title="str">str</span>, <span title="dask.array.Array">Array</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fields to pass to the operation. Can be a string, a dask array, a list of strings or a dictionary of dask arrays.</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Particle type to operate on.</p>
              </div>
            </td>
            <td>
                  <code>'PartType0'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>objtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of object to operate on. Can be "halo" or "subhalo". Default: "halo"</p>
              </div>
            </td>
            <td>
                  <code>'halo'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GroupAwareOperation (scida.customs.arepo.dataset.GroupAwareOperation)" href="#scida.customs.arepo.dataset.GroupAwareOperation">GroupAwareOperation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">grouped</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
    <span class="n">parttype</span><span class="o">=</span><span class="s2">"PartType0"</span><span class="p">,</span>
    <span class="n">objtype</span><span class="o">=</span><span class="s2">"halo"</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Create a GroupAwareOperation object for applying operations to groups.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fields: str | list[str] | dict[str, da.Array]</span>
<span class="sd">        Fields to pass to the operation. Can be a string, a dask array, a list of strings or a dictionary of dask arrays.</span>
<span class="sd">    parttype: str</span>
<span class="sd">        Particle type to operate on.</span>
<span class="sd">    objtype: str</span>
<span class="sd">        Type of object to operate on. Can be "halo" or "subhalo". Default: "halo"</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GroupAwareOperation</span>
<span class="sd">    """</span>
    <span class="n">inputfields</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>  <span class="c1"># if nothing is specified, we pass all we have.</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="n">fields</span><span class="p">])</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
        <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daskarr</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
        <span class="n">field_mag</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_mag</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daskarr</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_mag</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_mag</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">field_u</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">units</span>
            <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">daskarr</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">field_mag</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">)</span> <span class="o">*</span> <span class="n">field_u</span>
            <span class="p">)</span>
            <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"field"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Unknown input type '</span><span class="si">%s</span><span class="s2">' decorated with pint quantity."</span>
                <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">field_mag</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">arrdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">daskarr</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">))</span>
        <span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"field"</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">arrdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">}</span>
        <span class="n">inputfields</span> <span class="o">=</span> <span class="n">fields</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">arrdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">arrdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">inputfields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown input type '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
    <span class="n">check_shape_plausability</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">check_shape_plausability</span> <span class="ow">and</span> <span class="s2">"Coordinates"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]:</span>
        <span class="n">shape0_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="s2">"Coordinates"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">shape0_ref</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Shape mismatch: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> has shape </span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> while Coordinates has shape </span><span class="si">{</span><span class="n">shape0_ref</span><span class="si">}</span><span class="s2">. "</span>
                    <span class="sa">f</span><span class="s2">"Check parttype passed to grouped()?"</span>
                <span class="p">)</span>
    <span class="n">objtype</span> <span class="o">=</span> <span class="n">grp_type_str</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"halo"</span><span class="p">:</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"subhalo"</span><span class="p">:</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown object type '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="n">objtype</span><span class="p">)</span>

    <span class="n">gop</span> <span class="o">=</span> <span class="n">GroupAwareOperation</span><span class="p">(</span>
        <span class="n">offsets</span><span class="p">,</span>
        <span class="n">lengths</span><span class="p">,</span>
        <span class="n">arrdict</span><span class="p">,</span>
        <span class="n">inputfields</span><span class="o">=</span><span class="n">inputfields</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">gop</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.load_catalog" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_catalog</span><span class="p">(</span><span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cosmological</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">catalog_cls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Load the group catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the catalog class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>catalog_cls</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Class to use for the catalog. If None, the default catalog class is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_catalog</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cosmological</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">catalog_cls</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Load the group catalog.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    kwargs: dict</span>
<span class="sd">        Keyword arguments passed to the catalog class.</span>
<span class="sd">    catalog_cls: type</span>
<span class="sd">        Class to use for the catalog. If None, the default catalog class is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">virtualcache</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># fileprefix = catalog_kwargs.get("fileprefix", self._fileprefix_catalog)</span>
    <span class="n">prfx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fileprefix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">)</span>

    <span class="c1"># explicitly need to create unitaware class for catalog as needed</span>
    <span class="c1"># TODO: should just be determined from mixins of parent?</span>
    <span class="k">if</span> <span class="n">catalog_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">ArepoCatalog</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">catalog_cls</span>
    <span class="n">withunits</span> <span class="o">=</span> <span class="n">units</span>
    <span class="n">mixins</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">withunits</span><span class="p">:</span>
        <span class="n">mixins</span> <span class="o">+=</span> <span class="p">[</span><span class="n">UnitMixin</span><span class="p">]</span>

    <span class="n">other_mixins</span> <span class="o">=</span> <span class="n">_determine_mixins</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">mixins</span> <span class="o">+=</span> <span class="n">other_mixins</span>
    <span class="k">if</span> <span class="n">cosmological</span> <span class="ow">and</span> <span class="n">CosmologyMixin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">:</span>
        <span class="n">mixins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CosmologyMixin</span><span class="p">)</span>

    <span class="bp">cls</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>

    <span class="n">ureg</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"ureg"</span><span class="p">):</span>
        <span class="n">ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ureg</span>

    <span class="c1"># non-virtual catalog fields for better performance</span>
    <span class="n">nonvirtual_datasets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">"Group/GroupFirstSub"</span><span class="p">,</span>
        <span class="s2">"Group/GroupLenType"</span><span class="p">,</span>
        <span class="s2">"Group/GroupNsubs"</span><span class="p">,</span>
        <span class="s2">"Subhalo/SubhaloGrNr"</span><span class="p">,</span>
        <span class="s2">"Subhalo/SubhaloGroupNr"</span><span class="p">,</span>
        <span class="s2">"Subhalo/SubhaloLenType"</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span>
        <span class="n">overwrite_cache</span><span class="o">=</span><span class="n">overwrite_cache</span><span class="p">,</span>
        <span class="n">virtualcache</span><span class="o">=</span><span class="n">virtualcache</span><span class="p">,</span>
        <span class="n">nonvirtual_datasets</span><span class="o">=</span><span class="n">nonvirtual_datasets</span><span class="p">,</span>
        <span class="n">fileprefix</span><span class="o">=</span><span class="n">prfx</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
        <span class="n">ureg</span><span class="o">=</span><span class="n">ureg</span><span class="p">,</span>
        <span class="n">hints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">,</span>
        <span class="n">metadata_raw_parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">"Redshift"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span> <span class="ow">and</span> <span class="s2">"Redshift"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
        <span class="n">z_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Redshift"</span><span class="p">]</span>
        <span class="n">z_snap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Redshift"</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">z_catalog</span><span class="p">,</span> <span class="n">z_snap</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Redshift mismatch between snapshot and catalog: "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">z_snap</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="n">z_catalog</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

    <span class="c1"># merge data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">)</span>

    <span class="c1"># first snapshots often do not have groups</span>
    <span class="k">if</span> <span class="s2">"Group"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">ngkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ngkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_catalogIDs</span><span class="p">()</span>

    <span class="c1"># merge hints from snap and catalog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">merge_hints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.map_group_operation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_group_operation</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">nchunks_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunksize_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="s1">'halo'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Apply a function to each halo in the catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>objtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of object to process. Can be "halo" or "subhalo". Default: "halo"</p>
              </div>
            </td>
            <td>
                  <code>'halo'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>idxlist</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of halo indices to process. If not provided, all halos are processed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to apply to each halo. Must take a dictionary of arrays as input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cpucost_halo</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"CPU cost" of processing a single halo. This is a relative value to the processing time per input particle
used for calculating the dask chunks. Default: 1e4</p>
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nchunks_min</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of particles in a halo to process it. Default: None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize_bytes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nmax</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only process the first nmax halos.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@computedecorator</span>
<span class="k">def</span><span class="w"> </span><span class="nf">map_group_operation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span>
    <span class="n">nchunks_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">objtype</span><span class="o">=</span><span class="s2">"halo"</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Apply a function to each halo in the catalog.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objtype: str</span>
<span class="sd">        Type of object to process. Can be "halo" or "subhalo". Default: "halo"</span>
<span class="sd">    idxlist: np.ndarray | None</span>
<span class="sd">        List of halo indices to process. If not provided, all halos are processed.</span>
<span class="sd">    func: function</span>
<span class="sd">        Function to apply to each halo. Must take a dictionary of arrays as input.</span>
<span class="sd">    cpucost_halo:</span>
<span class="sd">        "CPU cost" of processing a single halo. This is a relative value to the processing time per input particle</span>
<span class="sd">        used for calculating the dask chunks. Default: 1e4</span>
<span class="sd">    nchunks_min: int | None</span>
<span class="sd">        Minimum number of particles in a halo to process it. Default: None</span>
<span class="sd">    chunksize_bytes: int | None</span>
<span class="sd">    nmax: int | None</span>
<span class="sd">        Only process the first nmax halos.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">dfltkwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"fieldnames"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fieldnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">parttype</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parttype"</span><span class="p">,</span> <span class="s2">"PartType0"</span><span class="p">)</span>
    <span class="n">entry_nbytes_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">][</span><span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">])</span>
    <span class="n">objtype</span> <span class="o">=</span> <span class="n">grp_type_str</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"halo"</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_grouplengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groupoffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"subhalo"</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">parttype</span><span class="o">=</span><span class="n">parttype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"objtype must be 'halo' or 'subhalo', not </span><span class="si">{</span><span class="n">objtype</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">arrdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">parttype</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">map_group_operation</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">,</span>
        <span class="n">lengths</span><span class="p">,</span>
        <span class="n">arrdict</span><span class="p">,</span>
        <span class="n">cpucost_halo</span><span class="o">=</span><span class="n">cpucost_halo</span><span class="p">,</span>
        <span class="n">nchunks_min</span><span class="o">=</span><span class="n">nchunks_min</span><span class="p">,</span>
        <span class="n">chunksize_bytes</span><span class="o">=</span><span class="n">chunksize_bytes</span><span class="p">,</span>
        <span class="n">entry_nbytes_in</span><span class="o">=</span><span class="n">entry_nbytes_in</span><span class="p">,</span>
        <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
        <span class="n">idxlist</span><span class="o">=</span><span class="n">idxlist</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.register_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_field</span><span class="p">(</span><span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">construct</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Register a field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of particle type</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of field</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>construct</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>construct field immediately</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_field</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">construct</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Register a field.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parttype: str</span>
<span class="sd">        name of particle type</span>
<span class="sd">    name: str</span>
<span class="sd">        name of field</span>
<span class="sd">    construct: bool</span>
<span class="sd">        construct field immediately</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">part_type_num</span><span class="p">(</span><span class="n">parttype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">construct</span><span class="p">:</span>  <span class="c1"># TODO: introduce (immediate) construct option later</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># TODO: all particle species</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">"all"</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">"PartType"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">parttype</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.return_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_data</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Return data object of this snapshot.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@ArepoSelector</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">return_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return data object of this snapshot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">return_data</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ArepoSnapshot.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Validate a path to use for instantiation of this class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate a path to use for instantiation of this class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str or pathlib.Path</span>
<span class="sd">    args:</span>
<span class="sd">    kwargs:</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">    """</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">valid</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid</span>
    <span class="c1"># Arepo has no dedicated attribute to identify such runs.</span>
    <span class="c1"># lets just query a bunch of attributes that are present for arepo runs</span>
    <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">matchingattrs</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="s2">"Git_commit"</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
    <span class="c1"># not existent for any arepo run?</span>
    <span class="n">matchingattrs</span> <span class="o">&amp;=</span> <span class="s2">"Compactify_Version"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">matchingattrs</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>

    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="scida.customs.arepo.dataset.ChainOps" class="doc doc-heading">
            <code>ChainOps</code>


</h5>


    <div class="doc doc-contents ">



        <p>Chain operations together.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ChainOps</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Chain operations together.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">funcs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize a ChainOps object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        funcs: list[function]</span>
<span class="sd">            Functions to chain together.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span> <span class="o">=</span> <span class="n">funcs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span>
            <span class="n">funcs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># so we can pass info from kwargs to map_halo_operation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"dtype"</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">chained_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">funcs</span><span class="p">):</span>
                <span class="c1"># first chain element can be multiple fields. treat separately</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cf</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cf</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cf</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span> <span class="o">=</span> <span class="n">chained_call</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.ChainOps.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">funcs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize a ChainOps object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>funcs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Functions to chain together.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">funcs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize a ChainOps object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    funcs: list[function]</span>
<span class="sd">        Functions to chain together.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span> <span class="o">=</span> <span class="n">funcs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span>
        <span class="n">funcs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># so we can pass info from kwargs to map_halo_operation</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"dtype"</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chained_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">funcs</span><span class="p">):</span>
            <span class="c1"># first chain element can be multiple fields. treat separately</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cf</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cf</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">call</span> <span class="o">=</span> <span class="n">chained_call</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="scida.customs.arepo.dataset.GroupAwareOperation" class="doc doc-heading">
            <code>GroupAwareOperation</code>


</h5>


    <div class="doc doc-contents ">



        <p>Class for applying operations to groups.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GroupAwareOperation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Class for applying operations to groups.</span>
<span class="sd">    """</span>

    <span class="n">opfuncs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="nb">sum</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">half</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">finalops</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"min"</span><span class="p">,</span> <span class="s2">"max"</span><span class="p">,</span> <span class="s2">"sum"</span><span class="p">}</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">"arrs"</span><span class="p">,</span>
        <span class="s2">"ops"</span><span class="p">,</span>
        <span class="s2">"offsets"</span><span class="p">,</span>
        <span class="s2">"lengths"</span><span class="p">,</span>
        <span class="s2">"final"</span><span class="p">,</span>
        <span class="s2">"inputfields"</span><span class="p">,</span>
        <span class="s2">"opfuncs_custom"</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">offsets</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
        <span class="n">lengths</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span>
        <span class="n">arrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span>
        <span class="n">ops</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">inputfields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrs</span> <span class="o">=</span> <span class="n">arrs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="n">inputfields</span>
        <span class="k">if</span> <span class="n">ops</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="n">ops</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Chain another operation to this one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        add_op: str or function</span>
<span class="sd">            Operation to add. Can be a string (e.g. "min", "max", "sum") or a function.</span>
<span class="sd">        final: bool</span>
<span class="sd">            Whether this is the final operation in the chain.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GroupAwareOperation</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot chain any additional operation."</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">final</span>
        <span class="n">c</span><span class="o">.</span><span class="n">opfuncs_custom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span>
        <span class="k">if</span> <span class="n">add_op</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_op</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">add_op</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">"custom"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_op</span>
                <span class="n">c</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown operation of type '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">add_op</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the minimum value for each group member.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot change input field anymore."</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"min"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the maximum value for each group member.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot change input field anymore."</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"max"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Sum the values for each group member.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot change input field anymore."</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"sum"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">half</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Half the number of particles in each group member. For testing purposes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GroupAwareOperation</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"half"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Apply a passed function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func: function</span>
<span class="sd">            Function to apply.</span>
<span class="sd">        final: bool</span>
<span class="sd">            Whether this is the final operation in the chain.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GroupAwareOperation</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="n">final</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># overwrite method so that copy holds a new ops list.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arrs</span><span class="p">,</span>
            <span class="n">ops</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">),</span>
            <span class="n">inputfields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Evaluate the operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nmax: int | None</span>
<span class="sd">            Maximum number of halos to process.</span>
<span class="sd">        idxlist: np.ndarray | None</span>
<span class="sd">            List of halo indices to process. If not provided, (and nmax not set) all halos are processed.</span>
<span class="sd">        compute: bool</span>
<span class="sd">            Whether to compute the result immediately or return a dask object to compute later.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="c1"># TODO: figure out return type</span>
        <span class="c1"># final operations: those that can only be at end of chain</span>
        <span class="c1"># intermediate operations: those that can only be prior to end of chain</span>
        <span class="n">funcdict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">funcdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs</span><span class="p">)</span>
        <span class="n">funcdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">)</span>

        <span class="n">func</span> <span class="o">=</span> <span class="n">ChainOps</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">funcdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">])</span>

        <span class="n">fieldnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">opname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"custom"</span><span class="p">):</span>
                <span class="n">dfltkwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">[</span><span class="n">opname</span><span class="p">])</span>
                <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"fieldnames"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">fieldnames</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">fieldnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">"Either pass fields to grouped(fields=...) "</span>
                        <span class="s2">"or specify fieldnames=... in applied func."</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Specify field to operate on in operation or grouped()."</span>
                <span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">map_group_operation</span><span class="p">(</span>
            <span class="n">func</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arrs</span><span class="p">,</span>
            <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
            <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
            <span class="n">idxlist</span><span class="o">=</span><span class="n">idxlist</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">compute</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.apply" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Apply a passed function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>final</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this is the final operation in the chain.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GroupAwareOperation (scida.customs.arepo.dataset.GroupAwareOperation)" href="#scida.customs.arepo.dataset.GroupAwareOperation">GroupAwareOperation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Apply a passed function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func: function</span>
<span class="sd">        Function to apply.</span>
<span class="sd">    final: bool</span>
<span class="sd">        Whether this is the final operation in the chain.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GroupAwareOperation</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="n">final</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.chain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Chain another operation to this one.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>add_op</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operation to add. Can be a string (e.g. "min", "max", "sum") or a function.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>final</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this is the final operation in the chain.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GroupAwareOperation (scida.customs.arepo.dataset.GroupAwareOperation)" href="#scida.customs.arepo.dataset.GroupAwareOperation">GroupAwareOperation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Chain another operation to this one.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    add_op: str or function</span>
<span class="sd">        Operation to add. Can be a string (e.g. "min", "max", "sum") or a function.</span>
<span class="sd">    final: bool</span>
<span class="sd">        Whether this is the final operation in the chain.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GroupAwareOperation</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">final</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot chain any additional operation."</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="n">final</span>
    <span class="n">c</span><span class="o">.</span><span class="n">opfuncs_custom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span>
    <span class="k">if</span> <span class="n">add_op</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_op</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_op</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">add_op</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">"custom"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_op</span>
            <span class="n">c</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown operation of type '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">add_op</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">c</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Evaluate the operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nmax</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of halos to process.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>idxlist</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of halo indices to process. If not provided, (and nmax not set) all halos are processed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to compute the result immediately or return a dask object to compute later.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Evaluate the operation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nmax: int | None</span>
<span class="sd">        Maximum number of halos to process.</span>
<span class="sd">    idxlist: np.ndarray | None</span>
<span class="sd">        List of halo indices to process. If not provided, (and nmax not set) all halos are processed.</span>
<span class="sd">    compute: bool</span>
<span class="sd">        Whether to compute the result immediately or return a dask object to compute later.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="c1"># TODO: figure out return type</span>
    <span class="c1"># final operations: those that can only be at end of chain</span>
    <span class="c1"># intermediate operations: those that can only be prior to end of chain</span>
    <span class="n">funcdict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">funcdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs</span><span class="p">)</span>
    <span class="n">funcdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">)</span>

    <span class="n">func</span> <span class="o">=</span> <span class="n">ChainOps</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">funcdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">])</span>

    <span class="n">fieldnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">opname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">opname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"custom"</span><span class="p">):</span>
            <span class="n">dfltkwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opfuncs_custom</span><span class="p">[</span><span class="n">opname</span><span class="p">])</span>
            <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"fieldnames"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fieldnames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">fieldnames</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fieldnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Either pass fields to grouped(fields=...) "</span>
                    <span class="s2">"or specify fieldnames=... in applied func."</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Specify field to operate on in operation or grouped()."</span>
            <span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">map_group_operation</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsets</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrs</span><span class="p">,</span>
        <span class="n">fieldnames</span><span class="o">=</span><span class="n">fieldnames</span><span class="p">,</span>
        <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
        <span class="n">idxlist</span><span class="o">=</span><span class="n">idxlist</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">compute</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.half" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">half</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Half the number of particles in each group member. For testing purposes.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="GroupAwareOperation (scida.customs.arepo.dataset.GroupAwareOperation)" href="#scida.customs.arepo.dataset.GroupAwareOperation">GroupAwareOperation</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">half</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Half the number of particles in each group member. For testing purposes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GroupAwareOperation</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"half"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.max" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">max</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the maximum value for each group member.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the maximum value for each group member.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot change input field anymore."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"max"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.min" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">min</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Get the minimum value for each group member.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the minimum value for each group member.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot change input field anymore."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"min"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.dataset.GroupAwareOperation.sum" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">sum</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Sum the values for each group member.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Sum the values for each group member.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot change input field anymore."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">add_op</span><span class="o">=</span><span class="s2">"sum"</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.compute_haloindex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_haloindex</span><span class="p">(</span><span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Computes the halo index for each particle with dask.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_haloindex</span><span class="p">(</span><span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Computes the halo index for each particle with dask."""</span>
    <span class="k">return</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span>
        <span class="n">get_hidx_daskwrap</span><span class="p">,</span>
        <span class="n">gidx</span><span class="p">,</span>
        <span class="n">halocelloffsets</span><span class="p">,</span>
        <span class="n">index_unbound</span><span class="o">=</span><span class="n">index_unbound</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.compute_haloquantity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_haloquantity</span><span class="p">(</span><span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">,</span> <span class="n">hvals</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Computes a halo quantity for each particle with dask.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_haloquantity</span><span class="p">(</span><span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">,</span> <span class="n">hvals</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Computes a halo quantity for each particle with dask."""</span>
    <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">hvals</span><span class="p">,</span> <span class="s2">"units"</span><span class="p">):</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">hvals</span><span class="o">.</span><span class="n">units</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">map_blocks</span><span class="p">(</span>
        <span class="n">get_haloquantity_daskwrap</span><span class="p">,</span>
        <span class="n">gidx</span><span class="p">,</span>
        <span class="n">halocelloffsets</span><span class="p">,</span>
        <span class="n">hvals</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">hvals</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
        <span class="n">output_units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.compute_localsubhaloindex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_localsubhaloindex</span><span class="p">(</span><span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">,</span> <span class="n">shnumber</span><span class="p">,</span> <span class="n">shcounts</span><span class="p">,</span> <span class="n">shcellcounts</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Compute the local subhalo index for each particle with dask.
The local subhalo index is the index of the subhalo within each halo,
starting at 0 for the central subhalo.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gidx</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>halocelloffsets</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shnumber</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shcounts</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shcellcounts</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_unbound</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_localsubhaloindex</span><span class="p">(</span>
    <span class="n">gidx</span><span class="p">,</span> <span class="n">halocelloffsets</span><span class="p">,</span> <span class="n">shnumber</span><span class="p">,</span> <span class="n">shcounts</span><span class="p">,</span> <span class="n">shcellcounts</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Compute the local subhalo index for each particle with dask.</span>
<span class="sd">    The local subhalo index is the index of the subhalo within each halo,</span>
<span class="sd">    starting at 0 for the central subhalo.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gidx</span>
<span class="sd">    halocelloffsets</span>
<span class="sd">    shnumber</span>
<span class="sd">    shcounts</span>
<span class="sd">    shcellcounts</span>
<span class="sd">    index_unbound</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span>
        <span class="n">get_local_shidx_daskwrap</span><span class="p">,</span>
        <span class="n">gidx</span><span class="p">,</span>
        <span class="n">halocelloffsets</span><span class="p">,</span>
        <span class="n">shnumber</span><span class="p">,</span>
        <span class="n">shcounts</span><span class="p">,</span>
        <span class="n">shcellcounts</span><span class="p">,</span>
        <span class="n">index_unbound</span><span class="o">=</span><span class="n">index_unbound</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.get_hidx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_hidx</span><span class="p">(</span><span class="n">gidx_start</span><span class="p">,</span> <span class="n">gidx_count</span><span class="p">,</span> <span class="n">celloffsets</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get halo index of a given cell</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gidx_start</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first unique integer ID for the first particle</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gidx_count</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The amount of halo indices we are querying after "gidx_start"</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>celloffsets</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array holding the starting cell offset for each halo. Needs to include the
offset after the last halo. The required shape is thus (Nhalo+1,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_unbound</code>
            </td>
            <td>
                  <code><span title="integer">integer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index to use for unbound particles. If None, the maximum integer value
of the dtype is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_hidx</span><span class="p">(</span><span class="n">gidx_start</span><span class="p">,</span> <span class="n">gidx_count</span><span class="p">,</span> <span class="n">celloffsets</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get halo index of a given cell</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gidx_start: integer</span>
<span class="sd">        The first unique integer ID for the first particle</span>
<span class="sd">    gidx_count: integer</span>
<span class="sd">        The amount of halo indices we are querying after "gidx_start"</span>
<span class="sd">    celloffsets : array</span>
<span class="sd">        An array holding the starting cell offset for each halo. Needs to include the</span>
<span class="sd">        offset after the last halo. The required shape is thus (Nhalo+1,).</span>
<span class="sd">    index_unbound : integer, optional</span>
<span class="sd">        The index to use for unbound particles. If None, the maximum integer value</span>
<span class="sd">        of the dtype is used.</span>
<span class="sd">    """</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>
    <span class="k">if</span> <span class="n">index_unbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index_unbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">index_unbound</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">gidx_count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="c1"># find initial celloffset</span>
    <span class="n">hidx_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">celloffsets</span><span class="p">,</span> <span class="n">gidx_start</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">hidx_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">celloffsets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># we are done. Already out of scope of lookup =&gt; all unbound gas.</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="n">celloffset</span> <span class="o">=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">endid</span> <span class="o">=</span> <span class="n">celloffset</span> <span class="o">-</span> <span class="n">gidx_start</span>
    <span class="n">startid</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Now iterate through list.</span>
    <span class="k">while</span> <span class="n">startid</span> <span class="o">&lt;</span> <span class="n">gidx_count</span><span class="p">:</span>
        <span class="n">res</span><span class="p">[</span><span class="n">startid</span><span class="p">:</span><span class="n">endid</span><span class="p">]</span> <span class="o">=</span> <span class="n">hidx_idx</span>
        <span class="n">hidx_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">startid</span> <span class="o">=</span> <span class="n">endid</span>
        <span class="k">if</span> <span class="n">hidx_idx</span> <span class="o">&gt;=</span> <span class="n">celloffsets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_idx</span><span class="p">]</span>
        <span class="n">endid</span> <span class="o">=</span> <span class="n">startid</span> <span class="o">+</span> <span class="n">count</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.get_localshidx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_localshidx</span><span class="p">(</span><span class="n">gidx_start</span><span class="p">,</span> <span class="n">gidx_count</span><span class="p">,</span> <span class="n">celloffsets</span><span class="p">,</span> <span class="n">shnumber</span><span class="p">,</span> <span class="n">shcounts</span><span class="p">,</span> <span class="n">shcellcounts</span><span class="p">,</span> <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the local subhalo index for each particle. This is the subhalo index within each
halo group. Particles belonging to the central galaxies will have index 0, particles
belonging to the first satellite will have index 1, etc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gidx_start</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gidx_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>celloffsets</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="numpy.int64">int64</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shnumber</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shcounts</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shcellcounts</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>index_unbound</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index to use for unbound particles. If None, the maximum integer value
of the dtype is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_localshidx</span><span class="p">(</span>
    <span class="n">gidx_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">gidx_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">celloffsets</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span>
    <span class="n">shnumber</span><span class="p">,</span>
    <span class="n">shcounts</span><span class="p">,</span>
    <span class="n">shcellcounts</span><span class="p">,</span>
    <span class="n">index_unbound</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the local subhalo index for each particle. This is the subhalo index within each</span>
<span class="sd">    halo group. Particles belonging to the central galaxies will have index 0, particles</span>
<span class="sd">    belonging to the first satellite will have index 1, etc.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    gidx_start</span>
<span class="sd">    gidx_count</span>
<span class="sd">    celloffsets</span>
<span class="sd">    shnumber</span>
<span class="sd">    shcounts</span>
<span class="sd">    shcellcounts</span>
<span class="sd">    index_unbound: integer, optional</span>
<span class="sd">        The index to use for unbound particles. If None, the maximum integer value</span>
<span class="sd">        of the dtype is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">    """</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span>
    <span class="k">if</span> <span class="n">index_unbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">index_unbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">index_unbound</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">gidx_count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>  <span class="c1"># fuzz has negative index.</span>

    <span class="c1"># find initial Group we are in</span>
    <span class="n">hidx_start_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">celloffsets</span><span class="p">,</span> <span class="n">gidx_start</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">hidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">celloffsets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># we are done. Already out of scope of lookup =&gt; all unbound gas.</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="n">celloffset</span> <span class="o">=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">endid</span> <span class="o">=</span> <span class="n">celloffset</span> <span class="o">-</span> <span class="n">gidx_start</span>
    <span class="n">startid</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># find initial subhalo we are in</span>
    <span class="n">hidx</span> <span class="o">=</span> <span class="n">hidx_start_idx</span>
    <span class="n">shcumsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shcounts</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">shcumsum</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span>
        <span class="n">shcellcounts</span><span class="p">[</span><span class="n">shnumber</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="p">:</span> <span class="n">shnumber</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="o">+</span> <span class="n">shcounts</span><span class="p">[</span><span class="n">hidx</span><span class="p">]]</span>
    <span class="p">)</span>  <span class="c1"># collect halo's subhalo offsets</span>
    <span class="n">shcumsum</span> <span class="o">+=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_start_idx</span><span class="p">]</span>
    <span class="n">sidx_start_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">shcumsum</span><span class="p">,</span> <span class="n">gidx_start</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sidx_start_idx</span> <span class="o">&lt;</span> <span class="n">shcounts</span><span class="p">[</span><span class="n">hidx</span><span class="p">]:</span>
        <span class="n">endid</span> <span class="o">=</span> <span class="n">shcumsum</span><span class="p">[</span><span class="n">sidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gidx_start</span>

    <span class="c1"># Now iterate through list.</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">cont</span> <span class="ow">and</span> <span class="p">(</span><span class="n">startid</span> <span class="o">&lt;</span> <span class="n">gidx_count</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">startid</span><span class="p">:</span><span class="n">endid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">sidx_start_idx</span> <span class="k">if</span> <span class="n">sidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">shcumsum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">sidx_start_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">sidx_start_idx</span> <span class="o">&lt;</span> <span class="n">shcounts</span><span class="p">[</span><span class="n">hidx_start_idx</span><span class="p">]:</span>
            <span class="c1"># we prepare to fill the next available subhalo for current halo</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">shcumsum</span><span class="p">[</span><span class="n">sidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shcumsum</span><span class="p">[</span><span class="n">sidx_start_idx</span><span class="p">]</span>
            <span class="n">startid</span> <span class="o">=</span> <span class="n">endid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># we need to find the next halo to start filling its subhalos</span>
            <span class="n">dbgcount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">dbgcount</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># find next halo with &gt;0 subhalos</span>
                <span class="n">hidx_start_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">hidx_start_idx</span> <span class="o">&gt;=</span> <span class="n">shcounts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">cont</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">shcounts</span><span class="p">[</span><span class="n">hidx_start_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">dbgcount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">hidx</span> <span class="o">=</span> <span class="n">hidx_start_idx</span>
            <span class="k">if</span> <span class="n">hidx_start_idx</span> <span class="o">&gt;=</span> <span class="n">celloffsets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">startid</span> <span class="o">=</span> <span class="n">gidx_count</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_start_idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hidx</span> <span class="o">&lt;</span> <span class="n">shcounts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">shcumsum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shcounts</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                    <span class="n">shcumsum</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span>
                        <span class="n">shcellcounts</span><span class="p">[</span><span class="n">shnumber</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="p">:</span> <span class="n">shnumber</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="o">+</span> <span class="n">shcounts</span><span class="p">[</span><span class="n">hidx</span><span class="p">]]</span>
                    <span class="p">)</span>
                    <span class="n">shcumsum</span> <span class="o">+=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_start_idx</span><span class="p">]</span>
                    <span class="n">sidx_start_idx</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">sidx_start_idx</span> <span class="o">&lt;</span> <span class="n">shcounts</span><span class="p">[</span><span class="n">hidx</span><span class="p">]:</span>
                        <span class="n">count</span> <span class="o">=</span> <span class="n">shcumsum</span><span class="p">[</span><span class="n">sidx_start_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shcumsum</span><span class="p">[</span><span class="n">sidx_start_idx</span><span class="p">]</span>
                    <span class="n">startid</span> <span class="o">=</span> <span class="n">celloffsets</span><span class="p">[</span><span class="n">hidx_start_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">gidx_start</span>
        <span class="n">endid</span> <span class="o">=</span> <span class="n">startid</span> <span class="o">+</span> <span class="n">count</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.get_shcounts_shcells" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_shcounts_shcells</span><span class="p">(</span><span class="n">SubhaloGrNr</span><span class="p">,</span> <span class="n">hlength</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the id of the first subhalo and count of subhalos per halo.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>SubhaloGrNr</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The group identifier that each subhalo belongs to respectively</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hlength</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of halos in the snapshot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>shcounts</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of subhalos per halo</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>shnumber</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the first subhalo per halo</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_shcounts_shcells</span><span class="p">(</span><span class="n">SubhaloGrNr</span><span class="p">,</span> <span class="n">hlength</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns the id of the first subhalo and count of subhalos per halo.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SubhaloGrNr: np.ndarray</span>
<span class="sd">        The group identifier that each subhalo belongs to respectively</span>
<span class="sd">    hlength: int</span>
<span class="sd">        The number of halos in the snapshot</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    shcounts: np.ndarray</span>
<span class="sd">        The number of subhalos per halo</span>
<span class="sd">    shnumber: np.ndarray</span>
<span class="sd">        The index of the first subhalo per halo</span>
<span class="sd">    """</span>
    <span class="n">shcounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hlength</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># number of subhalos per halo</span>
    <span class="n">shnumber</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hlength</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># index of first subhalo per halo</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hid_old</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SubhaloGrNr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">hid</span> <span class="o">=</span> <span class="n">SubhaloGrNr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hid</span> <span class="o">==</span> <span class="n">hid_old</span><span class="p">:</span>
            <span class="n">shcounts</span><span class="p">[</span><span class="n">hid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shnumber</span><span class="p">[</span><span class="n">hid</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">shcounts</span><span class="p">[</span><span class="n">hid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">hid_old</span> <span class="o">=</span> <span class="n">hid</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">shcounts</span><span class="p">,</span> <span class="n">shnumber</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.map_group_operation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_group_operation</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">arrdict</span><span class="p">,</span> <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">nchunks_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunksize_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">entry_nbytes_in</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">idxlist</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Map a function to all halos in a halo catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idxlist</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only process the halos with these indices.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nmax</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only process the first nmax halos.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offsets</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Offset of each group in the particle catalog.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lengths</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of particles per halo.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arrdict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cpucost_halo</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>10000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nchunks_min</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lower bound on the number of halos per chunk.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize_bytes</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>entry_nbytes_in</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fieldnames</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">map_group_operation</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">offsets</span><span class="p">,</span>
    <span class="n">lengths</span><span class="p">,</span>
    <span class="n">arrdict</span><span class="p">,</span>
    <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span>
    <span class="n">nchunks_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">entry_nbytes_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">fieldnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nmax</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">idxlist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Map a function to all halos in a halo catalog.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    idxlist: np.ndarray | None</span>
<span class="sd">        Only process the halos with these indices.</span>
<span class="sd">    nmax: int | None</span>
<span class="sd">        Only process the first nmax halos.</span>
<span class="sd">    func</span>
<span class="sd">    offsets: np.ndarray</span>
<span class="sd">        Offset of each group in the particle catalog.</span>
<span class="sd">    lengths: np.ndarray</span>
<span class="sd">        Number of particles per halo.</span>
<span class="sd">    arrdict</span>
<span class="sd">    cpucost_halo</span>
<span class="sd">    nchunks_min: int | None</span>
<span class="sd">        Lower bound on the number of halos per chunk.</span>
<span class="sd">    chunksize_bytes</span>
<span class="sd">    entry_nbytes_in</span>
<span class="sd">    fieldnames</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">ChainOps</span><span class="p">):</span>
        <span class="n">dfltkwargs</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">kwargs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dfltkwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fieldnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"fieldnames"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fieldnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fieldnames</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"units"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"shape"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"dtype"</span><span class="p">,</span> <span class="s2">"float64"</span><span class="p">)</span>
    <span class="n">fill_value</span> <span class="o">=</span> <span class="n">dfltkwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"fill_value"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">idxlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot specify both idxlist and nmax."</span><span class="p">)</span>

    <span class="n">lengths_all</span> <span class="o">=</span> <span class="n">lengths</span>
    <span class="n">offsets_all</span> <span class="o">=</span> <span class="n">offsets</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">):</span>
        <span class="c1"># the offsets array here is one longer here, holding the total number of particles in the last halo.</span>
        <span class="n">offsets_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">offsets_all</span><span class="p">,</span> <span class="p">[</span><span class="n">offsets_all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span>

    <span class="k">if</span> <span class="n">nmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[:</span><span class="n">nmax</span><span class="p">]</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[:</span><span class="n">nmax</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">idxlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># make sure idxlist is sorted and unique</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">idxlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"idxlist must be sorted and unique."</span><span class="p">)</span>
        <span class="c1"># make sure idxlist is within range</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">idxlist</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">idxlist</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"idxlist elements must be in [</span><span class="si">%i</span><span class="s2">, </span><span class="si">%i</span><span class="s2">), but covers range [</span><span class="si">%i</span><span class="s2">, </span><span class="si">%i</span><span class="s2">]."</span>
                <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lengths</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">idxlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">idxlist</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">idxlist</span><span class="p">]</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">idxlist</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">):</span>
        <span class="c1"># the offsets array here is one longer here, holding the total number of particles in the last halo.</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">offsets</span><span class="p">,</span> <span class="p">[</span><span class="n">offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span>

    <span class="c1"># shape/units inference</span>
    <span class="n">infer_shape</span> <span class="o">=</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shape</span> <span class="o">==</span> <span class="s2">"auto"</span><span class="p">)</span>
    <span class="n">infer_units</span> <span class="o">=</span> <span class="n">units</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="n">infer</span> <span class="o">=</span> <span class="n">infer_shape</span> <span class="ow">or</span> <span class="n">infer_units</span>
    <span class="k">if</span> <span class="n">infer</span><span class="p">:</span>
        <span class="c1"># attempt to determine shape.</span>
        <span class="k">if</span> <span class="n">infer_shape</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">"No shape specified. Attempting to determine shape of func output."</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_units</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">"No units specified. Attempting to determine units of func output."</span>
            <span class="p">)</span>
        <span class="n">arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrdict</span><span class="p">[</span><span class="n">f</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">]</span>
        <span class="c1"># remove units if present</span>
        <span class="c1"># arrs = [arr.magnitude if hasattr(arr, "magnitude") else arr for arr in arrs]</span>
        <span class="c1"># arrs = [arr.magnitude for arr in arrs]</span>
        <span class="n">dummyres</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dummyres</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">arrs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># noqa</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Exception during shape/unit inference: </span><span class="si">%s</span><span class="s2">."</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dummyres</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">infer_units</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dummyres</span><span class="p">,</span> <span class="s2">"units"</span><span class="p">):</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">dummyres</span><span class="o">.</span><span class="n">units</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Shape inference: </span><span class="si">%s</span><span class="s2">."</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">infer_units</span> <span class="ow">and</span> <span class="n">dummyres</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">units_present</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s2">"units"</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">units_present</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Exception during unit inference. Assuming no units."</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dummyres</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infer_shape</span><span class="p">:</span>
            <span class="c1"># due to https://github.com/hgrecco/pint/issues/1037 innocent np.array operations on unit scalars can fail.</span>
            <span class="c1"># we can still attempt to infer shape by removing units prior to calling func.</span>
            <span class="n">arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">magnitude</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">)</span> <span class="k">else</span> <span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dummyres</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">arrs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># noqa</span>
                <span class="c1"># no more logging needed here</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">dummyres</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infer_shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">dummyres</span><span class="p">):</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">dummyres</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">infer_shape</span> <span class="ow">and</span> <span class="n">dummyres</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Exception during shape inference. Using shape (1,)."</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">()</span>
    <span class="c1"># unit inference</span>

    <span class="c1"># Determine chunkedges automatically</span>
    <span class="c1"># TODO: very messy and inefficient routine. improve some time.</span>
    <span class="c1"># TODO: Set entry_bytes_out</span>
    <span class="n">nbytes_dtype_out</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># TODO: hardcode 4 byte output dtype as estimate for now</span>
    <span class="n">entry_nbytes_out</span> <span class="o">=</span> <span class="n">nbytes_dtype_out</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># list_chunkedges refers to bounds of index intervals to be processed together</span>
    <span class="c1"># if idxlist is specified, then these indices do not have to refer to group indices.</span>
    <span class="c1"># if idxlist is given, we enforce that particle data is contiguous</span>
    <span class="c1"># by putting each idx from idxlist into its own chunk.</span>
    <span class="c1"># in the future, we should optimize this</span>
    <span class="k">if</span> <span class="n">idxlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">list_chunkedges</span> <span class="o">=</span> <span class="p">[[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idxlist</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_chunkedges</span> <span class="o">=</span> <span class="n">map_group_operation_get_chunkedges</span><span class="p">(</span>
            <span class="n">lengths</span><span class="p">,</span>
            <span class="n">entry_nbytes_in</span><span class="p">,</span>
            <span class="n">entry_nbytes_out</span><span class="p">,</span>
            <span class="n">cpucost_halo</span><span class="o">=</span><span class="n">cpucost_halo</span><span class="p">,</span>
            <span class="n">nchunks_min</span><span class="o">=</span><span class="n">nchunks_min</span><span class="p">,</span>
            <span class="n">chunksize_bytes</span><span class="o">=</span><span class="n">chunksize_bytes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">minentry</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">maxentry</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># the last particle that needs to be processed</span>

    <span class="c1"># chunks specify the number of groups in each chunk</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">list_chunkedges</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())]</span>
    <span class="c1"># need to add chunk information for additional output axes if needed</span>
    <span class="n">new_axis</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,):</span>
        <span class="n">chunks</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]</span>
        <span class="n">new_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># slcoffsets = [offsets[chunkedge[0]] for chunkedge in list_chunkedges]</span>
    <span class="c1"># the actual length of relevant data in each chunk</span>
    <span class="n">slclengths</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">offsets</span><span class="p">[</span><span class="n">chunkedge</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">offsets</span><span class="p">[</span><span class="n">chunkedge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">chunkedge</span> <span class="ow">in</span> <span class="n">list_chunkedges</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">idxlist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># the chunk length to be fed into map_blocks</span>
        <span class="n">tmplist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">idxlist</span><span class="p">,</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">lengths_all</span><span class="p">)]])</span>
        <span class="n">slclengths_map</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">offsets_all</span><span class="p">[</span><span class="n">tmplist</span><span class="p">[</span><span class="n">chunkedge</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span> <span class="o">-</span> <span class="n">offsets_all</span><span class="p">[</span><span class="n">tmplist</span><span class="p">[</span><span class="n">chunkedge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
            <span class="k">for</span> <span class="n">chunkedge</span> <span class="ow">in</span> <span class="n">list_chunkedges</span>
        <span class="p">]</span>
        <span class="n">slcoffsets_map</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">offsets_all</span><span class="p">[</span><span class="n">tmplist</span><span class="p">[</span><span class="n">chunkedge</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">chunkedge</span> <span class="ow">in</span> <span class="n">list_chunkedges</span>
        <span class="p">]</span>
        <span class="n">slclengths_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">slcoffsets_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">slcoffsets_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slclengths_map</span> <span class="o">=</span> <span class="n">slclengths</span>

    <span class="n">slcs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">chunkedge</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chunkedge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">chunkedge</span> <span class="ow">in</span> <span class="n">list_chunkedges</span><span class="p">]</span>
    <span class="n">offsets_in_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">offsets</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span> <span class="o">-</span> <span class="n">offsets</span><span class="p">[</span><span class="n">slc</span><span class="o">.</span><span class="n">start</span><span class="p">]</span> <span class="k">for</span> <span class="n">slc</span> <span class="ow">in</span> <span class="n">slcs</span><span class="p">]</span>
    <span class="n">lengths_in_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">lengths</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span> <span class="k">for</span> <span class="n">slc</span> <span class="ow">in</span> <span class="n">slcs</span><span class="p">]</span>
    <span class="n">d_oic</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">offsets_in_chunks</span><span class="p">)</span>
    <span class="n">d_hic</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="n">lengths_in_chunks</span><span class="p">)</span>

    <span class="n">arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrdict</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">minentry</span><span class="p">:</span><span class="n">maxentry</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fieldnames</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
        <span class="n">arrchunks</span> <span class="o">=</span> <span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">slclengths</span><span class="p">)),)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">arrchunks</span> <span class="o">=</span> <span class="n">arrchunks</span> <span class="o">+</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:],)</span>
        <span class="n">arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span><span class="n">chunks</span><span class="o">=</span><span class="n">arrchunks</span><span class="p">)</span>
    <span class="n">arrdims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">])</span>

    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arrdims</span> <span class="o">==</span> <span class="n">arrdims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cannot handle different input dims for now</span>

    <span class="n">drop_axis</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">arrdims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">drop_axis</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">arrdims</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"dtype must be specified, dask will not be able to automatically determine this here."</span>
        <span class="p">)</span>

    <span class="n">calc</span> <span class="o">=</span> <span class="n">map_blocks</span><span class="p">(</span>
        <span class="n">wrap_func_scalar</span><span class="p">,</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="n">d_oic</span><span class="p">,</span>
        <span class="n">d_hic</span><span class="p">,</span>
        <span class="o">*</span><span class="n">arrs</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="n">new_axis</span><span class="o">=</span><span class="n">new_axis</span><span class="p">,</span>
        <span class="n">drop_axis</span><span class="o">=</span><span class="n">drop_axis</span><span class="p">,</span>
        <span class="n">func_output_shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">func_output_dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">,</span>
        <span class="n">output_units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">calc</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.map_group_operation_get_chunkedges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_group_operation_get_chunkedges</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">entry_nbytes_in</span><span class="p">,</span> <span class="n">entry_nbytes_out</span><span class="p">,</span> <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nchunks_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunksize_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Compute the chunking of a halo operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lengths</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of particles per halo.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>entry_nbytes_in</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>entry_nbytes_out</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cpucost_halo</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nchunks_min</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize_bytes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">map_group_operation_get_chunkedges</span><span class="p">(</span>
    <span class="n">lengths</span><span class="p">,</span>
    <span class="n">entry_nbytes_in</span><span class="p">,</span>
    <span class="n">entry_nbytes_out</span><span class="p">,</span>
    <span class="n">cpucost_halo</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">nchunks_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">chunksize_bytes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Compute the chunking of a halo operation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lengths: np.ndarray</span>
<span class="sd">        The number of particles per halo.</span>
<span class="sd">    entry_nbytes_in</span>
<span class="sd">    entry_nbytes_out</span>
<span class="sd">    cpucost_halo</span>
<span class="sd">    nchunks_min</span>
<span class="sd">    chunksize_bytes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">cpucost_particle</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># we only care about ratio, so keep particle cost fixed.</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">cpucost_particle</span> <span class="o">*</span> <span class="n">lengths</span> <span class="o">+</span> <span class="n">cpucost_halo</span>
    <span class="n">sumcost</span> <span class="o">=</span> <span class="n">cost</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

    <span class="c1"># let's allow a maximal chunksize of 16 times the dask default setting for an individual array [here: multiple]</span>
    <span class="k">if</span> <span class="n">chunksize_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">chunksize_bytes</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">parse_size</span><span class="p">(</span><span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"array.chunk-size"</span><span class="p">))</span>
    <span class="n">cost_memory</span> <span class="o">=</span> <span class="n">entry_nbytes_in</span> <span class="o">*</span> <span class="n">lengths</span> <span class="o">+</span> <span class="n">entry_nbytes_out</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chunksize_bytes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"Some halo requires more memory than allowed (</span><span class="si">%i</span><span class="s2"> allowed, </span><span class="si">%i</span><span class="s2"> requested). Consider overriding "</span>
            <span class="s2">"chunksize_bytes."</span> <span class="o">%</span> <span class="p">(</span><span class="n">chunksize_bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="n">nchunks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">)</span> <span class="o">/</span> <span class="n">chunksize_bytes</span><span class="p">))</span>
    <span class="n">nchunks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">1.3</span> <span class="o">*</span> <span class="n">nchunks</span><span class="p">))</span>  <span class="c1"># fudge factor</span>
    <span class="k">if</span> <span class="n">nchunks_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nchunks</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nchunks_min</span><span class="p">,</span> <span class="n">nchunks</span><span class="p">)</span>
    <span class="n">targetcost</span> <span class="o">=</span> <span class="n">sumcost</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">nchunks</span>  <span class="c1"># chunk target cost = total cost / nchunks</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sumcost</span> <span class="o">%</span> <span class="n">targetcost</span><span class="p">)</span>  <span class="c1"># find whenever exceeding modulo target cost</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sumcost</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sumcost</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">list_chunkedges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">list_chunkedges</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="n">list_chunkedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
        <span class="n">memorycost_limiter</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">list_chunkedges</span><span class="p">,</span> <span class="n">chunksize_bytes</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># make sure we did not lose any halos.</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
        <span class="o">~</span><span class="p">(</span><span class="n">list_chunkedges</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">list_chunkedges</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">bool</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">list_chunkedges</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.memorycost_limiter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">memorycost_limiter</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">,</span> <span class="n">cost_cpu</span><span class="p">,</span> <span class="n">list_chunkedges</span><span class="p">,</span> <span class="n">cost_memory_max</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>If a chunk too memory expensive, split into equal cpu expense operations.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">memorycost_limiter</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">,</span> <span class="n">cost_cpu</span><span class="p">,</span> <span class="n">list_chunkedges</span><span class="p">,</span> <span class="n">cost_memory_max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""If a chunk too memory expensive, split into equal cpu expense operations."""</span>
    <span class="n">list_chunkedges_new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chunkedges</span> <span class="ow">in</span> <span class="n">list_chunkedges</span><span class="p">:</span>
        <span class="n">slc</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">chunkedges</span><span class="p">)</span>
        <span class="n">totcost_mem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cost_memory</span><span class="p">[</span><span class="n">slc</span><span class="p">])</span>
        <span class="n">list_chunkedges_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunkedges</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">totcost_mem</span> <span class="o">&gt;</span> <span class="n">cost_memory_max</span><span class="p">:</span>
            <span class="n">sumcost</span> <span class="o">=</span> <span class="n">cost_cpu</span><span class="p">[</span><span class="n">slc</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
            <span class="n">sumcost</span> <span class="o">/=</span> <span class="n">sumcost</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">slc</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sumcost</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">chunkedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">chunkedges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">chunkedges1</span> <span class="o">=</span> <span class="p">[</span><span class="n">chunkedges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">]</span>
            <span class="n">chunkedges2</span> <span class="o">=</span> <span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">chunkedges</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">chunkedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">chunkedges</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"This should not happen."</span><span class="p">)</span>
            <span class="n">list_chunkedges_new</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">list_chunkedges_new</span> <span class="o">+=</span> <span class="n">memorycost_limiter</span><span class="p">(</span>
                <span class="n">cost_memory</span><span class="p">,</span> <span class="n">cost_cpu</span><span class="p">,</span> <span class="p">[</span><span class="n">chunkedges1</span><span class="p">],</span> <span class="n">cost_memory_max</span>
            <span class="p">)</span>
            <span class="n">list_chunkedges_new</span> <span class="o">+=</span> <span class="n">memorycost_limiter</span><span class="p">(</span>
                <span class="n">cost_memory</span><span class="p">,</span> <span class="n">cost_cpu</span><span class="p">,</span> <span class="p">[</span><span class="n">chunkedges2</span><span class="p">],</span> <span class="n">cost_memory_max</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">list_chunkedges_new</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.dataset.wrap_func_scalar" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_func_scalar</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">offsets_in_chunks</span><span class="p">,</span> <span class="n">lengths_in_chunks</span><span class="p">,</span> <span class="o">*</span><span class="n">arrs</span><span class="p">,</span> <span class="n">block_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">block_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">func_output_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">func_output_dtype</span><span class="o">=</span><span class="s1">'float64'</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Wrapper for applying a function to each halo in the passed chunk.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offsets_in_chunks</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lengths_in_chunks</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arrs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>block_info</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>block_id</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func_output_shape</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>(1,)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func_output_dtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>'float64'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wrap_func_scalar</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="n">offsets_in_chunks</span><span class="p">,</span>
    <span class="n">lengths_in_chunks</span><span class="p">,</span>
    <span class="o">*</span><span class="n">arrs</span><span class="p">,</span>
    <span class="n">block_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">block_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">func_output_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
    <span class="n">func_output_dtype</span><span class="o">=</span><span class="s2">"float64"</span><span class="p">,</span>
    <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Wrapper for applying a function to each halo in the passed chunk.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func</span>
<span class="sd">    offsets_in_chunks</span>
<span class="sd">    lengths_in_chunks</span>
<span class="sd">    arrs</span>
<span class="sd">    block_info</span>
<span class="sd">    block_id</span>
<span class="sd">    func_output_shape</span>
<span class="sd">    func_output_dtype</span>
<span class="sd">    fill_value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets_in_chunks</span><span class="p">[</span><span class="n">block_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths_in_chunks</span><span class="p">[</span><span class="n">block_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lengths</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fill_value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">func_output_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">func_output_dtype</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">func_output_shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,):</span>
                <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">continue</span>
        <span class="n">arrchunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="n">o</span> <span class="p">:</span> <span class="n">o</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">]</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">arrchunks</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.extra_fields" class="doc doc-heading">
            <code>extra_fields</code>


</h4>

    <div class="doc doc-contents ">

        <p>convenience file to add common fields whenever applicable</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.extra_fields.Temperature" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">Temperature</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Compute gas temperature given (ElectronAbundance,InternalEnergy) in [K].</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/extra_fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@fielddefs</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span>
    <span class="s2">"Temperature"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"ElectronAbundance"</span><span class="p">,</span> <span class="s2">"InternalEnergy"</span><span class="p">],</span> <span class="s2">"PartType0"</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Temperature</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Compute gas temperature given (ElectronAbundance,InternalEnergy) in [K]."""</span>
    <span class="n">xh</span> <span class="o">=</span> <span class="mf">0.76</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span>

    <span class="n">m_p</span> <span class="o">=</span> <span class="mf">1.672622e-24</span>  <span class="c1"># proton mass [g]</span>
    <span class="n">k_B</span> <span class="o">=</span> <span class="mf">1.380650e-16</span>  <span class="c1"># boltzmann constant [erg/K]</span>

    <span class="n">UnitEnergy_over_UnitMass</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mf">1e10</span>  <span class="c1"># standard unit system (TODO: can obtain from snapshot)</span>
    <span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">UnitEnergy_over_UnitMass</span>
    <span class="k">if</span> <span class="n">ureg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">m_p</span> <span class="o">=</span> <span class="n">m_p</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">g</span>
        <span class="n">k_B</span> <span class="o">=</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">ureg</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="n">ureg</span><span class="o">.</span><span class="n">K</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># in this case the arrs cannot have pint units</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="s2">"ElectronAbundance"</span><span class="p">],</span> <span class="s2">"units"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="s2">"InternalEnergy"</span><span class="p">],</span> <span class="s2">"units"</span><span class="p">)</span>

    <span class="n">xe</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="s2">"ElectronAbundance"</span><span class="p">]</span>
    <span class="n">u_internal</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="s2">"InternalEnergy"</span><span class="p">]</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">xh</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">xh</span> <span class="o">*</span> <span class="n">xe</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_p</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_internal</span> <span class="o">/</span> <span class="n">k_B</span> <span class="o">*</span> <span class="n">mu</span>

    <span class="k">return</span> <span class="n">temp</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.helpers" class="doc doc-heading">
            <code>helpers</code>


</h4>

    <div class="doc doc-contents ">

        <p>Helper functions for arepo snapshots/simulations.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.helpers.grp_type_str" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grp_type_str</span><span class="p">(</span><span class="n">gtype</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Mapping between common group names and numeric group types.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/helpers.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">grp_type_str</span><span class="p">(</span><span class="n">gtype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Mapping between common group names and numeric group types."""</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">gtype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"group"</span><span class="p">,</span> <span class="s2">"groups"</span><span class="p">,</span> <span class="s2">"halo"</span><span class="p">,</span> <span class="s2">"halos"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">"halo"</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">gtype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"subgroup"</span><span class="p">,</span> <span class="s2">"subgroups"</span><span class="p">,</span> <span class="s2">"subhalo"</span><span class="p">,</span> <span class="s2">"subhalos"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">"subhalo"</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown group type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">gtype</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="scida.customs.arepo.helpers.part_type_num" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">part_type_num</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Mapping between common particle names and numeric particle types.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/helpers.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">part_type_num</span><span class="p">(</span><span class="n">ptype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Mapping between common particle names and numeric particle types."""</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ptype</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"gas"</span><span class="p">,</span> <span class="s2">"cells"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"dm"</span><span class="p">,</span> <span class="s2">"darkmatter"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"dmlowres"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># only zoom simulations, not present in full periodic boxes</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"tracer"</span><span class="p">,</span> <span class="s2">"tracers"</span><span class="p">,</span> <span class="s2">"tracermc"</span><span class="p">,</span> <span class="s2">"trmc"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"star"</span><span class="p">,</span> <span class="s2">"stars"</span><span class="p">,</span> <span class="s2">"stellar"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">4</span>  <span class="c1"># only those with GFM_StellarFormationTime&gt;0</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"wind"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">4</span>  <span class="c1"># only those with GFM_StellarFormationTime&lt;0</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"bh"</span><span class="p">,</span> <span class="s2">"bhs"</span><span class="p">,</span> <span class="s2">"blackhole"</span><span class="p">,</span> <span class="s2">"blackholes"</span><span class="p">,</span> <span class="s2">"black"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">5</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptype</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"all"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.selector" class="doc doc-heading">
            <code>selector</code>


</h4>

    <div class="doc doc-contents ">

        <p>Selector for ArepoSnapshot</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="scida.customs.arepo.selector.ArepoSelector" class="doc doc-heading">
            <code>ArepoSelector</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Selector (scida.interface.Selector)" href="#scida.interface.Selector">Selector</a></code></p>



        <p>Selector for ArepoSnapshot.
Can select for haloID, subhaloID, and unbound particles.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/selector.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ArepoSelector</span><span class="p">(</span><span class="n">Selector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Selector for ArepoSnapshot.</span>
<span class="sd">    Can select for haloID, subhaloID, and unbound particles."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize the selector.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"haloID"</span><span class="p">,</span> <span class="s2">"subhaloID"</span><span class="p">,</span> <span class="s2">"localSubhaloID"</span><span class="p">,</span> <span class="s2">"unbound"</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">]):</span>
            <span class="k">return</span>  <span class="c1"># no specific selection, thus just return</span>
        <span class="n">snap</span><span class="p">:</span> <span class="n">ArepoSnapshot</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">halo_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"haloID"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">subhalo_id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"subhaloID"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">subhalo_id_local</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"localSubhaloID"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">unbound</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"unbound"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">halo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">subhalo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot select for haloID and subhaloID at the same time."</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unbound</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="p">(</span><span class="n">halo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">subhalo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Cannot select haloID/subhaloID and unbound particles at the same time."</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">subhalo_id_local</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">subhalo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Cannot select for localSubhaloID and subhaloID at the same time."</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">snap</span><span class="o">.</span><span class="n">catalog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot select for haloID without catalog loaded."</span><span class="p">)</span>

        <span class="c1"># select for halo</span>
        <span class="k">if</span> <span class="n">subhalo_id_local</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">halo_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot select for localSubhaloID without haloID."</span><span class="p">)</span>
            <span class="c1"># compute subhalo_id from subhalo_id_local</span>
            <span class="n">shid_of_first_sh</span> <span class="o">=</span> <span class="n">snap</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupFirstSub"</span><span class="p">]</span>
            <span class="n">nshs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">snap</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupNsubs"</span><span class="p">][</span><span class="n">halo_id</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">subhalo_id_local</span> <span class="o">&gt;=</span> <span class="n">nshs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"localSubhaloID exceeds number of subhalos in halo."</span><span class="p">)</span>
            <span class="n">subhalo_id</span> <span class="o">=</span> <span class="n">shid_of_first_sh</span><span class="p">[</span><span class="n">halo_id</span><span class="p">]</span> <span class="o">+</span> <span class="n">subhalo_id_local</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="n">subhalo_id</span> <span class="k">if</span> <span class="n">subhalo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">halo_id</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="s2">"subhalo"</span> <span class="k">if</span> <span class="n">subhalo_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">"halo"</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_group</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">unbound</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_unbound</span><span class="p">(</span><span class="n">snap</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_unbound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Select unbound particles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        snap: ArepoSnapshot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="c1"># for unbound gas, we start after the last halo particles</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span> <span class="o">+</span> <span class="n">lengths</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">:</span>
            <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>  <span class="c1"># hack for issue 59</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">snap</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Select particles for given group/subhalo index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        snap: ArepoSnapshot</span>
<span class="sd">        idx: int</span>
<span class="sd">        objtype: str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="c1"># TODO: test whether works for multiple groups via idx list</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="n">grp_type_str</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"halo"</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"subhalo"</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">snap</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">snap</span><span class="o">.</span><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown object type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">objtype</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">:</span>
            <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>  <span class="c1"># hack for issue 59</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
        <span class="n">snap</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.selector.ArepoSelector.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize the selector.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/selector.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize the selector.</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"haloID"</span><span class="p">,</span> <span class="s2">"subhaloID"</span><span class="p">,</span> <span class="s2">"localSubhaloID"</span><span class="p">,</span> <span class="s2">"unbound"</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.selector.ArepoSelector.select_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_group</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="s1">'Group'</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Select particles for given group/subhalo index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>snap</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>objtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>'Group'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/selector.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="s2">"Group"</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Select particles for given group/subhalo index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    snap: ArepoSnapshot</span>
<span class="sd">    idx: int</span>
<span class="sd">    objtype: str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="c1"># TODO: test whether works for multiple groups via idx list</span>
    <span class="n">objtype</span> <span class="o">=</span> <span class="n">grp_type_str</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"halo"</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s2">"subhalo"</span><span class="p">:</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">snap</span><span class="o">.</span><span class="n">get_subhalolengths</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">snap</span><span class="o">.</span><span class="n">get_subhalooffsets</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown object type: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">objtype</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">:</span>
        <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">lengths</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>  <span class="c1"># hack for issue 59</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">length</span><span class="p">]</span>
    <span class="n">snap</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.selector.ArepoSelector.select_unbound" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_unbound</span><span class="p">(</span><span class="n">snap</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Select unbound particles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>snap</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/selector.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select_unbound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Select unbound particles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    snap: ArepoSnapshot</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupLenType"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="s2">"Group"</span><span class="p">][</span><span class="s2">"GroupOffsetsType"</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="c1"># for unbound gas, we start after the last halo particles</span>
    <span class="n">offsets</span> <span class="o">=</span> <span class="n">offsets</span> <span class="o">+</span> <span class="n">lengths</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">:</span>
        <span class="n">splt</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"PartType"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">splt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">pnum</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>  <span class="c1"># hack for issue 59</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">snap</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.arepo.series" class="doc doc-heading">
            <code>series</code>


</h4>

    <div class="doc doc-contents ">

        <p>Contains Series class for Arepo simulations.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="scida.customs.arepo.series.ArepoSimulation" class="doc doc-heading">
            <code>ArepoSimulation</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GadgetStyleSimulation (scida.customs.gadgetstyle.series.GadgetStyleSimulation)" href="#scida.customs.gadgetstyle.series.GadgetStyleSimulation">GadgetStyleSimulation</a></code></p>



        <p>A series representing an Arepo simulation.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/arepo/series.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ArepoSimulation</span><span class="p">(</span><span class="n">GadgetStyleSimulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A series representing an Arepo simulation."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">async_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize an ArepoSimulation object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to the simulation folder, should contain "output" folder.</span>
<span class="sd">        lazy: bool</span>
<span class="sd">            Whether to load data files lazily.</span>
<span class="sd">        interface_kwargs: dict</span>
<span class="sd">            Additional keyword arguments passed to the interface.</span>
<span class="sd">        """</span>
        <span class="c1"># choose parent folder as path if we are passed "output" dir</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"output"</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">prefix_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="n">gpaths</span><span class="o">=</span><span class="s2">"group"</span><span class="p">)</span>
        <span class="n">arg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">gpaths</span><span class="o">=</span><span class="s2">"catalog"</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">path</span><span class="p">,</span>
            <span class="n">prefix_dict</span><span class="o">=</span><span class="n">prefix_dict</span><span class="p">,</span>
            <span class="n">arg_dict</span><span class="o">=</span><span class="n">arg_dict</span><span class="p">,</span>
            <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">,</span>
            <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate a path as a candidate for this simulation class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to validate.</span>
<span class="sd">        args: list</span>
<span class="sd">            Additional positional arguments.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Additional keyword arguments.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">            Whether the path is a candidate for this simulation class.</span>
<span class="sd">        """</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="n">fns</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">"gizmo_parameters.txt"</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="n">sprefixs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="s2">"snapshot"</span><span class="p">]</span>
        <span class="n">opath</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">if</span> <span class="s2">"output"</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
            <span class="n">opath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"output"</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">opath</span><span class="p">)</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">opath</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">folders</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sprefixs</span><span class="p">]):</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>

        <span class="c1"># actually runs with hdf5 files exist!</span>
        <span class="n">h5files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h5files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># group by prefix</span>
            <span class="n">prfxs_lst</span> <span class="o">=</span> <span class="n">group_by_common_prefix</span><span class="p">(</span><span class="n">h5files</span><span class="p">)</span>
            <span class="c1"># sort by number of files per prefix</span>
            <span class="n">prfxs_lst</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prfxs_lst</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># take the longest prefix</span>
            <span class="n">prfx</span> <span class="o">=</span> <span class="n">prfxs_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># if we have more than one file for this prefix, we might have a series...</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prfx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># ... but in this case all hdf5 files should only have NumFilesPerSnapshot == 1</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">h5files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prfx</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">opath</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">"Header"</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">"NumFilesPerSnapshot"</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s2">"Header"</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s2">"Header"</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">"NumFilesPerSnapshot"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
        <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.series.ArepoSimulation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">async_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize an ArepoSimulation object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the simulation folder, should contain "output" folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lazy</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to load data files lazily.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to the interface.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">async_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize an ArepoSimulation object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to the simulation folder, should contain "output" folder.</span>
<span class="sd">    lazy: bool</span>
<span class="sd">        Whether to load data files lazily.</span>
<span class="sd">    interface_kwargs: dict</span>
<span class="sd">        Additional keyword arguments passed to the interface.</span>
<span class="sd">    """</span>
    <span class="c1"># choose parent folder as path if we are passed "output" dir</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"output"</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="n">prefix_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="n">gpaths</span><span class="o">=</span><span class="s2">"group"</span><span class="p">)</span>
    <span class="n">arg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">gpaths</span><span class="o">=</span><span class="s2">"catalog"</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">path</span><span class="p">,</span>
        <span class="n">prefix_dict</span><span class="o">=</span><span class="n">prefix_dict</span><span class="p">,</span>
        <span class="n">arg_dict</span><span class="o">=</span><span class="n">arg_dict</span><span class="p">,</span>
        <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">,</span>
        <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.arepo.series.ArepoSimulation.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Validate a path as a candidate for this simulation class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional positional arguments.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the path is a candidate for this simulation class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/arepo/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate a path as a candidate for this simulation class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to validate.</span>
<span class="sd">    args: list</span>
<span class="sd">        Additional positional arguments.</span>
<span class="sd">    kwargs:</span>
<span class="sd">        Additional keyword arguments.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">        Whether the path is a candidate for this simulation class.</span>
<span class="sd">    """</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="n">fns</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">"gizmo_parameters.txt"</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="n">sprefixs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"snapdir"</span><span class="p">,</span> <span class="s2">"snapshot"</span><span class="p">]</span>
    <span class="n">opath</span> <span class="o">=</span> <span class="n">path</span>
    <span class="k">if</span> <span class="s2">"output"</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
        <span class="n">opath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"output"</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">opath</span><span class="p">)</span>
    <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">opath</span><span class="p">,</span> <span class="n">f</span><span class="p">))]</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">folders</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sprefixs</span><span class="p">]):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>

    <span class="c1"># actually runs with hdf5 files exist!</span>
    <span class="n">h5files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h5files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># group by prefix</span>
        <span class="n">prfxs_lst</span> <span class="o">=</span> <span class="n">group_by_common_prefix</span><span class="p">(</span><span class="n">h5files</span><span class="p">)</span>
        <span class="c1"># sort by number of files per prefix</span>
        <span class="n">prfxs_lst</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prfxs_lst</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># take the longest prefix</span>
        <span class="n">prfx</span> <span class="o">=</span> <span class="n">prfxs_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if we have more than one file for this prefix, we might have a series...</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prfx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># ... but in this case all hdf5 files should only have NumFilesPerSnapshot == 1</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">h5files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prfx</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">opath</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">"Header"</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">"NumFilesPerSnapshot"</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s2">"Header"</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s2">"Header"</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">"NumFilesPerSnapshot"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">YES</span>
    <span class="k">return</span> <span class="n">valid</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="scida.customs.gadgetstyle" class="doc doc-heading">
            <code>gadgetstyle</code>


</h3>

    <div class="doc doc-contents ">










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h4 id="scida.customs.gadgetstyle.dataset" class="doc doc-heading">
            <code>dataset</code>


</h4>

    <div class="doc doc-contents ">

        <p>Defines the GadgetStyleSnapshot class, mostly used for deriving subclasses for related codes/simulations.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot" class="doc doc-heading">
            <code>GadgetStyleSnapshot</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Dataset (scida.interface.Dataset)" href="#scida.interface.Dataset">Dataset</a></code></p>



        <p>A dataset representing a Gadget-style snapshot.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/gadgetstyle/dataset.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GadgetStyleSnapshot</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A dataset representing a Gadget-style snapshot."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">virtualcache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""We define gadget-style snapshots as nbody/hydrodynamical simulation snapshots that follow</span>
<span class="sd">        the common /PartType0, /PartType1 grouping scheme."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">virtualcache</span><span class="o">=</span><span class="n">virtualcache</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">defaultattributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"config"</span><span class="p">,</span> <span class="s2">"header"</span><span class="p">,</span> <span class="s2">"parameters"</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">defaultattributes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">"BoxSize"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">"BoxSize"</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">"Boxsize"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">"Boxsize"</span><span class="p">]</span>

        <span class="n">sanity_check</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"sanity_check"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">key_nparts</span> <span class="o">=</span> <span class="s2">"NumPart_Total"</span>
        <span class="n">key_nparts_hw</span> <span class="o">=</span> <span class="s2">"NumPart_Total_HighWord"</span>
        <span class="k">if</span> <span class="n">sanity_check</span> <span class="ow">and</span> <span class="n">key_nparts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="ow">and</span> <span class="n">key_nparts_hw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
            <span class="n">nparts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">key_nparts_hw</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">key_nparts</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nparts</span><span class="p">):</span>
                <span class="n">pkey</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">pkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                    <span class="n">pdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pkey</span><span class="p">]</span>
                    <span class="n">fkey</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">pdata</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                    <span class="n">nparts_loaded</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">nparts_loaded</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">"Number of particles in header (</span><span class="si">%i</span><span class="s2">) does not match number of particles loaded (</span><span class="si">%i</span><span class="s2">) "</span>
                            <span class="s2">"for particle type </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nparts_loaded</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_fileprefix</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the fileprefix used to identify files belonging to given dataset.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str, os.PathLike</span>
<span class="sd">            path to check</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">""</span>  <span class="c1"># nothing to do, we have a single file, not a directory</span>
        <span class="c1"># order matters: groups will be taken before fof_subhalo, requires py&gt;3.7 for dict order</span>
        <span class="n">prfxs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"groups"</span><span class="p">,</span> <span class="s2">"fof_subhalo"</span><span class="p">,</span> <span class="s2">"snap"</span><span class="p">]</span>
        <span class="n">prfxs_prfx_sim</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">prfxs</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="n">prfxs_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">"^(\w*)_(\d*)"</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">prfxs_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">prfxs_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">prfxs_prfx_sim</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">prfxs_lst</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
        <span class="n">prfxs</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">prfxs_lst</span><span class="p">)</span>
        <span class="n">prfxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prfxs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prfxs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"We have more than one prefix avail: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">prfxs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prfxs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">""</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">prfxs</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">"groups"</span><span class="p">,</span> <span class="s2">"fof_subhalo_tab"</span><span class="p">}:</span>
            <span class="k">return</span> <span class="s2">"groups"</span>  <span class="c1"># "groups" over "fof_subhalo_tab"</span>
        <span class="k">return</span> <span class="n">prfxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">expect_grp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Check if path is valid for this interface.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str, os.PathLike</span>
<span class="sd">            path to check</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        """</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="n">iszarr</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">iszarr</span><span class="p">:</span>
            <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">sufxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">iszarr</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sufxs</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
            <span class="k">if</span> <span class="n">sufxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"hdf5"</span><span class="p">:</span>
                <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
        <span class="k">if</span> <span class="n">possibly_valid</span> <span class="o">!=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
            <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># need some silly combination of attributes to be sure</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">k</span> <span class="ow">in</span> <span class="n">metadata_raw</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"/Header"</span><span class="p">]]):</span>
                <span class="c1"># tng-project.org api snapshots do not have "NumPart_Total" in header</span>
                <span class="n">is_zoom</span> <span class="o">=</span> <span class="s2">"CutoutID"</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
                <span class="n">headerattrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"NumPart_ThisFile"</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_zoom</span><span class="p">:</span>
                    <span class="n">headerattrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"NumPart_Total"</span><span class="p">)</span>

                <span class="c1"># identifying snapshot or group catalog</span>
                <span class="n">is_snap</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">k</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">headerattrs</span><span class="p">])</span>
                <span class="n">is_grp</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">k</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"Ngroups_ThisFile"</span><span class="p">,</span> <span class="s2">"Ngroups_Total"</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">is_grp</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
                <span class="k">if</span> <span class="n">is_snap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expect_grp</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Register a field for a given particle type by returning through decorator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parttype: str | list[str] | None</span>
<span class="sd">            Particle type name to register with. If None, register for the base field container.</span>
<span class="sd">        name: str | None</span>
<span class="sd">            Name of the field to register.</span>
<span class="sd">        description: str | None</span>
<span class="sd">            Description of the field to register.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        callable</span>

<span class="sd">        """</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span><span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secondobj</span><span class="p">,</span> <span class="n">fieldname_suffix</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">root_group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Merge data from other snapshot into self.data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        secondobj: GadgetStyleSnapshot</span>
<span class="sd">        fieldname_suffix: str</span>
<span class="sd">        root_group: str | None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        """</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">root_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">root_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">root_group</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">root_group</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">fieldname_suffix</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Not overwriting field '</span><span class="si">%s</span><span class="s2">' during merge_data."</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">secondobj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span><span class="p">[</span><span class="s2">"snap"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secondobj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Merge hints from other snapshot into self.hints.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        secondobj: GadgetStyleSnapshot</span>
<span class="sd">            Other snapshot to merge hints from.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="c1"># merge hints from snap and catalog</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># merge dicts</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># nothing to do; we do not overwrite with catalog props</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_metadata_from_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rawmetadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Set metadata from raw metadata.</span>
<span class="sd">        """</span>
        <span class="c1"># check whether we inherit from CosmologyMixin</span>
        <span class="n">cosmological</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">CosmologyMixin</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">"/Header"</span> <span class="ow">in</span> <span class="n">rawmetadata</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">rawmetadata</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cosmological</span> <span class="ow">and</span> <span class="s2">"Redshift"</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">"redshift"</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_scalar</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">"Redshift"</span><span class="p">])</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">"z"</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">"redshift"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"BoxSize"</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="c1"># can be scalar or array</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">"boxsize"</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s2">"BoxSize"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"Time"</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">"time"</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_scalar</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s2">"Time"</span><span class="p">])</span>
                <span class="n">metadata</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">"time"</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">metadata</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Set metadata from header and config.</span>
<span class="sd">        """</span>
        <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_metadata_from_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">md</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">virtualcache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>We define gadget-style snapshots as nbody/hydrodynamical simulation snapshots that follow
the common /PartType0, /PartType1 grouping scheme.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/gadgetstyle/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">,</span> <span class="n">virtualcache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""We define gadget-style snapshots as nbody/hydrodynamical simulation snapshots that follow</span>
<span class="sd">    the common /PartType0, /PartType1 grouping scheme."""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">virtualcache</span><span class="o">=</span><span class="n">virtualcache</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">defaultattributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"config"</span><span class="p">,</span> <span class="s2">"header"</span><span class="p">,</span> <span class="s2">"parameters"</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">defaultattributes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"BoxSize"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">"BoxSize"</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">"Boxsize"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">"Boxsize"</span><span class="p">]</span>

    <span class="n">sanity_check</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"sanity_check"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">key_nparts</span> <span class="o">=</span> <span class="s2">"NumPart_Total"</span>
    <span class="n">key_nparts_hw</span> <span class="o">=</span> <span class="s2">"NumPart_Total_HighWord"</span>
    <span class="k">if</span> <span class="n">sanity_check</span> <span class="ow">and</span> <span class="n">key_nparts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="ow">and</span> <span class="n">key_nparts_hw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">:</span>
        <span class="n">nparts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">key_nparts_hw</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">key_nparts</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nparts</span><span class="p">):</span>
            <span class="n">pkey</span> <span class="o">=</span> <span class="s2">"PartType</span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">pkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">pdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pkey</span><span class="p">]</span>
                <span class="n">fkey</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">pdata</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="n">nparts_loaded</span> <span class="o">=</span> <span class="n">pdata</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">nparts_loaded</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">"Number of particles in header (</span><span class="si">%i</span><span class="s2">) does not match number of particles loaded (</span><span class="si">%i</span><span class="s2">) "</span>
                        <span class="s2">"for particle type </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nparts_loaded</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.merge_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_data</span><span class="p">(</span><span class="n">secondobj</span><span class="p">,</span> <span class="n">fieldname_suffix</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">root_group</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Merge data from other snapshot into self.data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>secondobj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fieldname_suffix</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root_group</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/gadgetstyle/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secondobj</span><span class="p">,</span> <span class="n">fieldname_suffix</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">root_group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Merge data from other snapshot into self.data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    secondobj: GadgetStyleSnapshot</span>
<span class="sd">    fieldname_suffix: str</span>
<span class="sd">    root_group: str | None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">root_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">root_group</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">root_group</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">root_group</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">fieldname_suffix</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Not overwriting field '</span><span class="si">%s</span><span class="s2">' during merge_data."</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">secondobj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span><span class="p">[</span><span class="s2">"snap"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.merge_hints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_hints</span><span class="p">(</span><span class="n">secondobj</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Merge hints from other snapshot into self.hints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>secondobj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Other snapshot to merge hints from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/gadgetstyle/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_hints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secondobj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Merge hints from other snapshot into self.hints.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    secondobj: GadgetStyleSnapshot</span>
<span class="sd">        Other snapshot to merge hints from.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="c1"># merge hints from snap and catalog</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># merge dicts</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondobj</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="n">h</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># nothing to do; we do not overwrite with catalog props</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.register_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_field</span><span class="p">(</span><span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Register a field for a given particle type by returning through decorator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parttype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Particle type name to register with. If None, register for the base field container.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the field to register.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the field to register.</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/gadgetstyle/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Register a field for a given particle type by returning through decorator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parttype: str | list[str] | None</span>
<span class="sd">        Particle type name to register with. If None, register for the base field container.</span>
<span class="sd">    name: str | None</span>
<span class="sd">        Name of the field to register.</span>
<span class="sd">    description: str | None</span>
<span class="sd">        Description of the field to register.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    callable</span>

<span class="sd">    """</span>
    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">register_field</span><span class="p">(</span><span class="n">parttype</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="scida.customs.gadgetstyle.dataset.GadgetStyleSnapshot.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">expect_grp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


    <div class="doc doc-contents ">

        <p>Check if path is valid for this interface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="os.PathLike">PathLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/gadgetstyle/dataset.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">expect_grp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Check if path is valid for this interface.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str, os.PathLike</span>
<span class="sd">        path to check</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">    """</span>
    <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="n">iszarr</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">iszarr</span><span class="p">:</span>
        <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sufxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">iszarr</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sufxs</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
        <span class="k">if</span> <span class="n">sufxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"hdf5"</span><span class="p">:</span>
            <span class="n">possibly_valid</span> <span class="o">=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
    <span class="k">if</span> <span class="n">possibly_valid</span> <span class="o">!=</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span><span class="p">:</span>
        <span class="n">metadata_raw</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># need some silly combination of attributes to be sure</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">k</span> <span class="ow">in</span> <span class="n">metadata_raw</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"/Header"</span><span class="p">]]):</span>
            <span class="c1"># tng-project.org api snapshots do not have "NumPart_Total" in header</span>
            <span class="n">is_zoom</span> <span class="o">=</span> <span class="s2">"CutoutID"</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
            <span class="n">headerattrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"NumPart_ThisFile"</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_zoom</span><span class="p">:</span>
                <span class="n">headerattrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"NumPart_Total"</span><span class="p">)</span>

            <span class="c1"># identifying snapshot or group catalog</span>
            <span class="n">is_snap</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">k</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">headerattrs</span><span class="p">])</span>
            <span class="n">is_grp</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">k</span> <span class="ow">in</span> <span class="n">metadata_raw</span><span class="p">[</span><span class="s2">"/Header"</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"Ngroups_ThisFile"</span><span class="p">,</span> <span class="s2">"Ngroups_Total"</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">is_grp</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
            <span class="k">if</span> <span class="n">is_snap</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expect_grp</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
    <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="scida.customs.gadgetstyle.series" class="doc doc-heading">
            <code>series</code>


</h4>

    <div class="doc doc-contents ">

        <p>Defines a series representing a Gadget-style simulation.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h5 id="scida.customs.gadgetstyle.series.GadgetStyleSimulation" class="doc doc-heading">
            <code>GadgetStyleSimulation</code>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DatasetSeries (scida.series.DatasetSeries)" href="#scida.series.DatasetSeries">DatasetSeries</a></code></p>



        <p>A series representing a Gadget-style simulation.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/customs/gadgetstyle/series.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GadgetStyleSimulation</span><span class="p">(</span><span class="n">DatasetSeries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A series representing a Gadget-style simulation."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">,</span>
        <span class="n">prefix_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">subpath_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">arg_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize a GadgetStyleSimulation object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to the simulation folder, should contain "output" folder.</span>
<span class="sd">        prefix_dict: dict</span>
<span class="sd">        subpath_dict: dict</span>
<span class="sd">        arg_dict: dict</span>
<span class="sd">        lazy: bool</span>
<span class="sd">        interface_kwargs: dict</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">subpath_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">subpath_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arg_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">paths_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">prefix_dict</span><span class="p">,</span> <span class="n">subpath_dict</span><span class="p">,</span> <span class="n">arg_dict</span><span class="p">]:</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">subpath</span> <span class="o">=</span> <span class="n">subpath_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">"output"</span><span class="p">)</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">subpath</span>
            <span class="c1"># by default, we assume that we are given a folder that has an "output" subfolder.</span>
            <span class="c1"># this is not always the case - for example for subboxes.</span>
            <span class="c1"># in such case, we attempt to continue with the given path.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">sp</span> <span class="o">=</span> <span class="n">p</span>

            <span class="c1"># normally, runs have subfolders for each snapshot...</span>
            <span class="n">found_prefix</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">_get_snapshotfolder_prefix</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">"paths"</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># do not require optional sources</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span> <span class="o">/</span> <span class="n">subpath</span><span class="p">))</span>
            <span class="n">fns</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
            <span class="n">prfxs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fns</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prfxs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">"paths"</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># do not require optional sources</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">found_prefix</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">prfx</span> <span class="o">=</span> <span class="n">prfxs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="c1"># ... however, sometimes runs have single-file hdf5 snapshots</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_prefix</span><span class="p">:</span>
                <span class="n">h5files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fns</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)]</span>
                <span class="c1"># we only test "snap" prefix for now...</span>
                <span class="n">prfx_tmp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"gpaths"</span><span class="p">:</span> <span class="s2">"group"</span><span class="p">,</span> <span class="s2">"paths"</span><span class="p">:</span> <span class="s2">"snap"</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prfx_tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">h5files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prfx_tmp</span> <span class="o">+</span> <span class="s2">"_"</span><span class="p">)</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">prfx</span> <span class="o">=</span> <span class="n">prfx_tmp</span>
                        <span class="n">found_prefix</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_prefix</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Could not find any files with prefix '</span><span class="si">%s</span><span class="s2">' in '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="n">paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">prfx</span> <span class="o">+</span> <span class="s2">"_*"</span><span class="p">)])</span>
            <span class="c1"># sometimes there are backup folders with different suffix, exclude those.</span>

            <span class="c1"># now sort by snapshot order</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">p</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># attempt sorting</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nmbrs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nmbrs</span><span class="p">,</span> <span class="n">paths</span><span class="p">))]</span>
            <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa</span>
                <span class="k">pass</span>
            <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">paths</span>

        <span class="c1"># make sure we have the same amount of paths respectively</span>
        <span class="n">length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">mismatch_length</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
                    <span class="n">mismatch_length</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">mismatch_length</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"""Mismatch between number of groups and snapshots.</span>
<span class="s2">                     Only loading groups that have a snapshot associated."""</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># extract ids</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="p">[</span><span class="s2">"paths"</span><span class="p">]</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">"paths"</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"paths"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Could not find any snapshot paths."</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">_determine_type</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">mixins</span> <span class="o">=</span> <span class="n">_determine_mixins</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">arg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">"catalog"</span><span class="p">):</span> <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h6 id="scida.customs.gadgetstyle.series.GadgetStyleSimulation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">prefix_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subpath_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span></code>

</h6>


    <div class="doc doc-contents ">

        <p>Initialize a GadgetStyleSimulation object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the simulation folder, should contain "output" folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefix_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subpath_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arg_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lazy</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/customs/gadgetstyle/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">,</span>
    <span class="n">prefix_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">subpath_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">arg_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize a GadgetStyleSimulation object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to the simulation folder, should contain "output" folder.</span>
<span class="sd">    prefix_dict: dict</span>
<span class="sd">    subpath_dict: dict</span>
<span class="sd">    arg_dict: dict</span>
<span class="sd">    lazy: bool</span>
<span class="sd">    interface_kwargs: dict</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prefix_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prefix_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">subpath_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">subpath_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">arg_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arg_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">paths_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="n">prefix_dict</span><span class="p">,</span> <span class="n">subpath_dict</span><span class="p">,</span> <span class="n">arg_dict</span><span class="p">]:</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">subpath</span> <span class="o">=</span> <span class="n">subpath_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">"output"</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">/</span> <span class="n">subpath</span>
        <span class="c1"># by default, we assume that we are given a folder that has an "output" subfolder.</span>
        <span class="c1"># this is not always the case - for example for subboxes.</span>
        <span class="c1"># in such case, we attempt to continue with the given path.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">p</span>

        <span class="c1"># normally, runs have subfolders for each snapshot...</span>
        <span class="n">found_prefix</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">_get_snapshotfolder_prefix</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">"paths"</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># do not require optional sources</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span> <span class="o">/</span> <span class="n">subpath</span><span class="p">))</span>
        <span class="n">fns</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="n">prfxs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fns</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prfxs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">"paths"</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># do not require optional sources</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found_prefix</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">prfx</span> <span class="o">=</span> <span class="n">prfxs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c1"># ... however, sometimes runs have single-file hdf5 snapshots</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_prefix</span><span class="p">:</span>
            <span class="n">h5files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fns</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)]</span>
            <span class="c1"># we only test "snap" prefix for now...</span>
            <span class="n">prfx_tmp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"gpaths"</span><span class="p">:</span> <span class="s2">"group"</span><span class="p">,</span> <span class="s2">"paths"</span><span class="p">:</span> <span class="s2">"snap"</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prfx_tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">h5files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prfx_tmp</span> <span class="o">+</span> <span class="s2">"_"</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prfx</span> <span class="o">=</span> <span class="n">prfx_tmp</span>
                    <span class="n">found_prefix</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_prefix</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Could not find any files with prefix '</span><span class="si">%s</span><span class="s2">' in '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">prfx</span> <span class="o">+</span> <span class="s2">"_*"</span><span class="p">)])</span>
        <span class="c1"># sometimes there are backup folders with different suffix, exclude those.</span>

        <span class="c1"># now sort by snapshot order</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">p</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># attempt sorting</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nmbrs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".hdf5"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nmbrs</span><span class="p">,</span> <span class="n">paths</span><span class="p">))]</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa</span>
            <span class="k">pass</span>
        <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">paths</span>

    <span class="c1"># make sure we have the same amount of paths respectively</span>
    <span class="n">length</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mismatch_length</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
                <span class="n">mismatch_length</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">mismatch_length</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">"""Mismatch between number of groups and snapshots.</span>
<span class="s2">                 Only loading groups that have a snapshot associated."""</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># extract ids</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="p">[</span><span class="s2">"paths"</span><span class="p">]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">"paths"</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>

    <span class="n">paths</span> <span class="o">=</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"paths"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Could not find any snapshot paths."</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">_determine_type</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">mixins</span> <span class="o">=</span> <span class="n">_determine_mixins</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">arg_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">"catalog"</span><span class="p">):</span> <span class="n">paths_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">paths_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.discovertypes" class="doc doc-heading">
            <code>discovertypes</code>


</h2>

    <div class="doc doc-contents ">

        <p>Functionality to determine the dataset or dataseries type of a given path.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="scida.discovertypes.CandidateStatus" class="doc doc-heading">
            <code>CandidateStatus</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>



        <p>Enum to indicate our confidence in a candidate.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/discovertypes.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CandidateStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Enum to indicate our confidence in a candidate.</span>
<span class="sd">    """</span>

    <span class="c1"># TODO: Rethink how tu use MAYBE/YES information.</span>
    <span class="n">NO</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># definitely not a candidate</span>
    <span class="n">MAYBE</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># not sure yet</span>
    <span class="n">YES</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># yes, this is a candidate</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="scida.discovertypes.is_valid_candidate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_valid_candidate</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Map mix of old bool and new Candidate Status enum to bool.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>val</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to map.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/discovertypes.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_valid_candidate</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Map mix of old bool and new Candidate Status enum to bool.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val: bool or CandidateStatus</span>
<span class="sd">        Value to map.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">MAYBE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">val</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.fields" class="doc doc-heading">
            <code>fields</code>


</h2>

    <div class="doc doc-contents ">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="scida.fields.DerivedFieldRecipe" class="doc doc-heading">
            <code>DerivedFieldRecipe</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FieldRecipe (scida.fields.FieldRecipe)" href="#scida.fields.FieldRecipe">FieldRecipe</a></code></p>



        <p>Recipe for a derived field.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/fields.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DerivedFieldRecipe</span><span class="p">(</span><span class="n">FieldRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recipe for a derived field.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""See FieldRecipe for parameters."""</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
            <span class="n">ftype</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.fields.DerivedFieldRecipe.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>See FieldRecipe for parameters.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""See FieldRecipe for parameters."""</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
        <span class="n">ftype</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="n">DERIVED</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.fields.FieldContainer" class="doc doc-heading">
            <code>FieldContainer</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="collections.abc.MutableMapping">MutableMapping</span></code></p>



        <p>A mutable collection of fields. Attempt to construct from derived fields recipes
if needed.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/fields.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FieldContainer</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A mutable collection of fields. Attempt to construct from derived fields recipes</span>
<span class="sd">    if needed."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">fieldrecipes_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">containers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">aliases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">withunits</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">FieldContainer</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Construct a FieldContainer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args</span>
<span class="sd">        fieldrecipes_kwargs: dict</span>
<span class="sd">            default kwargs used for field recipes</span>
<span class="sd">        containers: list[FieldContainer, str]</span>
<span class="sd">            list of containers to add. FieldContainers in the list will be deep copied.</span>
<span class="sd">            If a list element is a string, a new FieldContainer with the given name will be created.</span>
<span class="sd">        aliases</span>
<span class="sd">        withunits</span>
<span class="sd">        ureg</span>
<span class="sd">        parent: FieldContainer | None</span>
<span class="sd">            parent container</span>
<span class="sd">        kwargs</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">aliases</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aliases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">fieldrecipes_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fieldrecipes_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FieldRecipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fieldlength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span> <span class="o">=</span> <span class="n">fieldrecipes_kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span> <span class="o">=</span> <span class="n">withunits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">UnitRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">ureg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">dict</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># other containers as subgroups</span>
        <span class="k">if</span> <span class="n">containers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"uid"</span><span class="p">]</span>  <span class="c1"># names of internal fields/groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_ureg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Set the unit registry.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ureg: pint.UnitRegistry</span>
<span class="sd">            Unit registry.</span>
<span class="sd">        discover: bool</span>
<span class="sd">            Attempt to discover unit registry from fields.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">ureg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">discover</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Need to specify ureg or set discover=True."</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ureg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">discover</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">withgroups</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withinternal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s2">"units"</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Unit</span><span class="p">):</span>
                        <span class="n">ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">_REGISTRY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span> <span class="o">=</span> <span class="n">ureg</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_ureg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the unit registry.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">discover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_ureg</span><span class="p">(</span><span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Copy the skeleton of the container (i.e., only the containers, not the fields).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FieldContainer</span>
<span class="sd">        """</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cntr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">cntr</span><span class="o">.</span><span class="n">copy_skeleton</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a string representation of the object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level: int</span>
<span class="sd">            Level in case of nested containers.</span>
<span class="sd">        name:</span>
<span class="sd">            Name of the container.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        """</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldlength</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldcount</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">ncontainers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">)</span>
        <span class="n">statstrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">statstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"fields: </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>
            <span class="n">statstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"entries: </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncontainers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">statstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"containers: </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">ncontainers</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statstrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">statstr</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">statstrs</span><span class="p">)</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s2">"+"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">"(</span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">statstr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="n">v</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rep</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="n">FieldContainer</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Merge another FieldContainer into this one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        collection: FieldContainer</span>
<span class="sd">            Container to merge.</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            Overwrite existing fields if true.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Can only merge FieldContainers."</span><span class="p">)</span>
        <span class="c1"># TODO: support nested containers</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">c2</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">c2</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">)</span>
        <span class="c1"># now do the fields in the root container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">collection</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">collection</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fieldcount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return the number of fields.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        """</span>
        <span class="n">rcps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">)</span>
        <span class="n">flds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internals</span><span class="p">])</span>
        <span class="n">ntot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rcps</span> <span class="o">|</span> <span class="n">flds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ntot</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fieldlength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Try to infer the number of entries for the fields in this container.</span>
<span class="sd">        If all fields have the same length, return this length. Otherwise, return None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[int]</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldlength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldlength</span>
        <span class="n">fvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">itr</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">fvals</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fvals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># can we infer from recipes?</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># get first recipe</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">evaluate_recipe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">itr</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fieldlength</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldlength</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">withgroups</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">withrecipes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">withinternal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">withfields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a list of keys in the container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        withgroups: bool</span>
<span class="sd">            Include sub-containers.</span>
<span class="sd">        withrecipes: bool</span>
<span class="sd">            Include recipes (i.e. not yet instantiated fields).</span>
<span class="sd">        withinternal: bool</span>
<span class="sd">            Include internal fields.</span>
<span class="sd">        withfields: bool</span>
<span class="sd">            Include fields.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="n">fieldkeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recipekeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">withfields</span><span class="p">:</span>
            <span class="n">fieldkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">withinternal</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ikey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ikey</span> <span class="ow">in</span> <span class="n">fieldkeys</span><span class="p">:</span>
                        <span class="n">fieldkeys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">withrecipes</span><span class="p">:</span>
            <span class="n">recipekeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">fieldkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fieldkeys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">recipekeys</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">withgroups</span><span class="p">:</span>
            <span class="n">groupkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">fieldkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fieldkeys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">groupkeys</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fieldkeys</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withfields</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a list of tuples for keys/values in the container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        withrecipes: bool</span>
<span class="sd">            Whether to include recipes.</span>
<span class="sd">        withfields: bool</span>
<span class="sd">            Whether to include fields.</span>
<span class="sd">        evaluate: bool</span>
<span class="sd">            Whether to evaluate recipes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">evaluate_recipe</span><span class="o">=</span><span class="n">evaluate</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">withrecipes</span><span class="o">=</span><span class="n">withrecipes</span><span class="p">,</span> <span class="n">withfields</span><span class="o">=</span><span class="n">withfields</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return fields/recipes the container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        evaluate: bool</span>
<span class="sd">            Whether to evaluate recipes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">evaluate_recipe</span><span class="o">=</span><span class="n">evaluate</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_field</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">containernames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Decorator to register a field recipe.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        containernames: str | list[str] | None</span>
<span class="sd">            Name of the sub-container(s) to register to, or "all" for all, or None for self.</span>
<span class="sd">        name: str | None</span>
<span class="sd">            Name of the field. If None, the function name is used.</span>
<span class="sd">        description: str</span>
<span class="sd">            Description of the field.</span>
<span class="sd">        units: pint.Unit | str | None</span>
<span class="sd">            Units of the field.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        callable</span>

<span class="sd">        """</span>
        <span class="c1"># we only construct field upon first call to it (default)</span>
        <span class="c1"># if to_containers, we register to the respective children containers</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">containernames</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">containers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">containernames</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">containernames</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
            <span class="n">containers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">containernames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">containers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">containernames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># just a single container as a string?</span>
            <span class="n">containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">containernames</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown type."</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            Decorator to register a field recipe.</span>
<span class="sd">            """</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
                <span class="n">drvfields</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_fieldrecipes</span>
                <span class="n">drvfields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DerivedFieldRecipe</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">DerivedFieldRecipe</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a string representation of the object.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        """</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s2">"FieldContainer[containers=</span><span class="si">%s</span><span class="s2">, fields=</span><span class="si">%s</span><span class="s2">]"</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fieldcount</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">txt</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a dask dataframe of the fields in this container.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dd.DataFrame</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dataframe</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a dask dataframe of the fields in this container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fields: list[str] | None</span>
<span class="sd">            List of fields to include. If None, include all.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dd.DataFrame</span>
<span class="sd">        """</span>
        <span class="n">dss</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">idim</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># could still be an index two 2D dataset</span>
                <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">while</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Field '</span><span class="si">%s</span><span class="s2">' not found"</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">idim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">2</span>  <span class="c1"># cannot support more than 2 here...</span>
            <span class="k">if</span> <span class="n">idim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No second dimensional index for </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idim</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">"Second dimensional index </span><span class="si">%i</span><span class="s2"> not defined for </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">idim</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">idim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">idim</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                        <span class="n">dss</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dss</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dss</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
                <span class="c1"># pint quantities not supported yet in dd, so remove for now</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">from_dask_array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ddf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Add an alias for a field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alias: str</span>
<span class="sd">            Alias name</span>
<span class="sd">        name: str</span>
<span class="sd">            Field name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Remove a sub-container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">            Name of the sub-container.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Unknown container '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Add a sub-container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str, FieldContainer</span>
<span class="sd">        deep: bool</span>
<span class="sd">            If True, make a deep copy of the container.</span>
<span class="sd">        kwargs: dict</span>
<span class="sd">            keyword arguments for the FieldContainer constructor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># create a new container with given name</span>
            <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">"name"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tkwargs</span><span class="p">:</span>
                <span class="n">tkwargs</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">(</span>
                <span class="n">fieldrecipes_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span><span class="p">,</span>
                <span class="n">withunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
                <span class="n">ureg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ureg</span><span class="p">(),</span>
                <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="o">**</span><span class="n">tkwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">):</span>
            <span class="c1"># now we do a shallow or deep copy</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown type."</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Perform a deep (?) copy of the FieldContainer.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FieldContainer</span>
<span class="sd">        """</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_fieldrecipes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">withunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">_ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">internals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getitem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">force_derived</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">update_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">evaluate_recipe</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get an item from the container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">        force_derived: bool</span>
<span class="sd">            Use the derived field description over instantiated fields.</span>
<span class="sd">        update_dict: bool</span>
<span class="sd">            Update the dictionary of instantiated fields.</span>
<span class="sd">        evaluate_recipe: bool</span>
<span class="sd">            Evaluate the recipe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        da.Array</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_derived</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">evaluate_recipe</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instantiate_field</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">update_dict</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
                <span class="k">return</span> <span class="n">field</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Unknown field '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_instantiate_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Instantiate a field from a recipe, i.e. create its dask array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">            Name of the field.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        da.Array</span>
<span class="sd">        """</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">func</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="n">accept_kwargs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">varkw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">func_kwargs</span> <span class="o">=</span> <span class="n">get_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">dkwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span>
        <span class="n">ureg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">"ureg"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dkwargs</span> <span class="ow">or</span> <span class="n">dkwargs</span><span class="p">[</span><span class="s2">"ureg"</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ureg</span><span class="p">()</span>
            <span class="n">dkwargs</span><span class="p">[</span><span class="s2">"ureg"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ureg</span>
        <span class="c1"># first, we overwrite all optional arguments with class instance defaults where func kwarg is None</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">dkwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span><span class="n">dkwargs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">func_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="c1"># next, we add all optional arguments if func is accepting **kwargs and varname not yet in signature</span>
        <span class="k">if</span> <span class="n">accept_kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="o">**</span><span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dkwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">args</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="c1"># finally, instantiate field</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span> <span class="ow">and</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s2">"units"</span><span class="p">):</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">field</span> <span class="o">*</span> <span class="n">units</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">has_reg1</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="s2">"_REGISTRY"</span><span class="p">)</span>
                <span class="n">has_reg2</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s2">"_REGISTRY"</span><span class="p">)</span>
                <span class="n">has_regs</span> <span class="o">=</span> <span class="n">has_reg1</span> <span class="ow">and</span> <span class="n">has_reg2</span>
                <span class="k">if</span> <span class="n">has_regs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">_REGISTRY</span> <span class="o">==</span> <span class="n">units</span><span class="o">.</span><span class="n">_REGISTRY</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">units</span> <span class="o">!=</span> <span class="n">units</span><span class="p">:</span>
                            <span class="c1"># if unit is present, but unit from metadata is unknown,</span>
                            <span class="c1"># we stick with the former</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                                <span class="nb">hasattr</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s2">"units"</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">units</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"unknown"</span>
                            <span class="p">):</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
                                <span class="k">except</span> <span class="n">pint</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DimensionalityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                        <span class="s2">"Field '</span><span class="si">%s</span><span class="s2">' units '</span><span class="si">%s</span><span class="s2">' do not match '</span><span class="si">%s</span><span class="s2">'"</span>
                                        <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
                                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># this should not happen. TODO: figure out when this happens</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">"Unit registries of field '</span><span class="si">%s</span><span class="s2">' do not match. container registry."</span>
                            <span class="o">%</span> <span class="n">key</span>
                        <span class="p">)</span>
        <span class="k">return</span> <span class="n">field</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Unknown key '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_derived</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get a field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key: str</span>
<span class="sd">        value: da.Array</span>
<span class="sd">        allow_derived: bool</span>
<span class="sd">            Allow derived fields.</span>
<span class="sd">        force_derived: bool</span>
<span class="sd">            Use the derived field description over instantiated fields.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        da.Array</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_derived</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Field '</span><span class="si">%s</span><span class="s2">' is derived (allow_derived=False)"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">force_derived</span><span class="o">=</span><span class="n">force_derived</span><span class="p">,</span> <span class="n">update_dict</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="scida.fields.FieldContainer.dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dataframe</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Return a dask dataframe of the fields in this container.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dask.dataframe.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="scida.fields.FieldContainer.fieldcount" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fieldcount</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Return the number of fields.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="scida.fields.FieldContainer.fieldlength" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fieldlength</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Try to infer the number of entries for the fields in this container.
If all fields have the same length, return this length. Otherwise, return None.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fieldrecipes_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">containers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">withunits</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Construct a FieldContainer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fieldrecipes_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default kwargs used for field recipes</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>containers</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of containers to add. FieldContainers in the list will be deep copied.
If a list element is a string, a new FieldContainer with the given name will be created.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aliases</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withunits</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ureg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parent container</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">fieldrecipes_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">containers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">aliases</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">withunits</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">FieldContainer</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Construct a FieldContainer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">    fieldrecipes_kwargs: dict</span>
<span class="sd">        default kwargs used for field recipes</span>
<span class="sd">    containers: list[FieldContainer, str]</span>
<span class="sd">        list of containers to add. FieldContainers in the list will be deep copied.</span>
<span class="sd">        If a list element is a string, a new FieldContainer with the given name will be created.</span>
<span class="sd">    aliases</span>
<span class="sd">    withunits</span>
<span class="sd">    ureg</span>
<span class="sd">    parent: FieldContainer | None</span>
<span class="sd">        parent container</span>
<span class="sd">    kwargs</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">aliases</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">fieldrecipes_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fieldrecipes_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FieldRecipe</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fieldlength</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span> <span class="o">=</span> <span class="n">fieldrecipes_kwargs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span> <span class="o">=</span> <span class="n">withunits</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span><span class="p">:</span> <span class="n">pint</span><span class="o">.</span><span class="n">UnitRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">ureg</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">dict</span><span class="p">()</span>
    <span class="p">)</span>  <span class="c1"># other containers as subgroups</span>
    <span class="k">if</span> <span class="n">containers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">internals</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"uid"</span><span class="p">]</span>  <span class="c1"># names of internal fields/groups</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a string representation of the object.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a string representation of the object.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">txt</span> <span class="o">+=</span> <span class="s2">"FieldContainer[containers=</span><span class="si">%s</span><span class="s2">, fields=</span><span class="si">%s</span><span class="s2">]"</span> <span class="o">%</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fieldcount</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">txt</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.add_alias" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_alias</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Add an alias for a field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>alias</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Alias name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Add an alias for a field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alias: str</span>
<span class="sd">        Alias name</span>
<span class="sd">    name: str</span>
<span class="sd">        Field name</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.add_container" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_container</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Add a sub-container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>deep</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, make a deep copy of the container.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments for the FieldContainer constructor.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Add a sub-container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key: str, FieldContainer</span>
<span class="sd">    deep: bool</span>
<span class="sd">        If True, make a deep copy of the container.</span>
<span class="sd">    kwargs: dict</span>
<span class="sd">        keyword arguments for the FieldContainer constructor.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># create a new container with given name</span>
        <span class="n">tkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">"name"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tkwargs</span><span class="p">:</span>
            <span class="n">tkwargs</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">(</span>
            <span class="n">fieldrecipes_kwargs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span><span class="p">,</span>
            <span class="n">withunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
            <span class="n">ureg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ureg</span><span class="p">(),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="o">**</span><span class="n">tkwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">):</span>
        <span class="c1"># now we do a shallow or deep copy</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown type."</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.copy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Perform a deep (?) copy of the FieldContainer.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Perform a deep (?) copy of the FieldContainer.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldContainer</span>
<span class="sd">    """</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_fieldrecipes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldrecipes_kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">withunits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">internals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">internals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.copy_skeleton" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_skeleton</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Copy the skeleton of the container (i.e., only the containers, not the fields).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy_skeleton</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Copy the skeleton of the container (i.e., only the containers, not the fields).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldContainer</span>
<span class="sd">    """</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">cntr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">cntr</span><span class="o">.</span><span class="n">copy_skeleton</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_derived</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get a field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_derived</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Allow derived fields.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_derived</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use the derived field description over instantiated fields.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dask.array.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_derived</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_derived</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get a field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key: str</span>
<span class="sd">    value: da.Array</span>
<span class="sd">    allow_derived: bool</span>
<span class="sd">        Allow derived fields.</span>
<span class="sd">    force_derived: bool</span>
<span class="sd">        Use the derived field description over instantiated fields.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    da.Array</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_derived</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Field '</span><span class="si">%s</span><span class="s2">' is derived (allow_derived=False)"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span> <span class="n">force_derived</span><span class="o">=</span><span class="n">force_derived</span><span class="p">,</span> <span class="n">update_dict</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.get_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataframe</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a dask dataframe of the fields in this container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of fields to include. If None, include all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dask.dataframe.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a dask dataframe of the fields in this container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fields: list[str] | None</span>
<span class="sd">        List of fields to include. If None, include all.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dd.DataFrame</span>
<span class="sd">    """</span>
    <span class="n">dss</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">idim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># could still be an index two 2D dataset</span>
            <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">while</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Field '</span><span class="si">%s</span><span class="s2">' not found"</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">idim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">2</span>  <span class="c1"># cannot support more than 2 here...</span>
        <span class="k">if</span> <span class="n">idim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No second dimensional index for </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">idim</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Second dimensional index </span><span class="si">%i</span><span class="s2"> not defined for </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">idim</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">idim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">idim</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">dss</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dss</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dss</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
            <span class="c1"># pint quantities not supported yet in dd, so remove for now</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">from_dask_array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
    <span class="n">ddf</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ddf</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.get_ureg" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ureg</span><span class="p">(</span><span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get the unit registry.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ureg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the unit registry.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">discover</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_ureg</span><span class="p">(</span><span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">info</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a string representation of the object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>level</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Level in case of nested containers.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the container.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a string representation of the object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    level: int</span>
<span class="sd">        Level in case of nested containers.</span>
<span class="sd">    name:</span>
<span class="sd">        Name of the container.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">rep</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldlength</span>
    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldcount</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">ncontainers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">)</span>
    <span class="n">statstrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">statstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"fields: </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>
        <span class="n">statstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"entries: </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">length</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ncontainers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">statstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"containers: </span><span class="si">%i</span><span class="s2">"</span> <span class="o">%</span> <span class="n">ncontainers</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statstrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">statstr</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">statstrs</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s2">"+"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">"(</span><span class="si">%s</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">statstr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">v</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rep</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.items" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">items</span><span class="p">(</span><span class="n">withrecipes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withfields</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a list of tuples for keys/values in the container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>withrecipes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include recipes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withfields</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include fields.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>evaluate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to evaluate recipes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withfields</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a list of tuples for keys/values in the container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    withrecipes: bool</span>
<span class="sd">        Whether to include recipes.</span>
<span class="sd">    withfields: bool</span>
<span class="sd">        Whether to include fields.</span>
<span class="sd">    evaluate: bool</span>
<span class="sd">        Whether to evaluate recipes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">evaluate_recipe</span><span class="o">=</span><span class="n">evaluate</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">withrecipes</span><span class="o">=</span><span class="n">withrecipes</span><span class="p">,</span> <span class="n">withfields</span><span class="o">=</span><span class="n">withfields</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.keys" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">keys</span><span class="p">(</span><span class="n">withgroups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withinternal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withfields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a list of keys in the container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>withgroups</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include sub-containers.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withrecipes</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include recipes (i.e. not yet instantiated fields).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withinternal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include internal fields.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withfields</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include fields.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">withgroups</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">withrecipes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">withinternal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">withfields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a list of keys in the container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    withgroups: bool</span>
<span class="sd">        Include sub-containers.</span>
<span class="sd">    withrecipes: bool</span>
<span class="sd">        Include recipes (i.e. not yet instantiated fields).</span>
<span class="sd">    withinternal: bool</span>
<span class="sd">        Include internal fields.</span>
<span class="sd">    withfields: bool</span>
<span class="sd">        Include fields.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="n">fieldkeys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">recipekeys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">withfields</span><span class="p">:</span>
        <span class="n">fieldkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">withinternal</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ikey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internals</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ikey</span> <span class="ow">in</span> <span class="n">fieldkeys</span><span class="p">:</span>
                    <span class="n">fieldkeys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ikey</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">withrecipes</span><span class="p">:</span>
        <span class="n">recipekeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">fieldkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fieldkeys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">recipekeys</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">withgroups</span><span class="p">:</span>
        <span class="n">groupkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">fieldkeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fieldkeys</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">groupkeys</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fieldkeys</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.merge" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Merge another FieldContainer into this one.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Container to merge.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Overwrite existing fields if true.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="n">FieldContainer</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Merge another FieldContainer into this one.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    collection: FieldContainer</span>
<span class="sd">        Container to merge.</span>
<span class="sd">    overwrite: bool</span>
<span class="sd">        Overwrite existing fields if true.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"Can only merge FieldContainers."</span><span class="p">)</span>
    <span class="c1"># TODO: support nested containers</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">collection</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">c1</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">c2</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
        <span class="n">c1</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">c2</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">)</span>
    <span class="c1"># now do the fields in the root container</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">collection</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">collection</span><span class="o">.</span><span class="n">_fieldrecipes</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.register_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_field</span><span class="p">(</span><span class="n">containernames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Decorator to register a field recipe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>containernames</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the sub-container(s) to register to, or "all" for all, or None for self.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the field. If None, the function name is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the field.</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>units</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Units of the field.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_field</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">containernames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Decorator to register a field recipe.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    containernames: str | list[str] | None</span>
<span class="sd">        Name of the sub-container(s) to register to, or "all" for all, or None for self.</span>
<span class="sd">    name: str | None</span>
<span class="sd">        Name of the field. If None, the function name is used.</span>
<span class="sd">    description: str</span>
<span class="sd">        Description of the field.</span>
<span class="sd">    units: pint.Unit | str | None</span>
<span class="sd">        Units of the field.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    callable</span>

<span class="sd">    """</span>
    <span class="c1"># we only construct field upon first call to it (default)</span>
    <span class="c1"># if to_containers, we register to the respective children containers</span>
    <span class="n">containers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">containernames</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">containernames</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">containernames</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">containernames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">containernames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># just a single container as a string?</span>
        <span class="n">containers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">containernames</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown type."</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Decorator to register a field recipe.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
            <span class="n">drvfields</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_fieldrecipes</span>
            <span class="n">drvfields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">DerivedFieldRecipe</span><span class="p">(</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.remove_container" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_container</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Remove a sub-container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the sub-container.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Remove a sub-container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key: str</span>
<span class="sd">        Name of the sub-container.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Unknown container '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.set_ureg" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_ureg</span><span class="p">(</span><span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the unit registry.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ureg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unit registry.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>discover</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Attempt to discover unit registry from fields.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_ureg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ureg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">discover</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Set the unit registry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ureg: pint.UnitRegistry</span>
<span class="sd">        Unit registry.</span>
<span class="sd">    discover: bool</span>
<span class="sd">        Attempt to discover unit registry from fields.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">ureg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">discover</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Need to specify ureg or set discover=True."</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ureg</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">discover</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">withgroups</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">withinternal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s2">"units"</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">pint</span><span class="o">.</span><span class="n">Unit</span><span class="p">):</span>
                    <span class="n">ureg</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">_REGISTRY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ureg</span> <span class="o">=</span> <span class="n">ureg</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldContainer.values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">values</span><span class="p">(</span><span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return fields/recipes the container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>evaluate</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to evaluate recipes.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evaluate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return fields/recipes the container.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    evaluate: bool</span>
<span class="sd">        Whether to evaluate recipes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getitem</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">evaluate_recipe</span><span class="o">=</span><span class="n">evaluate</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.fields.FieldRecipe" class="doc doc-heading">
            <code>FieldRecipe</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>



        <p>Recipe for a field.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/fields.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FieldRecipe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recipe for a field.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="n">IO</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Recipes for a field. Either specify a function or an array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name: str</span>
<span class="sd">            Name of the field.</span>
<span class="sd">        func: callable | None</span>
<span class="sd">            Function to construct array of the field.</span>
<span class="sd">        arr: da.Array | None</span>
<span class="sd">            Array to construct the field.</span>
<span class="sd">        description: str</span>
<span class="sd">            Description of the field.</span>
<span class="sd">        units: pint.Unit | str | None</span>
<span class="sd">            Units of the field.</span>
<span class="sd">        ftype: FieldType</span>
<span class="sd">            Type of the field.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Need to specify either func or arr."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.fields.FieldRecipe.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="n">IO</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Recipes for a field. Either specify a function or an array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the field.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to construct array of the field.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array to construct the field.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the field.</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>units</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Units of the field.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ftype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the field.</p>
              </div>
            </td>
            <td>
                  <code><span title="scida.fields.FieldType.IO">IO</span></code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">FieldType</span><span class="o">.</span><span class="n">IO</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recipes for a field. Either specify a function or an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">        Name of the field.</span>
<span class="sd">    func: callable | None</span>
<span class="sd">        Function to construct array of the field.</span>
<span class="sd">    arr: da.Array | None</span>
<span class="sd">        Array to construct the field.</span>
<span class="sd">    description: str</span>
<span class="sd">        Description of the field.</span>
<span class="sd">    units: pint.Unit | str | None</span>
<span class="sd">        Units of the field.</span>
<span class="sd">    ftype: FieldType</span>
<span class="sd">        Type of the field.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Need to specify either func or arr."</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ftype</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.fields.FieldType" class="doc doc-heading">
            <code>FieldType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>



        <p>Enum for field types.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/fields.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FieldType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Enum for field types.</span>
<span class="sd">    """</span>

    <span class="n">INTERNAL</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># for internal use only</span>
    <span class="n">IO</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># from disk</span>
    <span class="n">DERIVED</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># derived from other fields</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="scida.fields.walk_container" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">walk_container</span><span class="p">(</span><span class="n">cntr</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">handler_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handler_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Recursively walk a container and call handlers on fields and groups.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cntr</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Container to walk.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative path in hierarchy to this container</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>handler_field</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to call on fields.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>handler_group</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to call on subcontainers.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>withrecipes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Include recipes.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/fields.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">walk_container</span><span class="p">(</span>
    <span class="n">cntr</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">handler_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handler_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recursively walk a container and call handlers on fields and groups.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cntr: FieldContainer</span>
<span class="sd">        Container to walk.</span>
<span class="sd">    path: str</span>
<span class="sd">        relative path in hierarchy to this container</span>
<span class="sd">    handler_field: callable</span>
<span class="sd">        Function to call on fields.</span>
<span class="sd">    handler_group: callable</span>
<span class="sd">        Function to call on subcontainers.</span>
<span class="sd">    withrecipes: bool</span>
<span class="sd">        Include recipes.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">keykwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">withgroups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">withrecipes</span><span class="o">=</span><span class="n">withrecipes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ck</span> <span class="ow">in</span> <span class="n">cntr</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="o">**</span><span class="n">keykwargs</span><span class="p">):</span>
        <span class="c1"># we do not want to instantiate entry from recipe by calling cntr[ck] here</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">cntr</span><span class="p">[</span><span class="n">ck</span><span class="p">]</span>
        <span class="n">newpath</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="n">ck</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">FieldContainer</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">handler_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">handler_group</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">newpath</span><span class="p">)</span>
            <span class="n">walk_container</span><span class="p">(</span>
                <span class="n">entry</span><span class="p">,</span>
                <span class="n">newpath</span><span class="p">,</span>
                <span class="n">handler_field</span><span class="p">,</span>
                <span class="n">handler_group</span><span class="p">,</span>
                <span class="n">withrecipes</span><span class="o">=</span><span class="n">withrecipes</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handler_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">handler_field</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">newpath</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">cntr</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.helpers_hdf5" class="doc doc-heading">
            <code>helpers_hdf5</code>


</h2>

    <div class="doc doc-contents ">

        <p>Helper functions for hdf5 and zarr file processing.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="scida.helpers_hdf5.create_mergedhdf5file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_mergedhdf5file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">virtual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">groupwise_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nonvirtual_datasets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a virtual hdf5 file from list of given files. Virtual by default.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file to write to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>files</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>files to merge</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_workers</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>parallel workers to process files</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>virtual</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to create linked ("virtual") dataset on disk (otherwise copy)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nonvirtual_datasets</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of datasets to copy (not virtual) for more fine-grained control</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>groupwise_shape</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to require shapes to be the same within a group</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_hdf5.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_mergedhdf5file</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">,</span>
    <span class="n">files</span><span class="p">,</span>
    <span class="n">max_workers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">virtual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">groupwise_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">nonvirtual_datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Creates a virtual hdf5 file from list of given files. Virtual by default.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn: str</span>
<span class="sd">        file to write to</span>
<span class="sd">    files: list</span>
<span class="sd">        files to merge</span>
<span class="sd">    max_workers: int</span>
<span class="sd">        parallel workers to process files</span>
<span class="sd">    virtual: bool</span>
<span class="sd">        whether to create linked ("virtual") dataset on disk (otherwise copy)</span>
<span class="sd">    nonvirtual_datasets: list</span>
<span class="sd">        list of datasets to copy (not virtual) for more fine-grained control</span>
<span class="sd">    groupwise_shape: bool</span>
<span class="sd">        whether to require shapes to be the same within a group</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">nonvirtual_datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nonvirtual_datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">max_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># read from config</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="n">max_workers</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"nthreads"</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="c1"># first obtain all datasets and groups</span>
    <span class="n">trees</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))]</span>

    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">walk_hdf5file</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">trees</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="n">groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">]])</span>
    <span class="c1"># filter out internal scida metadata groups/datasets from source files</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"_chunks"</span><span class="p">)}</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">"datasets"</span><span class="p">]])</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"_chunks"</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">todct</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""helper func"""</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">[</span><span class="s2">"datasets"</span><span class="p">]}</span>

    <span class="n">dcts</span> <span class="o">=</span> <span class="p">[</span><span class="n">todct</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">d</span><span class="p">,</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""helper func"""</span>
        <span class="k">return</span> <span class="n">shapes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="p">[</span><span class="n">shps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dcts</span><span class="p">)]</span>
    <span class="n">dtypes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dtps</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""helper func"""</span>
        <span class="k">return</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="p">[</span><span class="n">dtps</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dcts</span><span class="p">)]</span>

    <span class="c1"># get shapes of the respective chunks</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">shapes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">chunks</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">k</span><span class="p">,</span> <span class="n">shapes</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">[</span><span class="n">field</span><span class="p">]]</span>
    <span class="n">groupchunks</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># assert that all datasets in a given group have the same chunks.</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="s2">"/"</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="s2">""</span>  <span class="c1"># this is needed to have consistent levels for 0th level</span>
        <span class="n">groupfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">shapes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">group</span><span class="p">)]</span>
        <span class="n">groupfields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">groupfields</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)]</span>
        <span class="n">groupfields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groupfields</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupfields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">arr0</span> <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="n">groupfields</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">groupfields</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">groupwise_shape</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">arr0</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Requiring same shape (see 'groupwise_shape' flag)"</span><span class="p">)</span>
            <span class="c1"># then save the chunking information for this group</span>
            <span class="n">groupchunks</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr0</span>

    <span class="c1"># just in case somebody forgot trailing slashes</span>
    <span class="n">nonvirtual_datasets_stripped</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">nonvirtual_datasets</span><span class="p">]</span>

    <span class="c1"># next fill merger file</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="n">libver</span><span class="o">=</span><span class="s2">"latest"</span><span class="p">)</span> <span class="k">as</span> <span class="n">hf</span><span class="p">:</span>
        <span class="c1"># create groups</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">group</span> <span class="o">==</span> <span class="s2">"/"</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="s2">""</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="n">groupfields</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">field</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">shapes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groupfields</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># create virtual datasets as requested</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">groupfields</span><span class="p">:</span>
                <span class="n">nonvirtual_field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nonvirtual_datasets_stripped</span>
                <span class="k">if</span> <span class="n">virtual</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nonvirtual_field</span><span class="p">:</span>
                    <span class="n">virtual_concat</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">hf</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">shapes</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>

            <span class="c1"># remaining datasets are created non-virtual</span>
            <span class="n">groupfields_nonvirtual</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">groupfields</span><span class="p">)</span>
            <span class="c1"># remove fields already present in hf from fields we copy in the following</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">groupfields</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">grp</span> <span class="o">=</span> <span class="n">hf</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grp</span> <span class="o">=</span> <span class="n">hf</span>
                <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">grp</span><span class="p">:</span>
                    <span class="n">groupfields_nonvirtual</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">groupfields_nonvirtual</span><span class="p">:</span>
                <span class="n">totentries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">[</span><span class="n">field</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">extrashapes</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="n">field</span><span class="p">]))][</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">newshape</span> <span class="o">=</span> <span class="p">(</span><span class="n">totentries</span><span class="p">,)</span> <span class="o">+</span> <span class="n">extrashapes</span>
                <span class="n">hf</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">newshape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>
            <span class="n">counters</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">groupfields</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">fl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span> <span class="k">as</span> <span class="n">hf_load</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">groupfields_nonvirtual</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="n">counters</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
                        <span class="n">hf</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">hf_load</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
                        <span class="n">counters</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span>

        <span class="c1"># save information regarding chunks</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">"_chunks"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">groupchunks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c1"># write the attributes</span>
        <span class="c1"># find attributes that change across data sets</span>
        <span class="n">attrs_key_lists</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">"attrs"</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span>
        <span class="p">]</span>  <span class="c1"># attribute paths for each file</span>
        <span class="n">attrspaths_all</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">attrs_key_lists</span><span class="p">)</span>
        <span class="n">attrspaths_intersec</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrspaths_all</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="n">attrs_key_lists</span><span class="p">)</span>
        <span class="n">attrspath_diff</span> <span class="o">=</span> <span class="n">attrspaths_all</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">attrspaths_intersec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrspaths_all</span> <span class="o">!=</span> <span class="n">attrspaths_intersec</span><span class="p">:</span>
            <span class="c1"># if difference only stems from missing datasets (and their assoc. attrs); thats fine</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">attrspath_diff</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">datasets</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">"Some attribute paths not present in each partial data file."</span>
                <span class="p">)</span>
        <span class="c1"># check for common key+values across all files</span>
        <span class="n">attrs_same</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">attrs_differ</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">nfiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">apath</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">attrspaths_all</span><span class="p">):</span>
            <span class="n">attrs_same</span><span class="p">[</span><span class="n">apath</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">attrs_differ</span><span class="p">[</span><span class="n">apath</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">attrsnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"attrs"</span><span class="p">][</span><span class="n">apath</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfiles</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">apath</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"attrs"</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attrsnames</span><span class="p">:</span>
                <span class="c1"># we ignore apaths and k existing in some files.</span>
                <span class="n">attrvallist</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"attrs"</span><span class="p">][</span><span class="n">apath</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfiles</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">apath</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"attrs"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">"attrs"</span><span class="p">][</span><span class="n">apath</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="n">attrval0</span> <span class="o">=</span> <span class="n">attrvallist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrval0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">attrval0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrvallist</span><span class="p">])):</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> has different values."</span> <span class="o">%</span> <span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                        <span class="n">attrs_differ</span><span class="p">[</span><span class="n">apath</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">attrvallist</span><span class="p">)</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">same</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">attrvallist</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrval0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
                        <span class="c1"># for floats we do not require binary equality</span>
                        <span class="c1"># (we had some incident...)</span>
                        <span class="n">same</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">attrval0</span><span class="p">,</span> <span class="n">attrvallist</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">same</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> has different values."</span> <span class="o">%</span> <span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
                        <span class="n">attrs_differ</span><span class="p">[</span><span class="n">apath</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">attrvallist</span><span class="p">)</span>
                        <span class="k">continue</span>
                <span class="n">attrs_same</span><span class="p">[</span><span class="n">apath</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrval0</span>
        <span class="k">for</span> <span class="n">apath</span> <span class="ow">in</span> <span class="n">attrspaths_all</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs_same</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hf</span><span class="p">[</span><span class="n">apath</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs_differ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hf</span><span class="p">[</span><span class="n">apath</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_hdf5.get_dtype" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dtype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the data type of given h5py.Dataset or zarr.Array object</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object to get dtype from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dtype</code></td>            <td>
                  <code><span title="numpy.dtype">dtype</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dtype of the object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_hdf5.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dtype</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the data type of given h5py.Dataset or zarr.Array object</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj: h5py.Dataset or zarr.Array</span>
<span class="sd">        object to get dtype from</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dtype: numpy.dtype</span>
<span class="sd">        dtype of the object</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"data type '&lt;u6' not understood"</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="fm">__str__</span><span class="p">():</span>
                <span class="c1"># MTNG defines 6 byte unsigned integers, which are not supported by h5py</span>
                <span class="c1"># could not figure out how to query type in h5py other than the reporting error.</span>
                <span class="c1"># (any call to .dtype will try to resolve "&lt;u6" to a numpy dtype, which fails)</span>
                <span class="c1"># we just handle this as 64 bit unsigned integer</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
        <span class="k">return</span> <span class="n">dtype</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_hdf5.walk_group" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">walk_group</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scalar_to_attr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Walks through a h5py.Group or zarr.Group object and fills the tree dictionary with
information about the datasets and groups.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object to walk through</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tree</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary to fill recursively</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_attrs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to get attributes of each object</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scalar_to_attr</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to convert scalar datasets to attributes</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_hdf5.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">walk_group</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scalar_to_attr</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Walks through a h5py.Group or zarr.Group object and fills the tree dictionary with</span>
<span class="sd">    information about the datasets and groups.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj: h5py.Group or zarr.Group</span>
<span class="sd">        object to walk through</span>
<span class="sd">    tree: dict</span>
<span class="sd">        dictionary to fill recursively</span>
<span class="sd">    get_attrs: bool</span>
<span class="sd">        whether to get attributes of each object</span>
<span class="sd">    scalar_to_attr: bool</span>
<span class="sd">        whether to convert scalar datasets to attributes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{},</span> <span class="n">groups</span><span class="o">=</span><span class="p">[],</span> <span class="n">datasets</span><span class="o">=</span><span class="p">[]))</span>
    <span class="k">if</span> <span class="n">get_attrs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tree</span><span class="p">[</span><span class="s2">"attrs"</span><span class="p">][</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">h5py</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Array</span><span class="p">)):</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">get_dtype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">tree</span><span class="p">[</span><span class="s2">"datasets"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">scalar_to_attr</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tree</span><span class="p">[</span><span class="s2">"attrs"</span><span class="p">][</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[()]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">h5py</span><span class="o">.</span><span class="n">Group</span><span class="p">,</span> <span class="n">zarr</span><span class="o">.</span><span class="n">Group</span><span class="p">)):</span>
        <span class="n">tree</span><span class="p">[</span><span class="s2">"groups"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># continue the walk</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">walk_group</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="n">get_attrs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_hdf5.walk_hdf5file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">walk_hdf5file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Walks through a hdf5 file and fills the tree dictionary with
information about the datasets and groups.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file path to hdf5 file to walk through</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tree</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary to fill recursively</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_attrs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to get attributes of each object</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tree</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filled dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_hdf5.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">walk_hdf5file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Walks through a hdf5 file and fills the tree dictionary with</span>
<span class="sd">    information about the datasets and groups.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn: str</span>
<span class="sd">        file path to hdf5 file to walk through</span>
<span class="sd">    tree: dict</span>
<span class="sd">        dictionary to fill recursively</span>
<span class="sd">    get_attrs: bool</span>
<span class="sd">        whether to get attributes of each object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tree: dict</span>
<span class="sd">        filled dictionary</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">hf</span><span class="p">:</span>
        <span class="n">walk_group</span><span class="p">(</span><span class="n">hf</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="n">get_attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_hdf5.walk_zarrfile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">walk_zarrfile</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Walks through a zarr file and fills the tree dictionary with
information about the datasets and groups.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file path to zarr file to walk through</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tree</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary to fill recursively</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_attrs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to get attributes of each object</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tree</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filled dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_hdf5.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">walk_zarrfile</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Walks through a zarr file and fills the tree dictionary with</span>
<span class="sd">    information about the datasets and groups.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn: str</span>
<span class="sd">        file path to zarr file to walk through</span>
<span class="sd">    tree: dict</span>
<span class="sd">        dictionary to fill recursively</span>
<span class="sd">    get_attrs: bool</span>
<span class="sd">        whether to get attributes of each object</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tree: dict</span>
<span class="sd">        filled dictionary</span>
<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">zarr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
        <span class="n">walk_group</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">get_attrs</span><span class="o">=</span><span class="n">get_attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tree</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.helpers_misc" class="doc doc-heading">
            <code>helpers_misc</code>


</h2>

    <div class="doc doc-contents ">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="scida.helpers_misc.RecursiveNamespace" class="doc doc-heading">
            <code>RecursiveNamespace</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="types.SimpleNamespace">SimpleNamespace</span></code></p>



        <p>A SimpleNamespace that can be created recursively from a dict</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RecursiveNamespace</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A SimpleNamespace that can be created recursively from a dict"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Create a SimpleNamespace recursively</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__elt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__elt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Recurse into elt to create leaf namespace objects.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">**</span><span class="n">elt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__elt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">elt</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">elt</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.helpers_misc.RecursiveNamespace.__elt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__elt</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Recurse into elt to create leaf namespace objects.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__elt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recurse into elt to create leaf namespace objects.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="o">**</span><span class="n">elt</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__elt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">elt</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">elt</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.helpers_misc.RecursiveNamespace.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a SimpleNamespace recursively</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Create a SimpleNamespace recursively</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__elt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.computedecorator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">computedecorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorator introducing compute keyword to evalute dask array returns.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to decorate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decorated function</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">computedecorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Decorator introducing compute keyword to evalute dask array returns.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func: callable</span>
<span class="sd">        Function to decorate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    callable</span>
<span class="sd">        Decorated function</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compute</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.get_args" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_args</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the positional arguments of a function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Positional arguments of the function</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the positional arguments of a function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func: callable</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        Positional arguments of the function</span>
<span class="sd">    """</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">k</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
    <span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.get_kwargs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the keyword arguments of a function.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to get keyword arguments from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments of the function</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get the keyword arguments of a function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func: callable</span>
<span class="sd">        Function to get keyword arguments from</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Keyword arguments of the function</span>
<span class="sd">    """</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">signature</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
    <span class="p">}</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.hash_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hash_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Hash a path to a fixed length string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hash_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Hash a path to a fixed length string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str or pathlib.Path</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">sha</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
    <span class="n">sha</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">"/ "</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">sha</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">16</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.make_serializable" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_serializable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Make a value JSON serializable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object to make JSON serializable</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="any">any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JSON serializable object</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_serializable</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Make a value JSON serializable.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v: any</span>
<span class="sd">        Object to make JSON serializable</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    any</span>
<span class="sd">        JSON serializable object</span>
<span class="sd">    """</span>

    <span class="c1"># Attributes need to be JSON serializable. No numpy types allowed.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.map_blocks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_blocks</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enforce_ndim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>map_blocks with units</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">map_blocks</span><span class="p">(</span>
    <span class="n">func</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">drop_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">new_axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">enforce_ndim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">meta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">output_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""map_blocks with units"""</span>
    <span class="n">da_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="n">drop_axis</span><span class="o">=</span><span class="n">drop_axis</span><span class="p">,</span>
        <span class="n">new_axis</span><span class="o">=</span><span class="n">new_axis</span><span class="p">,</span>
        <span class="n">enforce_ndim</span><span class="o">=</span><span class="n">enforce_ndim</span><span class="p">,</span>
        <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">da_kwargs</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">output_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"map_blocks output already has units, overwriting."</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">*</span> <span class="n">output_units</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">*</span> <span class="n">output_units</span>

    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.helpers_misc.sprint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sprint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Print to a string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arguments to print</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String to append at the end</p>
              </div>
            </td>
            <td>
                  <code>'\n'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to print</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String to print</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/helpers_misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sprint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Print to a string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args: any</span>
<span class="sd">        Arguments to print</span>
<span class="sd">    end: str</span>
<span class="sd">        String to append at the end</span>
<span class="sd">    kwargs: any</span>
<span class="sd">        Keyword arguments to pass to print</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">       String to print</span>
<span class="sd">    """</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">contents</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.interface" class="doc doc-heading">
            <code>interface</code>


</h2>

    <div class="doc doc-contents ">

        <p>Base dataset class and its handling.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="scida.interface.BaseDataset" class="doc doc-heading">
            <code>BaseDataset</code>


</h3>


    <div class="doc doc-contents ">



        <p>Base class for all datasets.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/interface.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseDataset</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">MixinMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Base class for all datasets.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">chunksize</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">"auto"</span><span class="p">,</span>
        <span class="n">virtualcache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">overwrite_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fileprefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
        <span class="n">hints</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize a dataset object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to the dataset.</span>
<span class="sd">        chunksize: int or str</span>
<span class="sd">            Chunksize for dask arrays.</span>
<span class="sd">        virtualcache: bool</span>
<span class="sd">            Whether to use virtual caching.</span>
<span class="sd">        overwrite_cache: bool</span>
<span class="sd">            Whether to overwrite existing cache.</span>
<span class="sd">        fileprefix: str</span>
<span class="sd">            Prefix for files to scan for.</span>
<span class="sd">        hints: dict</span>
<span class="sd">            Hints for the dataset.</span>
<span class="sd">        kwargs: dict</span>
<span class="sd">            Additional keyword arguments.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="n">hints</span> <span class="k">if</span> <span class="n">hints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># need this 'tempfile' reference to keep garbage collection away for the tempfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfile</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="n">chunksize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtualcache</span> <span class="o">=</span> <span class="n">virtualcache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_cache</span> <span class="o">=</span> <span class="n">overwrite_cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"units"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Let's find the data and metadata for the object at 'path'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">(</span><span class="n">withunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="n">loadkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">overwrite_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_cache</span><span class="p">,</span>
            <span class="n">fileprefix</span><span class="o">=</span><span class="n">fileprefix</span><span class="p">,</span>
            <span class="n">virtualcache</span><span class="o">=</span><span class="n">virtualcache</span><span class="p">,</span>
            <span class="n">nonvirtual_datasets</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"nonvirtual_datasets"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">derivedfields_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">snap</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>
            <span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__dask_tokenize__</span><span class="p">(),</span>
            <span class="n">withunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">"choose_prefix"</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">loadkwargs</span><span class="p">[</span><span class="s2">"choose_prefix"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"choose_prefix"</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">scida</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">loadkwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempfile</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># any identifying metadata?</span>
        <span class="k">if</span> <span class="s2">"dsname"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">:</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="n">check_config_for_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dsname</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Dataset is identified as '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="n">dsname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s2">"dsname"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dsname</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_info_custom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Custom information to be printed by info() method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listfields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Print information about the dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        listfields: bool</span>
<span class="sd">            If True, list all fields in the dataset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="s2">"class: "</span> <span class="o">+</span> <span class="n">sprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_custom</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_custom</span><span class="p">()</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"=== data ==="</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"root"</span><span class="p">)</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"============"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a dictionary of properties to be printed by __repr__ method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        """</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">props</span><span class="p">[</span><span class="s2">"source"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">return</span> <span class="n">props</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a string representation of the object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        """</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">clsname</span> <span class="o">+</span> <span class="s2">"["</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">, "</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"]"</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Pretty print representation for IPython.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p</span>
<span class="sd">        cycle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">rpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rpr</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Register subclasses in the dataset type registry.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"Delay"</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># nothing to register for Delay objects</span>
        <span class="k">if</span> <span class="s2">"Mixin"</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># do not register classes with Mixins</span>
        <span class="n">dataset_type_registry</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate whether the given path is a valid path for this dataset.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Hash for Dataset instance to be derived from the file location.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        """</span>
        <span class="c1"># deterministic hash; note that hash() on a string is no longer deterministic in python3.</span>
        <span class="n">hash_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">hash_value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__dask_tokenize__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Token for dask to be derived -- naively from the file location.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">return_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return the data container.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FieldContainer</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">:</span> <span class="p">(</span>
            <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">]]</span> <span class="o">|</span> <span class="n">FieldContainer</span>
        <span class="p">)</span> <span class="o">=</span> <span class="s2">"all"</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">zarr_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cast_uints</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">extra_attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Save the dataset to a file using the 'zarr' format.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        extra_attrs: dict</span>
<span class="sd">            additional attributes to save in the root group</span>
<span class="sd">        fname: str</span>
<span class="sd">            Filename to save to.</span>
<span class="sd">        fields: str or dict</span>
<span class="sd">            dictionary of dask arrays to save. If equal to 'all', save all fields in current dataset.</span>
<span class="sd">        overwrite</span>
<span class="sd">            overwrite existing file</span>
<span class="sd">        zarr_kwargs</span>
<span class="sd">            optional arguments to pass to zarr</span>
<span class="sd">        cast_uints</span>
<span class="sd">            need to potentially cast uints to ints for some compressions; TODO: clean this up</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="c1"># We use zarr, as this way we have support to directly write into the file by the workers</span>
        <span class="c1"># (rather than passing back the data chunk over the scheduler to the interface)</span>
        <span class="c1"># Also, this way we can leverage new features, such as a large variety of compression methods.</span>
        <span class="c1"># cast_uints: if true, we cast uints to ints; needed for some compressions (particularly zfp)</span>
        <span class="k">if</span> <span class="n">zarr_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zarr_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># check if it is a zarr group/array</span>
                <span class="n">is_zarr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">".zgroup"</span><span class="p">))</span>
                <span class="n">is_zarr</span> <span class="o">|=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">".zarray"</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_zarr</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Directory '</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">' exists and is not a zarr group. "</span>
                        <span class="s2">"Refusing to overwrite for safety."</span>
                    <span class="p">)</span>
        <span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">DirectoryStore</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">zarr_kwargs</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

        <span class="c1"># Metadata</span>
        <span class="n">defaultattributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Config"</span><span class="p">,</span> <span class="s2">"Header"</span><span class="p">,</span> <span class="s2">"Parameters"</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dctname</span> <span class="ow">in</span> <span class="n">defaultattributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dctname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
                <span class="n">grp</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">dctname</span><span class="p">)</span>
                <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">dctname</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">make_serializable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">if</span> <span class="n">extra_attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">extra_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1"># Data</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">units_to_save</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ptypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">ptypes</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid field specifier."</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid type for fields."</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ptypes</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fields</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
                <span class="n">fieldkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">fieldkeys</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fieldkeys</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fieldkeys</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>  <span class="c1"># if we have units, remove those here</span>
                    <span class="n">units_to_save</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">magnitude</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">compute_chunk_sizes</span><span class="p">()</span>  <span class="c1"># very inefficient (have to do it separately for every array)</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span><span class="n">chunks</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cast_uints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">task</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span>
                    <span class="n">arr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">unit_str</span> <span class="ow">in</span> <span class="n">units_to_save</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">root</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">"units"</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_serializable</span><span class="p">(</span><span class="n">unit_str</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.__dask_tokenize__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__dask_tokenize__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Token for dask to be derived -- naively from the file location.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__dask_tokenize__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Token for dask to be derived -- naively from the file location.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.__hash__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__hash__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Hash for Dataset instance to be derived from the file location.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Hash for Dataset instance to be derived from the file location.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">    """</span>
    <span class="c1"># deterministic hash; note that hash() on a string is no longer deterministic in python3.</span>
    <span class="n">hash_value</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">hash_value</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">virtualcache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fileprefix</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">hints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize a dataset object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chunksize for dask arrays.</p>
              </div>
            </td>
            <td>
                  <code>'auto'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>virtualcache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use virtual caching.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite existing cache.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fileprefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix for files to scan for.</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hints</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hints for the dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">chunksize</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">"auto"</span><span class="p">,</span>
    <span class="n">virtualcache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">overwrite_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">fileprefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
    <span class="n">hints</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize a dataset object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to the dataset.</span>
<span class="sd">    chunksize: int or str</span>
<span class="sd">        Chunksize for dask arrays.</span>
<span class="sd">    virtualcache: bool</span>
<span class="sd">        Whether to use virtual caching.</span>
<span class="sd">    overwrite_cache: bool</span>
<span class="sd">        Whether to overwrite existing cache.</span>
<span class="sd">    fileprefix: str</span>
<span class="sd">        Prefix for files to scan for.</span>
<span class="sd">    hints: dict</span>
<span class="sd">        Hints for the dataset.</span>
<span class="sd">    kwargs: dict</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hints</span> <span class="o">=</span> <span class="n">hints</span> <span class="k">if</span> <span class="n">hints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># need this 'tempfile' reference to keep garbage collection away for the tempfile</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tempfile</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">chunksize</span> <span class="o">=</span> <span class="n">chunksize</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">virtualcache</span> <span class="o">=</span> <span class="n">virtualcache</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_cache</span> <span class="o">=</span> <span class="n">overwrite_cache</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">withunits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"units"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Let's find the data and metadata for the object at 'path'</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">(</span><span class="n">withunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="n">loadkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">overwrite_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite_cache</span><span class="p">,</span>
        <span class="n">fileprefix</span><span class="o">=</span><span class="n">fileprefix</span><span class="p">,</span>
        <span class="n">virtualcache</span><span class="o">=</span><span class="n">virtualcache</span><span class="p">,</span>
        <span class="n">nonvirtual_datasets</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"nonvirtual_datasets"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">derivedfields_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">snap</span><span class="o">=</span><span class="bp">self</span><span class="p">),</span>
        <span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__dask_tokenize__</span><span class="p">(),</span>
        <span class="n">withunits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">withunits</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">"choose_prefix"</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">loadkwargs</span><span class="p">[</span><span class="s2">"choose_prefix"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"choose_prefix"</span><span class="p">]</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">scida</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">loadkwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tempfile</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cached</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># any identifying metadata?</span>
    <span class="k">if</span> <span class="s2">"dsname"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">:</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">check_config_for_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_raw</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dsname</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Dataset is identified as '</span><span class="si">%s</span><span class="s2">'."</span> <span class="o">%</span> <span class="n">dsname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hints</span><span class="p">[</span><span class="s2">"dsname"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dsname</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.__init_subclass__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Register subclasses in the dataset type registry.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Register subclasses in the dataset type registry.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"Delay"</span><span class="p">:</span>
        <span class="k">return</span>  <span class="c1"># nothing to register for Delay objects</span>
    <span class="k">if</span> <span class="s2">"Mixin"</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
        <span class="k">return</span>  <span class="c1"># do not register classes with Mixins</span>
    <span class="n">dataset_type_registry</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a string representation of the object.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a string representation of the object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
    <span class="n">clsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">clsname</span> <span class="o">+</span> <span class="s2">"["</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">, "</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"]"</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">info</span><span class="p">(</span><span class="n">listfields</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Print information about the dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>listfields</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, list all fields in the dataset.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listfields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Print information about the dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    listfields: bool</span>
<span class="sd">        If True, list all fields in the dataset.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">rep</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">rep</span> <span class="o">+=</span> <span class="s2">"class: "</span> <span class="o">+</span> <span class="n">sprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_custom</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_custom</span><span class="p">()</span>
    <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"=== data ==="</span><span class="p">)</span>
    <span class="n">rep</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"root"</span><span class="p">)</span>
    <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"============"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.return_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_data</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return the data container.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">return_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return the data container.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldContainer</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s1">'all'</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zarr_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cast_uints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extra_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Save the dataset to a file using the 'zarr' format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>extra_attrs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>additional attributes to save in the root group</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fname</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename to save to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="str">str</span>] | <span title="dict">dict</span>[<span title="str">str</span>, <span title="dask.array.Array">Array</span>]] | <a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary of dask arrays to save. If equal to 'all', save all fields in current dataset.</p>
              </div>
            </td>
            <td>
                  <code>'all'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>overwrite existing file</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zarr_kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>optional arguments to pass to zarr</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cast_uints</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>need to potentially cast uints to ints for some compressions; TODO: clean this up</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">fields</span><span class="p">:</span> <span class="p">(</span>
        <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">da</span><span class="o">.</span><span class="n">Array</span><span class="p">]]</span> <span class="o">|</span> <span class="n">FieldContainer</span>
    <span class="p">)</span> <span class="o">=</span> <span class="s2">"all"</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">zarr_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cast_uints</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">extra_attrs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Save the dataset to a file using the 'zarr' format.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    extra_attrs: dict</span>
<span class="sd">        additional attributes to save in the root group</span>
<span class="sd">    fname: str</span>
<span class="sd">        Filename to save to.</span>
<span class="sd">    fields: str or dict</span>
<span class="sd">        dictionary of dask arrays to save. If equal to 'all', save all fields in current dataset.</span>
<span class="sd">    overwrite</span>
<span class="sd">        overwrite existing file</span>
<span class="sd">    zarr_kwargs</span>
<span class="sd">        optional arguments to pass to zarr</span>
<span class="sd">    cast_uints</span>
<span class="sd">        need to potentially cast uints to ints for some compressions; TODO: clean this up</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="c1"># We use zarr, as this way we have support to directly write into the file by the workers</span>
    <span class="c1"># (rather than passing back the data chunk over the scheduler to the interface)</span>
    <span class="c1"># Also, this way we can leverage new features, such as a large variety of compression methods.</span>
    <span class="c1"># cast_uints: if true, we cast uints to ints; needed for some compressions (particularly zfp)</span>
    <span class="k">if</span> <span class="n">zarr_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zarr_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># check if it is a zarr group/array</span>
            <span class="n">is_zarr</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">".zgroup"</span><span class="p">))</span>
            <span class="n">is_zarr</span> <span class="o">|=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">".zarray"</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_zarr</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Directory '</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s2">' exists and is not a zarr group. "</span>
                    <span class="s2">"Refusing to overwrite for safety."</span>
                <span class="p">)</span>
    <span class="n">store</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">DirectoryStore</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">zarr_kwargs</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

    <span class="c1"># Metadata</span>
    <span class="n">defaultattributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Config"</span><span class="p">,</span> <span class="s2">"Header"</span><span class="p">,</span> <span class="s2">"Parameters"</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">dctname</span> <span class="ow">in</span> <span class="n">defaultattributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dctname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">dctname</span><span class="p">)</span>
            <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">dctname</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">make_serializable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">grp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">if</span> <span class="n">extra_attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">extra_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c1"># Data</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">units_to_save</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ptypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ptypes</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid field specifier."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Invalid type for fields."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ptypes</span><span class="p">:</span>
        <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">:</span>
            <span class="n">fieldkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">fieldkeys</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fieldkeys</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fieldkeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s2">"magnitude"</span><span class="p">):</span>  <span class="c1"># if we have units, remove those here</span>
                <span class="n">units_to_save</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)):</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">compute_chunk_sizes</span><span class="p">()</span>  <span class="c1"># very inefficient (have to do it separately for every array)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">rechunk</span><span class="p">(</span><span class="n">chunks</span><span class="o">=</span><span class="s2">"auto"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cast_uints</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span>
                <span class="n">arr</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">unit_str</span> <span class="ow">in</span> <span class="n">units_to_save</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">root</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">"units"</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_serializable</span><span class="p">(</span><span class="n">unit_str</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.BaseDataset.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate whether the given path is a valid path for this dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate whether the given path is a valid path for this dataset.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.interface.Dataset" class="doc doc-heading">
            <code>Dataset</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseDataset (scida.interface.BaseDataset)" href="#scida.interface.BaseDataset">BaseDataset</a></code></p>



        <p>Base class for datasets with some functions to be overwritten by subclass.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/interface.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Base class for datasets with some functions to be overwritten by subclass.</span>
<span class="sd">    """</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Validate whether the given path is a valid path for this dataset.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            Path to the dataset.</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_metadata_from_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rawmetadata</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Clean metadata from raw metadata"""</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.interface.Dataset.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate whether the given path is a valid path for this dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Validate whether the given path is a valid path for this dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        Path to the dataset.</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.interface.DatasetWithUnitMixin" class="doc doc-heading">
            <code>DatasetWithUnitMixin</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="scida.interfaces.mixins.UnitMixin">UnitMixin</span></code>, <code><a class="autorefs autorefs-internal" title="Dataset (scida.interface.Dataset)" href="#scida.interface.Dataset">Dataset</a></code></p>



        <p>Dataset with units.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/interface.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetWithUnitMixin</span><span class="p">(</span><span class="n">UnitMixin</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Dataset with units.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Initialize dataset with units."""</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.interface.DatasetWithUnitMixin.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize dataset with units.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Initialize dataset with units."""</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.interface.MixinMeta" class="doc doc-heading">
            <code>MixinMeta</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="type">type</span></code></p>



        <p>Metaclass for Mixin classes.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/interface.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MixinMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Metaclass for Mixin classes.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">mixins</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"mixins"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">newcls</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">newcls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.interface.Selector" class="doc doc-heading">
            <code>Selector</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>



        <p>Base Class for data selection decorator factory</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/interface.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Selector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Base Class for data selection decorator factory"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize the selector.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the keys we check for.</span>
        <span class="c1"># holds a copy of the species' fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">()</span>
        <span class="c1"># holds the species' fields we operate on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">FieldContainer</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Call the selector.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn: function</span>
<span class="sd">            Function to be decorated.</span>
<span class="sd">        args: list</span>
<span class="sd">        kwargs: dict</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        function</span>
<span class="sd">            Decorated function.</span>

<span class="sd">        """</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">newfn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># TODO: Add graceful exit/restore after exception in self.prepare</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy_skeleton</span><span class="p">()</span>
            <span class="c1"># deepdictkeycopy(self.data_backup, self.data)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">"Subclass implementation needed for self.keys!"</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"dropkeys"</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newfn</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Prepare the data for selection. To be implemented in subclasses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Subclass implementation needed!"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Finalize the data after selection. To be implemented in subclasses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        """</span>
        <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.interface.Selector.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Call the selector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to be decorated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="function">function</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decorated function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Call the selector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fn: function</span>
<span class="sd">        Function to be decorated.</span>
<span class="sd">    args: list</span>
<span class="sd">    kwargs: dict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    function</span>
<span class="sd">        Decorated function.</span>

<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">newfn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># TODO: Add graceful exit/restore after exception in self.prepare</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy_skeleton</span><span class="p">()</span>
        <span class="c1"># deepdictkeycopy(self.data_backup, self.data)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">"Subclass implementation needed for self.keys!"</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"dropkeys"</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newfn</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.Selector.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize the selector.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize the selector.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the keys we check for.</span>
    <span class="c1"># holds a copy of the species' fields</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">()</span>
    <span class="c1"># holds the species' fields we operate on</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span> <span class="n">FieldContainer</span> <span class="o">=</span> <span class="n">FieldContainer</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.Selector.finalize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Finalize the data after selection. To be implemented in subclasses.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Finalize the data after selection. To be implemented in subclasses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_backup</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.interface.Selector.prepare" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Prepare the data for selection. To be implemented in subclasses.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Prepare the data for selection. To be implemented in subclasses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    """</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Subclass implementation needed!"</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="scida.interface.create_datasetclass_with_mixins" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new class from a given class and a list of mixins.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cls</code>
            </td>
            <td>
                  <code><span title="type">type</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dataset class to be extended</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mixins</code>
            </td>
            <td>
                  <code><span title="list">list</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of mixin classes to be added</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Type">Type</span>[<a class="autorefs autorefs-internal" title="BaseDataset (scida.interface.BaseDataset)" href="#scida.interface.BaseDataset">BaseDataset</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>new class with mixins</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/interface.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_datasetclass_with_mixins</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">mixins</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Create a new class from a given class and a list of mixins.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cls:</span>
<span class="sd">        dataset class to be extended</span>
<span class="sd">    mixins:</span>
<span class="sd">        list of mixin classes to be added</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Type[BaseDataset]</span>
<span class="sd">        new class with mixins</span>
<span class="sd">    """</span>
    <span class="n">newcls</span> <span class="o">=</span> <span class="bp">cls</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mixins</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mixins</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># check for duplicates within the mixins list itself</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Mixin '</span><span class="si">%s</span><span class="s2">' appears multiple times in the mixins list. "</span>
                    <span class="s2">"Please remove duplicates."</span> <span class="o">%</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"__name__"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="c1"># check whether any mixin already in cls hierarchy recursively</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">has_mixin_in_hierarchy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">has_mixin_in_hierarchy</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">has_mixin_in_hierarchy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Mixin '</span><span class="si">%s</span><span class="s2">' is already present in the class hierarchy of '</span><span class="si">%s</span><span class="s2">'. "</span>
                    <span class="s2">"Please remove it from the mixins list to avoid duplication."</span>
                    <span class="o">%</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">"__name__"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)),</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">"With"</span> <span class="o">+</span> <span class="s2">"And"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mixins</span><span class="p">])</span>
        <span class="c1"># adjust entry point if __init__ available in some mixin</span>
        <span class="n">nms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="c1"># need to make sure first mixin init is called over cls init</span>
        <span class="n">nms</span><span class="p">[</span><span class="s2">"__init__"</span><span class="p">]</span> <span class="o">=</span> <span class="n">mixins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span>
        <span class="n">newcls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">mixins</span><span class="p">,</span> <span class="bp">cls</span><span class="p">),</span> <span class="n">nms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newcls</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.io" class="doc doc-heading">
            <code>io</code>


</h2>

    <div class="doc doc-contents ">

        <p>scida.io</p>










<div class="doc doc-children">











<div class="doc doc-object doc-module">



<h3 id="scida.io.fits" class="doc doc-heading">
            <code>fits</code>


</h3>

    <div class="doc doc-contents ">

        <p>FITS file reader for scida</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.io.fits.fitsrecords_to_daskarrays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fitsrecords_to_daskarrays</span><span class="p">(</span><span class="n">fitsrecords</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Convert a FITS record array to a dictionary of dask arrays.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fitsrecords</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FITS record array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary of dask arrays</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/io/fits.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fitsrecords_to_daskarrays</span><span class="p">(</span><span class="n">fitsrecords</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Convert a FITS record array to a dictionary of dask arrays.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fitsrecords: np.ndarray</span>
<span class="sd">        FITS record array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        dictionary of dask arrays</span>

<span class="sd">    """</span>
    <span class="n">load_arr</span> <span class="o">=</span> <span class="n">delayed</span><span class="p">(</span><span class="k">lambda</span> <span class="n">slc</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">fitsrecords</span><span class="p">[</span><span class="n">slc</span><span class="p">][</span><span class="n">field</span><span class="p">])</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">fitsrecords</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">darrdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">csize</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"array.chunk-size"</span><span class="p">)</span>

    <span class="n">csize</span> <span class="o">=</span> <span class="n">parse_size</span><span class="p">(</span><span class="n">csize</span><span class="p">)</span>  <span class="c1"># need int</span>

    <span class="n">nbytes_dtype_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">fieldname</span> <span class="ow">in</span> <span class="n">fitsrecords</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="n">nbytes_dtype</span> <span class="o">=</span> <span class="n">fitsrecords</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">itemsize</span>
        <span class="n">nbytes_dtype_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nbytes_dtype_max</span><span class="p">,</span> <span class="n">nbytes_dtype</span><span class="p">)</span>
    <span class="n">chunksize</span> <span class="o">=</span> <span class="n">csize</span> <span class="o">//</span> <span class="n">nbytes_dtype_max</span>

    <span class="k">for</span> <span class="n">fieldname</span> <span class="ow">in</span> <span class="n">fitsrecords</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">chunksize</span><span class="p">):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">fitsrecords</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">chunksize</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">slc</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">)</span>
            <span class="n">shp</span> <span class="o">=</span> <span class="p">(</span><span class="n">chunk_size</span><span class="p">,)</span>
            <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">subdtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># for now, we expect this to be void type</span>
                <span class="k">assert</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span>
                <span class="k">break</span>  <span class="c1"># do not handle void type for now =&gt; skip field</span>
                <span class="c1"># shp = shp + dtype.subdtype[0].shape</span>
                <span class="c1"># dtype = dtype.subdtype[0].base</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">from_delayed</span><span class="p">(</span><span class="n">load_arr</span><span class="p">(</span><span class="n">slc</span><span class="p">,</span> <span class="n">fieldname</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="n">shp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">darrdict</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">darrdict</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.misc" class="doc doc-heading">
            <code>misc</code>


</h2>

    <div class="doc doc-contents ">

        <p>Miscellaneous helper functions.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="scida.misc.check_config_for_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_config_for_dataset</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check whether the given dataset can be identified to be a certain simulation (type) by its metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>metadata of the dataset used for identification</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the dataset, sometimes helpful for identification</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to expect return to be unique</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Strings of Candidate identifiers</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_config_for_dataset</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Check whether the given dataset can be identified to be a certain simulation (type) by its metadata.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    metadata: dict</span>
<span class="sd">        metadata of the dataset used for identification</span>
<span class="sd">    path: str</span>
<span class="sd">        path to the dataset, sometimes helpful for identification</span>
<span class="sd">    unique: bool</span>
<span class="sd">        whether to expect return to be unique</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[str]</span>
<span class="sd">        Strings of Candidate identifiers</span>

<span class="sd">    """</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">get_simulationconfig</span><span class="p">()</span>

    <span class="n">candidates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s2">"data"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">candidates</span>
    <span class="n">simdct</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">simdct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">simdct</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">simdct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">"identifiers"</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">idtfrs</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s2">"identifiers"</span><span class="p">]</span>
            <span class="c1"># special key not specifying identifying metadata</span>
            <span class="n">specialkeys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name_contains"</span><span class="p">]</span>
            <span class="n">allkeys</span> <span class="o">=</span> <span class="n">idtfrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">allkeys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">specialkeys</span><span class="p">])</span>
            <span class="k">if</span> <span class="s2">"name_contains"</span> <span class="ow">in</span> <span class="n">idtfrs</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="c1"># we only check the last three path elements</span>
                <span class="n">dirnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="n">substring</span> <span class="o">=</span> <span class="n">idtfrs</span><span class="p">[</span><span class="s2">"name_contains"</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="n">substring</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">]):</span>
                    <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">allkeys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">idtfrs</span><span class="p">[</span><span class="n">grp</span><span class="p">]</span>
                <span class="n">h5path</span> <span class="o">=</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="n">grp</span>
                <span class="k">if</span> <span class="n">h5path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                    <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="n">h5path</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ikey</span><span class="p">,</span> <span class="n">ival</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ikey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                        <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
                    <span class="n">av</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span>
                    <span class="n">matchtype</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ival</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">matchtype</span> <span class="o">=</span> <span class="n">ival</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"match"</span><span class="p">,</span> <span class="n">matchtype</span><span class="p">)</span>  <span class="c1"># default means equal</span>
                        <span class="n">ival</span> <span class="o">=</span> <span class="n">ival</span><span class="p">[</span><span class="s2">"content"</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                        <span class="n">av</span> <span class="o">=</span> <span class="n">av</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">matchtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">is_scalar</span><span class="p">(</span><span class="n">av</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">ival</span><span class="p">):</span>
                                <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">break</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">av</span> <span class="o">==</span> <span class="n">ival</span><span class="p">):</span>
                                <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">av</span> <span class="o">!=</span> <span class="n">ival</span><span class="p">:</span>
                                <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">matchtype</span> <span class="o">==</span> <span class="s2">"substring"</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ival</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">av</span><span class="p">:</span>
                            <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">possible_candidate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">possible_candidate</span><span class="p">:</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unique</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Multiple dataset candidates (set unique=False?):"</span><span class="p">,</span> <span class="n">candidates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">candidates</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.deepdictkeycopy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deepdictkeycopy</span><span class="p">(</span><span class="n">olddict</span><span class="p">,</span> <span class="n">newdict</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Recursively walk nested dictionary, only creating empty dictionaries for entries that are dictionaries themselves.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>olddict</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>newdict</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">deepdictkeycopy</span><span class="p">(</span><span class="n">olddict</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">newdict</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Recursively walk nested dictionary, only creating empty dictionaries for entries that are dictionaries themselves.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    olddict</span>
<span class="sd">    newdict</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">olddict</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">olddict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">):</span>
            <span class="n">newdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
            <span class="n">deepdictkeycopy</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">newdict</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.get_container_from_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_container_from_path</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a container from a path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>container</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create_missing</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>FieldContainer</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="FieldContainer (scida.fields.FieldContainer)" href="#scida.fields.FieldContainer">FieldContainer</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>container specified by path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_container_from_path</span><span class="p">(</span>
    <span class="n">element</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span> <span class="n">FieldContainer</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">create_missing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldContainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get a container from a path.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    element: str</span>
<span class="sd">    container: FieldContainer</span>
<span class="sd">    create_missing: bool</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    FieldContainer:</span>
<span class="sd">        container specified by path</span>

<span class="sd">    """</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">container</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rv</span><span class="o">.</span><span class="n">_containers</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">create_missing</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Container '</span><span class="si">%s</span><span class="s2">' not found in '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">rv</span><span class="p">))</span>
            <span class="n">rv</span><span class="o">.</span><span class="n">add_container</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">_containers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">rv</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.map_interface_args" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">map_interface_args</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Map arguments for interface if they are not lists.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>paths</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="generator">generator</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>yields path, args, kwargs</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">map_interface_args</span><span class="p">(</span><span class="n">paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Map arguments for interface if they are not lists.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    paths</span>
<span class="sd">    args</span>
<span class="sd">    kwargs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    generator</span>
<span class="sd">        yields path, args, kwargs</span>

<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
        <span class="n">targs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">targs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">targs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">tkwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">tkwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tkwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">yield</span> <span class="n">path</span><span class="p">,</span> <span class="n">targs</span><span class="p">,</span> <span class="n">tkwargs</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.parse_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a human-readable size string to a number in bytes.</p>
<p>Supports both SI units (KB, MB, GB, TB) and binary units (KiB, MiB, GiB, TiB).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable size string, e.g. "128MiB", "1.5 GiB", "500MB".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size in bytes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_size</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Parse a human-readable size string to a number in bytes.</span>

<span class="sd">    Supports both SI units (KB, MB, GB, TB) and binary units (KiB, MiB, GiB, TiB).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : str</span>
<span class="sd">        Human-readable size string, e.g. "128MiB", "1.5 GiB", "500MB".</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Size in bytes.</span>
<span class="sd">    """</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">size</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">" "</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">_RE_UNIT_SIZE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">" \1"</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">number</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">size</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">*</span> <span class="n">_sizeunits</span><span class="p">[</span><span class="n">unit</span><span class="p">])</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.path_hdf5cachefile_exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">path_hdf5cachefile_exists</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks whether a cache file exists for given path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>passed to return_hdf5cachepath</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">path_hdf5cachefile_exists</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Checks whether a cache file exists for given path.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path:</span>
<span class="sd">        path to the dataset</span>
<span class="sd">    kwargs:</span>
<span class="sd">        passed to return_hdf5cachepath</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>

<span class="sd">    """</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">return_hdf5cachepath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.rectangular_cutout_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rectangular_cutout_mask</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">boxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s1">'dask'</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a rectangular mask for a given set of coordinates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>center</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>center of the rectangle</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>widths of the rectangle</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coords</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>coordinates to mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pbc</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to apply PBC</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boxsize</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boxsize for PBC</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>backend</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>backend to use (dask or numpy)</p>
              </div>
            </td>
            <td>
                  <code>'dask'</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunksize</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chunksize for dask</p>
              </div>
            </td>
            <td>
                  <code>'auto'</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ndarray</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mask</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rectangular_cutout_mask</span><span class="p">(</span>
    <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">boxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">"dask"</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="s2">"auto"</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Create a rectangular mask for a given set of coordinates.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    center: list</span>
<span class="sd">        center of the rectangle</span>
<span class="sd">    width: list</span>
<span class="sd">        widths of the rectangle</span>
<span class="sd">    coords: ndarray</span>
<span class="sd">        coordinates to mask</span>
<span class="sd">    pbc: bool</span>
<span class="sd">        whether to apply PBC</span>
<span class="sd">    boxsize:</span>
<span class="sd">        boxsize for PBC</span>
<span class="sd">    backend: str</span>
<span class="sd">        backend to use (dask or numpy)</span>
<span class="sd">    chunksize: str</span>
<span class="sd">        chunksize for dask</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray:</span>
<span class="sd">        mask</span>

<span class="sd">    """</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">"dask"</span><span class="p">:</span>
        <span class="n">be</span> <span class="o">=</span> <span class="n">da</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">be</span> <span class="o">=</span> <span class="n">np</span>

    <span class="n">dists</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">-</span> <span class="n">center</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="n">be</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dists</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pbc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">boxsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Need to specify for boxsize for PBC."</span><span class="p">)</span>
        <span class="n">dists</span> <span class="o">=</span> <span class="n">be</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dists</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">boxsize</span><span class="p">,</span> <span class="n">be</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">boxsize</span> <span class="o">-</span> <span class="n">dists</span><span class="p">),</span> <span class="n">dists</span><span class="p">)</span>

    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">backend</span> <span class="o">==</span> <span class="s2">"dask"</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunksize</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">be</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">&amp;=</span> <span class="n">dists</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span>
            <span class="n">width</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="p">)</span>  <span class="c1"># TODO: This interval is not closed on the left side.</span>
    <span class="k">return</span> <span class="n">mask</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.return_cachefile_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_cachefile_path</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the path to the cache file, return None if path cannot be generated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fname</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filename of cache file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span> or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">return_cachefile_path</span><span class="p">(</span><span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return the path to the cache file, return None if path cannot be generated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname: str</span>
<span class="sd">        filename of cache file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str or None</span>

<span class="sd">    """</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">"cache_path"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">"cache_path"</span><span class="p">]</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
    <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cp</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="n">bp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bp</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># can happen due to parallel access</span>
    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.return_hdf5cachepath" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">return_hdf5cachepath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fileprefix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the path to the cache file for a given path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the dataset</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fileprefix</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Can be used to specify the fileprefix used for the dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">return_hdf5cachepath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fileprefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Returns the path to the cache file for a given path.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        path to the dataset</span>
<span class="sd">    fileprefix: str | None</span>
<span class="sd">        Can be used to specify the fileprefix used for the dataset.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">fileprefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fileprefix</span><span class="p">)</span>
    <span class="n">hsh</span> <span class="o">=</span> <span class="n">hash_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">return_cachefile_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hsh</span><span class="p">,</span> <span class="s2">"data.hdf5"</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="scida.misc.str_is_float" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">str_is_float</span><span class="p">(</span><span class="n">element</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check whether a string can be converted to a float.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/misc.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">str_is_float</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Check whether a string can be converted to a float.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    element: str</span>
<span class="sd">        string to check</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>

<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.registries" class="doc doc-heading">
            <code>registries</code>


</h2>

    <div class="doc doc-contents ">

        <p>This module contains registries for dataset and dataseries subclasses.
Subclasses are automatically registered through <strong>init_subclass</strong></p>










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.series" class="doc doc-heading">
            <code>series</code>


</h2>

    <div class="doc doc-contents ">

        <p>This module contains the base class for DataSeries, which is a container for collections of dataset instances.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="scida.series.DatasetSeries" class="doc doc-heading">
            <code>DatasetSeries</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>



        <p>A container for collections of dataset instances</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="scida.series.DatasetSeries.datasets">datasets</span></code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of dataset instances</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="scida.series.DatasetSeries.paths">paths</span></code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of paths to data</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="scida.series.DatasetSeries.names">names</span></code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of names for datasets</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="scida.series.DatasetSeries.hash">hash</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hash of the object, constructed from dataset paths.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/series.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatasetSeries</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A container for collections of dataset instances</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    datasets: list</span>
<span class="sd">        list of dataset instances</span>
<span class="sd">    paths: list</span>
<span class="sd">        list of paths to data</span>
<span class="sd">    names: list</span>
<span class="sd">        list of names for datasets</span>
<span class="sd">    hash: str</span>
<span class="sd">        hash of the object, constructed from dataset paths.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
        <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span>
        <span class="n">datasetclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># lazy will only initialize data sets on demand.</span>
        <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        paths: list</span>
<span class="sd">            list of paths to data</span>
<span class="sd">        interface_args:</span>
<span class="sd">            arguments to pass to interface class</span>
<span class="sd">        datasetclass:</span>
<span class="sd">            class to use for dataset instances</span>
<span class="sd">        overwrite_cache:</span>
<span class="sd">            whether to overwrite existing cache</span>
<span class="sd">        lazy:</span>
<span class="sd">            whether to initialize datasets lazily</span>
<span class="sd">        names:</span>
<span class="sd">            names for datasets</span>
<span class="sd">        interface_kwargs:</span>
<span class="sd">            keyword arguments to pass to interface class</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash</span> <span class="o">=</span> <span class="n">hash_path</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span> <span class="o">=</span> <span class="n">return_cachefile_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash</span><span class="p">,</span> <span class="s2">"data.json"</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="n">lazy</span>
        <span class="k">if</span> <span class="n">overwrite_cache</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">delay_init</span>  <span class="c1"># lazy loading</span>

        <span class="c1"># Catch Mixins and create type:</span>
        <span class="n">ikw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">overwrite_cache</span><span class="o">=</span><span class="n">overwrite_cache</span><span class="p">)</span>
        <span class="n">ikw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span>
        <span class="n">mixins</span> <span class="o">=</span> <span class="n">ikw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"mixins"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">datasetclass</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="n">datasetclass</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_cls</span> <span class="o">=</span> <span class="n">datasetclass</span>

        <span class="n">gen</span> <span class="o">=</span> <span class="n">map_interface_args</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="o">**</span><span class="n">ikw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">dec</span><span class="p">(</span><span class="n">datasetclass</span><span class="p">)(</span><span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Have not cached this data series. Can take a while."</span><span class="p">)</span>
            <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">))</span>
            <span class="p">):</span>
                <span class="n">rawmeta</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span>
                    <span class="n">path</span><span class="p">,</span> <span class="n">choose_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_cachefile</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="n">overwrite_cache</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># class method does not initiate obj.</span>
                <span class="n">dct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">_clean_metadata_from_raw</span><span class="p">(</span><span class="n">rawmeta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">dct</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Register datasetseries subclass in registry.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        args:</span>
<span class="sd">            (unused)</span>
<span class="sd">        kwargs:</span>
<span class="sd">            (unused)</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">dataseries_type_registry</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Return number of datasets in series.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return dataset by index.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Print information about this datasetseries.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        """</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="s2">"class: "</span> <span class="o">+</span> <span class="n">sprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"=== metadata ==="</span><span class="p">)</span>
            <span class="c1"># we print the range of each metadata attribute</span>
            <span class="n">minmax_dct</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">mdct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mdct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">minmax_dct</span><span class="p">:</span>
                        <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                            <span class="k">continue</span>  <span class="c1"># cannot compare arrays</span>
                        <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
                        <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">minmax_dct</span><span class="p">:</span>
                <span class="n">reprval1</span><span class="p">,</span> <span class="n">reprval2</span> <span class="o">=</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reprval1</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="n">reprval1</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%.2f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">reprval1</span>
                    <span class="n">reprval2</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%.2f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">reprval2</span>
                <span class="n">m1</span> <span class="o">=</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">m2</span> <span class="o">=</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m1</span> <span class="o">==</span> <span class="n">m2</span><span class="p">):</span>
                    <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span>
                        <span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> -- </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>
            <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"============"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Dummy property to make user aware this is not a Dataset instance.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">"Series do not have 'data' attribute. Load a dataset from series.get_dataset()."</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a dictionary of properties to be printed by __repr__ method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">        """</span>
        <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">]</span>
        <span class="n">props</span><span class="p">[</span><span class="s2">"source(id=0)"</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">props</span><span class="p">[</span><span class="s2">"Ndatasets"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">props</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return a string representation of the datasetseries object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        """</span>
        <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">clsname</span> <span class="o">+</span> <span class="s2">"["</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">, "</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"]"</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Check whether a given path is a valid path for this dataseries class.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            path to check</span>
<span class="sd">        args:</span>
<span class="sd">            (unused)</span>
<span class="sd">        kwargs:</span>
<span class="sd">            (unused)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CandidateStatus</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>  <span class="c1"># base class dummy</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_directory</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"DatasetSeries"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Create a datasetseries instance from a directory.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            path to directory</span>
<span class="sd">        interface_args:</span>
<span class="sd">            arguments to pass to interface class</span>
<span class="sd">        datasetclass: Dataset | None</span>
<span class="sd">            force class to use for dataset instances</span>
<span class="sd">        pattern:</span>
<span class="sd">            pattern to match files in directory</span>
<span class="sd">        interface_kwargs:</span>
<span class="sd">            keyword arguments to pass to interface class</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DatasetSeries</span>

<span class="sd">        """</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path does not exist."</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s2">"*"</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">paths</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="n">datasetclass</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reltol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get dataset by some metadata property. In the base class, we go by list index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index: int</span>
<span class="sd">            index of dataset to get</span>
<span class="sd">        name: str</span>
<span class="sd">            name of dataset to get</span>
<span class="sd">        reltol:</span>
<span class="sd">            relative tolerance for metadata comparison</span>
<span class="sd">        kwargs:</span>
<span class="sd">            metadata properties to compare for selection</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dataset</span>

<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specify index/name or some parameter to select for."</span><span class="p">)</span>
        <span class="c1"># aliases for index:</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"snapshot"</span><span class="p">]</span>
        <span class="n">aliases_given</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">aliases</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aliases_given</span> <span class="o">+=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aliases_given</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Multiple aliases for index specified."</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aliases_given</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No names specified for members of this series."</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Name </span><span class="si">%s</span><span class="s2"> not found in this series."</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"Cannot select by given keys before dataset evaluation."</span>
                <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown error."</span><span class="p">)</span>  <span class="c1"># should not happen?</span>

        <span class="c1"># find candidates from metadata</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">candidates_props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">props_compare</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># save names of fields we want to compare</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">candidates_props</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dm</span><span class="p">:</span>
                    <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                    <span class="n">candidates_props</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">props_compare</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">dm</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">is_candidate</span><span class="p">:</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># unroll changes</span>
                <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">candidates_props</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
                        <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c1"># find candidate closest to request</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No candidate found for given metadata."</span><span class="p">)</span>
        <span class="n">idxlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props_compare</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">candidates_props</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">-</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
            <span class="n">idxlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idxlist</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Ambiguous selection request"</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No candidate found."</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">idxlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># tolerance check</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props_compare</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="n">reltol</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">"Candidate does not match tolerance for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> vs </span><span class="si">%s</span><span class="s2"> requested)"</span>
                    <span class="o">%</span> <span class="p">(</span>
                        <span class="n">k</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                        <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Return metadata dictionary for this series.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[dict]</span>
<span class="sd">            metadata dictionary</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">))</span>
            <span class="n">ikeys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="n">mdnew</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="n">ikeys</span><span class="p">:</span>
                <span class="n">mdnew</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">md</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ik</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">mdnew</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Set metadata dictionary for this series, and save to disk.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dct: dict</span>
<span class="sd">            metadata dictionary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        """</span>

        <span class="k">class</span><span class="w"> </span><span class="nc">ComplexEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""</span>
<span class="sd">            JSON encoder that can handle numpy arrays and bytes.</span>
<span class="sd">            """</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                Default recipe for encoding objects.</span>
<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                obj: object</span>
<span class="sd">                    object to encode</span>

<span class="sd">                Returns</span>
<span class="sd">                -------</span>
<span class="sd">                object</span>

<span class="sd">                """</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1000</span>  <span class="c1"># do not want large obs here...</span>
                    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">"obj failing json encoding:"</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">dct</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">),</span> <span class="bp">cls</span><span class="o">=</span><span class="n">ComplexEncoder</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="scida.series.DatasetSeries.data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">data</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Dummy property to make user aware this is not a Dataset instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="scida.series.DatasetSeries.metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metadata</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Return metadata dictionary for this series.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Optional">Optional</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>metadata dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return dataset by index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return dataset by index.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataset</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>paths</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="list">list</span>[<span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of paths to data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>arguments to pass to interface class</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datasetclass</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>class to use for dataset instances</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_cache</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to overwrite existing cache</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lazy</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to initialize datasets lazily</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>names</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>names for datasets</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to interface class</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span>
    <span class="n">datasetclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">overwrite_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># lazy will only initialize data sets on demand.</span>
    <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    paths: list</span>
<span class="sd">        list of paths to data</span>
<span class="sd">    interface_args:</span>
<span class="sd">        arguments to pass to interface class</span>
<span class="sd">    datasetclass:</span>
<span class="sd">        class to use for dataset instances</span>
<span class="sd">    overwrite_cache:</span>
<span class="sd">        whether to overwrite existing cache</span>
<span class="sd">    lazy:</span>
<span class="sd">        whether to initialize datasets lazily</span>
<span class="sd">    names:</span>
<span class="sd">        names for datasets</span>
<span class="sd">    interface_kwargs:</span>
<span class="sd">        keyword arguments to pass to interface class</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash</span> <span class="o">=</span> <span class="n">hash_path</span><span class="p">(</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span> <span class="o">=</span> <span class="n">return_cachefile_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash</span><span class="p">,</span> <span class="s2">"data.json"</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span> <span class="o">=</span> <span class="n">lazy</span>
    <span class="k">if</span> <span class="n">overwrite_cache</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatafile</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path '</span><span class="si">%s</span><span class="s2">' does not exist."</span> <span class="o">%</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">delay_init</span>  <span class="c1"># lazy loading</span>

    <span class="c1"># Catch Mixins and create type:</span>
    <span class="n">ikw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">overwrite_cache</span><span class="o">=</span><span class="n">overwrite_cache</span><span class="p">)</span>
    <span class="n">ikw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span>
    <span class="n">mixins</span> <span class="o">=</span> <span class="n">ikw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"mixins"</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">datasetclass</span> <span class="o">=</span> <span class="n">create_datasetclass_with_mixins</span><span class="p">(</span><span class="n">datasetclass</span><span class="p">,</span> <span class="n">mixins</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_cls</span> <span class="o">=</span> <span class="n">datasetclass</span>

    <span class="n">gen</span> <span class="o">=</span> <span class="n">map_interface_args</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="o">**</span><span class="n">ikw</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">dec</span><span class="p">(</span><span class="n">datasetclass</span><span class="p">)(</span><span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Have not cached this data series. Can take a while."</span><span class="p">)</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="n">rawmeta</span> <span class="o">=</span> <span class="n">load_metadata</span><span class="p">(</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">choose_prefix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_cachefile</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="n">overwrite_cache</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># class method does not initiate obj.</span>
            <span class="n">dct</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">_clean_metadata_from_raw</span><span class="p">(</span><span class="n">rawmeta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">dct</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.__init_subclass__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Register datasetseries subclass in registry.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(unused)</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(unused)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Register datasetseries subclass in registry.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    args:</span>
<span class="sd">        (unused)</span>
<span class="sd">    kwargs:</span>
<span class="sd">        (unused)</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">dataseries_type_registry</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.__len__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__len__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return number of datasets in series.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Return number of datasets in series.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return a string representation of the datasetseries object.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return a string representation of the datasetseries object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
    <span class="n">clsname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">clsname</span> <span class="o">+</span> <span class="s2">"["</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">, "</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"]"</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.from_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_directory</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create a datasetseries instance from a directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to directory</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>arguments to pass to interface class</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datasetclass</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>force class to use for dataset instances</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pattern to match files in directory</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to interface class</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetSeries (scida.series.DatasetSeries)" href="#scida.series.DatasetSeries">DatasetSeries</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_directory</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"DatasetSeries"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Create a datasetseries instance from a directory.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        path to directory</span>
<span class="sd">    interface_args:</span>
<span class="sd">        arguments to pass to interface class</span>
<span class="sd">    datasetclass: Dataset | None</span>
<span class="sd">        force class to use for dataset instances</span>
<span class="sd">    pattern:</span>
<span class="sd">        pattern to match files in directory</span>
<span class="sd">    interface_kwargs:</span>
<span class="sd">        keyword arguments to pass to interface class</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DatasetSeries</span>

<span class="sd">    """</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specified path does not exist."</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s2">"*"</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">)]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">paths</span><span class="p">,</span> <span class="o">*</span><span class="n">interface_args</span><span class="p">,</span> <span class="n">datasetclass</span><span class="o">=</span><span class="n">datasetclass</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.get_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataset</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get dataset by some metadata property. In the base class, we go by list index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index of dataset to get</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of dataset to get</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reltol</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative tolerance for metadata comparison</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>metadata properties to compare for selection</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reltol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get dataset by some metadata property. In the base class, we go by list index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index: int</span>
<span class="sd">        index of dataset to get</span>
<span class="sd">    name: str</span>
<span class="sd">        name of dataset to get</span>
<span class="sd">    reltol:</span>
<span class="sd">        relative tolerance for metadata comparison</span>
<span class="sd">    kwargs:</span>
<span class="sd">        metadata properties to compare for selection</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataset</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Specify index/name or some parameter to select for."</span><span class="p">)</span>
    <span class="c1"># aliases for index:</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"snap"</span><span class="p">,</span> <span class="s2">"snapshot"</span><span class="p">]</span>
    <span class="n">aliases_given</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">aliases</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aliases_given</span> <span class="o">+=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aliases_given</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Multiple aliases for index specified."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aliases_given</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No names specified for members of this series."</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Name </span><span class="si">%s</span><span class="s2"> not found in this series."</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Cannot select by given keys before dataset evaluation."</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unknown error."</span><span class="p">)</span>  <span class="c1"># should not happen?</span>

    <span class="c1"># find candidates from metadata</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">candidates_props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">props_compare</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># save names of fields we want to compare</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">candidates_props</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dm</span><span class="p">:</span>
                <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">candidates_props</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dm</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">props_compare</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">dm</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">is_candidate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">is_candidate</span><span class="p">:</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># unroll changes</span>
            <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">candidates_props</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
                    <span class="n">lst</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="c1"># find candidate closest to request</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No candidate found for given metadata."</span><span class="p">)</span>
    <span class="n">idxlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props_compare</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">candidates_props</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">-</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">idxlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idxlist</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Ambiguous selection request"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"No candidate found."</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">idxlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># tolerance check</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props_compare</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="n">reltol</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">"Candidate does not match tolerance for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> vs </span><span class="si">%s</span><span class="s2"> requested)"</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">k</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">info</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Print information about this datasetseries.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Print information about this datasetseries.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">rep</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">rep</span> <span class="o">+=</span> <span class="s2">"class: "</span> <span class="o">+</span> <span class="n">sprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">props</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"=== metadata ==="</span><span class="p">)</span>
        <span class="c1"># we print the range of each metadata attribute</span>
        <span class="n">minmax_dct</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mdct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mdct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">minmax_dct</span><span class="p">:</span>
                    <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                        <span class="k">continue</span>  <span class="c1"># cannot compare arrays</span>
                    <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">minmax_dct</span><span class="p">:</span>
            <span class="n">reprval1</span><span class="p">,</span> <span class="n">reprval2</span> <span class="o">=</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reprval1</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">reprval1</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%.2f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">reprval1</span>
                <span class="n">reprval2</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%.2f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">reprval2</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">m1</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m1</span> <span class="o">==</span> <span class="n">m2</span><span class="p">):</span>
                <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span>
                    <span class="s2">"</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> -- </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">minmax_dct</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span>
        <span class="n">rep</span> <span class="o">+=</span> <span class="n">sprint</span><span class="p">(</span><span class="s2">"============"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rep</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="scida.series.DatasetSeries.validate_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Check whether a given path is a valid path for this dataseries class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to check</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(unused)</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(unused)</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="CandidateStatus (scida.discovertypes.CandidateStatus)" href="#scida.discovertypes.CandidateStatus">CandidateStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CandidateStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Check whether a given path is a valid path for this dataseries class.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        path to check</span>
<span class="sd">    args:</span>
<span class="sd">        (unused)</span>
<span class="sd">    kwargs:</span>
<span class="sd">        (unused)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CandidateStatus</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">CandidateStatus</span><span class="o">.</span><span class="n">NO</span>  <span class="c1"># base class dummy</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.series.DirectoryCatalog" class="doc doc-heading">
            <code>DirectoryCatalog</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>



        <p>A catalog consisting of interface instances contained in a directory.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/series.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DirectoryCatalog</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A catalog consisting of interface instances contained in a directory."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize a directory catalog.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path: str</span>
<span class="sd">            path to directory</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.series.DirectoryCatalog.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize a directory catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to directory</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize a directory catalog.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path: str</span>
<span class="sd">        path to directory</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="scida.series.HomogeneousSeries" class="doc doc-heading">
            <code>HomogeneousSeries</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DatasetSeries (scida.series.DatasetSeries)" href="#scida.series.DatasetSeries">DatasetSeries</a></code></p>



        <p>Series consisting of same-type data sets.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/scida/series.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HomogeneousSeries</span><span class="p">(</span><span class="n">DatasetSeries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Series consisting of same-type data sets."""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Initialize a homogeneous series.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path:</span>
<span class="sd">            path to data</span>
<span class="sd">        interface_kwargs:</span>
<span class="sd">            keyword arguments to pass to interface class</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="scida.series.HomogeneousSeries.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize a homogeneous series.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interface_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to pass to interface class</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">interface_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Initialize a homogeneous series.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path:</span>
<span class="sd">        path to data</span>
<span class="sd">    interface_kwargs:</span>
<span class="sd">        keyword arguments to pass to interface class</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="scida.series.delay_init" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delay_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorate class to delay initialization until an attribute is requested.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cls</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>class to decorate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Delay">Delay</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/series.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delay_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Decorate class to delay initialization until an attribute is requested.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cls:</span>
<span class="sd">        class to decorate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Delay</span>
<span class="sd">    """</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Delay</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Delayed initialization of a class. The class is replaced by the actual class</span>
<span class="sd">        when an attribute is requested.</span>
<span class="sd">        """</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Store arguments for later initialization."""</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Replace the class with the actual class and initialize it if needed."""</span>
            <span class="c1"># a few special calls do not trigger initialization:</span>
            <span class="n">specialattrs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">"__repr__"</span><span class="p">,</span>
                <span class="s2">"__str__"</span><span class="p">,</span>
                <span class="s2">"__dir__"</span><span class="p">,</span>
                <span class="s2">"__class__"</span><span class="p">,</span>
                <span class="s2">"_args"</span><span class="p">,</span>
                <span class="s2">"_kwargs"</span><span class="p">,</span>
                <span class="c1"># https://github.com/jupyter/notebook/issues/2014</span>
                <span class="s2">"_ipython_canary_method_should_not_exist_"</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">specialattrs</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"_repr"</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
                <span class="c1"># do not need to initialize for class methods</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>
            <span class="n">kwarg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="bp">cls</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">"evaluate_lazy"</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"__repr__"</span><span class="p">)</span>  <span class="c1"># some dummy</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">"""Return a string representation of the lazy class."""</span>
            <span class="k">return</span> <span class="s2">"&lt;Lazy </span><span class="si">%s</span><span class="s2">&gt;"</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">return</span> <span class="n">Delay</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="scida.utilities" class="doc doc-heading">
            <code>utilities</code>


</h2>

    <div class="doc doc-contents ">

        <p>Some utility functions</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="scida.utilities.copy_to_zarr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy_to_zarr</span><span class="p">(</span><span class="n">fp_in</span><span class="p">,</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">compressor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reads and converts a scida Dataset to a zarr object on disk</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fp_in</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object path to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fp_out</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compressor</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>zarr compressor to use, see https://zarr.readthedocs.io/en/stable/tutorial.html#compressors</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/scida/utilities.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy_to_zarr</span><span class="p">(</span><span class="n">fp_in</span><span class="p">,</span> <span class="n">fp_out</span><span class="p">,</span> <span class="n">compressor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Reads and converts a scida Dataset to a zarr object on disk</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fp_in: str</span>
<span class="sd">        object path to convert</span>
<span class="sd">    fp_out: str</span>
<span class="sd">        output path</span>
<span class="sd">    compressor:</span>
<span class="sd">        zarr compressor to use, see https://zarr.readthedocs.io/en/stable/tutorial.html#compressors</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    """</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">fp_in</span><span class="p">)</span>
    <span class="n">compressor_dflt</span> <span class="o">=</span> <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default_compressor</span>
    <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default_compressor</span> <span class="o">=</span> <span class="n">compressor</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp_out</span><span class="p">,</span> <span class="n">cast_uints</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">zarr</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">default_compressor</span> <span class="o">=</span> <span class="n">compressor_dflt</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.expand", "navigation.path", "search.highlight", "search.share", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": true, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>